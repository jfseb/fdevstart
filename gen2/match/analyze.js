/**
 *
 * @module jfseb.fdevstart.analyze
 * @file analyze.ts
 * @copyright (c) 2016 Gerd Forstmann
 */
"use strict";

var abot_erbase_1 = require("abot_erbase");
var debug = require("debug");
var debuglog = debug('analyze');
var logger = require("../utils/logger");
var perf = logger.perf('analyze');
var Toolmatcher = require("./toolmatcher");
function analyzeAll(sString, rules, aTools, words) {
    "use strict";

    if (sString.length === 0) {
        return [];
    } else {
        perf('analyzeString');
        //   InputFilter.resetCnt();
        var matched = abot_erbase_1.InputFilter.analyzeString(sString, rules, words);
        perf('analyzeString');
        //   InputFilter.dumpCnt();
        perf('expand');
        debuglog("After matched " + JSON.stringify(matched));
        var aSentences = abot_erbase_1.InputFilter.expandMatchArr(matched);
        aSentences.sort(abot_erbase_1.Sentence.cmpRankingProduct);
        debuglog("after expand" + aSentences.map(function (oSentence) {
            return abot_erbase_1.Sentence.rankingProduct(oSentence) + ":" + abot_erbase_1.Sentence.dumpNice(oSentence);
        }).join("\n"));
        if (debuglog.enabled) {
            debuglog(" after expand:" + abot_erbase_1.Sentence.dumpNiceArr(aSentencesReinforced, abot_erbase_1.Sentence.rankingProduct));
        }
        perf('expand');
        var aSentencesReinforced = abot_erbase_1.InputFilter.reinForce(aSentences);
        //aSentences.map(function(oSentence) { return InputFilter.reinForce(oSentence); });
        aSentencesReinforced.sort(abot_erbase_1.Sentence.cmpRankingProduct);
        debuglog("after reinforce \n" + aSentencesReinforced.map(function (oSentence) {
            return abot_erbase_1.Sentence.rankingProduct(oSentence) + ":" + abot_erbase_1.Sentence.dumpNice(oSentence);
        }).join("\n"));
        if (debuglog.enabled) {
            debuglog(" after reinforce:" + abot_erbase_1.Sentence.dumpNiceArr(aSentencesReinforced, abot_erbase_1.Sentence.rankingProduct));
        }
        aSentencesReinforced = abot_erbase_1.Sentence.cutoffSentenceAtRatio(aSentencesReinforced);
        perf('matchTools');
        var matchedTools = Toolmatcher.matchTools(aSentencesReinforced, aTools); //aTool: Array<IMatch.ITool>): any /* objectstream*/ {
        perf('matchTools');
        debuglog(" matchedTools" + JSON.stringify(matchedTools, undefined, 2));
        return matchedTools;
    }
}
exports.analyzeAll = analyzeAll;
/**
 * TODO: rework this to work correctly with sets
 */
function isComplete(match) {
    // TODO -> analyze sets
    return match && match.rank > 0.6 && Object.keys(match.toolmatchresult.missing || {}).length === 0;
}
exports.isComplete = isComplete;
function getPrompt(match) {
    if (!match) {
        return;
    }
    if (match.rank < 0.6) {
        return undefined;
    }
    if (Object.keys(match.toolmatchresult.missing).length) {
        var missing = Object.keys(match.toolmatchresult.missing)[0];
        return {
            category: missing,
            text: 'Please provide a missing "' + missing + '"?'
        };
    }
    return undefined;
}
exports.getPrompt = getPrompt;
function setPrompt(match, prompt, response) {
    if (!match) {
        return;
    }
    if (response.toLowerCase() !== 'cancel' && response.toLowerCase() !== 'abort') {
        var u = {};
        u.category = prompt.category;
        u._ranking = 1.0;
        u.matchedString = response;
        /// TODO test whether this can be valid at all?
        match.toolmatchresult.required[prompt.category] = u;
        delete match.toolmatchresult.missing[prompt.category];
    }
}
exports.setPrompt = setPrompt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tYXRjaC9hbmFseXplLnRzIl0sIm5hbWVzIjpbImFib3RfZXJiYXNlXzEiLCJyZXF1aXJlIiwiZGVidWciLCJkZWJ1Z2xvZyIsImxvZ2dlciIsInBlcmYiLCJUb29sbWF0Y2hlciIsImFuYWx5emVBbGwiLCJzU3RyaW5nIiwicnVsZXMiLCJhVG9vbHMiLCJ3b3JkcyIsImxlbmd0aCIsIm1hdGNoZWQiLCJJbnB1dEZpbHRlciIsImFuYWx5emVTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiYVNlbnRlbmNlcyIsImV4cGFuZE1hdGNoQXJyIiwic29ydCIsIlNlbnRlbmNlIiwiY21wUmFua2luZ1Byb2R1Y3QiLCJtYXAiLCJvU2VudGVuY2UiLCJyYW5raW5nUHJvZHVjdCIsImR1bXBOaWNlIiwiam9pbiIsImVuYWJsZWQiLCJkdW1wTmljZUFyciIsImFTZW50ZW5jZXNSZWluZm9yY2VkIiwicmVpbkZvcmNlIiwiY3V0b2ZmU2VudGVuY2VBdFJhdGlvIiwibWF0Y2hlZFRvb2xzIiwibWF0Y2hUb29scyIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJpc0NvbXBsZXRlIiwibWF0Y2giLCJyYW5rIiwiT2JqZWN0Iiwia2V5cyIsInRvb2xtYXRjaHJlc3VsdCIsIm1pc3NpbmciLCJnZXRQcm9tcHQiLCJjYXRlZ29yeSIsInRleHQiLCJzZXRQcm9tcHQiLCJwcm9tcHQiLCJyZXNwb25zZSIsInRvTG93ZXJDYXNlIiwidSIsIl9yYW5raW5nIiwibWF0Y2hlZFN0cmluZyIsInJlcXVpcmVkIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBT0E7O0FBRUEsSUFBQUEsZ0JBQUFDLFFBQUEsYUFBQSxDQUFBO0FBRUEsSUFBQUMsUUFBQUQsUUFBQSxPQUFBLENBQUE7QUFFQSxJQUFNRSxXQUFXRCxNQUFNLFNBQU4sQ0FBakI7QUFJQSxJQUFBRSxTQUFBSCxRQUFBLGlCQUFBLENBQUE7QUFDQSxJQUFJSSxPQUFPRCxPQUFPQyxJQUFQLENBQVksU0FBWixDQUFYO0FB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b250ZW50IjpbIi8qKlxuICpcbiAqIEBtb2R1bGUgamZzZWIuZmRldnN0YXJ0LmFuYWx5emVcbiAqIEBmaWxlIGFuYWx5emUudHNcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuXG5cInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHtJbnB1dEZpbHRlciBhcyBJbnB1dEZpbHRlciwgU2VudGVuY2UgYXMgU2VudGVuY2V9IGZyb20gJ2Fib3RfZXJiYXNlJztcblxuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdhbmFseXplJyk7XG5cblxuXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJztcbnZhciBwZXJmID0gbG9nZ2VyLnBlcmYoJ2FuYWx5emUnKTtcblxuXG5pbXBvcnQgKiBhcyBVdGlscyBmcm9tICdhYm90X3V0aWxzJztcblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4vaWZtYXRjaCc7XG5cbmltcG9ydCAqIGFzIFRvb2xtYXRjaGVyIGZyb20gJy4vdG9vbG1hdGNoZXInO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBhbmFseXplQWxsKHNTdHJpbmc6IHN0cmluZywgcnVsZXM6IElNYXRjaC5TcGxpdFJ1bGVzLCBhVG9vbHM6IEFycmF5PElNYXRjaC5JVG9vbD4sIHdvcmRzPyApIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG4gIGlmIChzU3RyaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIHtcbiAgICBwZXJmKCdhbmFseXplU3RyaW5nJyk7XG4gLy8gICBJbnB1dEZpbHRlci5yZXNldENudCgpO1xuICAgIHZhciBtYXRjaGVkID0gSW5wdXRGaWx0ZXIuYW5hbHl6ZVN0cmluZyhzU3RyaW5nLCBydWxlcywgd29yZHMpO1xuICAgIHBlcmYoJ2FuYWx5emVTdHJpbmcnKTtcbiAvLyAgIElucHV0RmlsdGVyLmR1bXBDbnQoKTtcbiAgICBwZXJmKCdleHBhbmQnKTtcbiAgICBkZWJ1Z2xvZyhcIkFmdGVyIG1hdGNoZWQgXCIgKyBKU09OLnN0cmluZ2lmeShtYXRjaGVkKSk7XG4gICAgdmFyIGFTZW50ZW5jZXMgPSBJbnB1dEZpbHRlci5leHBhbmRNYXRjaEFycihtYXRjaGVkKTtcblxuICAgIGFTZW50ZW5jZXMuc29ydChTZW50ZW5jZS5jbXBSYW5raW5nUHJvZHVjdCk7XG4gICAgZGVidWdsb2coXCJhZnRlciBleHBhbmRcIiArIGFTZW50ZW5jZXMubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBTZW50ZW5jZS5kdW1wTmljZShvU2VudGVuY2UpO1xuICAgIH0pLmpvaW4oXCJcXG5cIikpO1xuICAgIGlmIChkZWJ1Z2xvZy5lbmFibGVkKSB7XG4gICAgICBkZWJ1Z2xvZyhcIiBhZnRlciBleHBhbmQ6XCIgKyBTZW50ZW5jZS5kdW1wTmljZUFycihhU2VudGVuY2VzUmVpbmZvcmNlZCwgU2VudGVuY2UucmFua2luZ1Byb2R1Y3QpKTtcbiAgICB9XG4gICAgcGVyZignZXhwYW5kJyk7XG4gICAgdmFyIGFTZW50ZW5jZXNSZWluZm9yY2VkID0gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKGFTZW50ZW5jZXMpO1xuICAgIC8vYVNlbnRlbmNlcy5tYXAoZnVuY3Rpb24ob1NlbnRlbmNlKSB7IHJldHVybiBJbnB1dEZpbHRlci5yZWluRm9yY2Uob1NlbnRlbmNlKTsgfSk7XG4gICAgYVNlbnRlbmNlc1JlaW5mb3JjZWQuc29ydChTZW50ZW5jZS5jbXBSYW5raW5nUHJvZHVjdCk7XG4gICAgZGVidWdsb2coXCJhZnRlciByZWluZm9yY2UgXFxuXCIgKyBhU2VudGVuY2VzUmVpbmZvcmNlZC5tYXAoZnVuY3Rpb24gKG9TZW50ZW5jZSkge1xuICAgICAgcmV0dXJuIFNlbnRlbmNlLnJhbmtpbmdQcm9kdWN0KG9TZW50ZW5jZSkgKyBcIjpcIiArIFNlbnRlbmNlLmR1bXBOaWNlKG9TZW50ZW5jZSk7XG4gICAgfSkuam9pbihcIlxcblwiKSk7XG4gICAgaWYgKGRlYnVnbG9nLmVuYWJsZWQpIHtcbiAgICAgIGRlYnVnbG9nKFwiIGFmdGVyIHJlaW5mb3JjZTpcIiArIFNlbnRlbmNlLmR1bXBOaWNlQXJyKGFTZW50ZW5jZXNSZWluZm9yY2VkLCBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdCkpO1xuICAgIH1cbiAgICBhU2VudGVuY2VzUmVpbmZvcmNlZCA9IFNlbnRlbmNlLmN1dG9mZlNlbnRlbmNlQXRSYXRpbyhhU2VudGVuY2VzUmVpbmZvcmNlZClcbiAgICBwZXJmKCdtYXRjaFRvb2xzJyk7XG4gICAgdmFyIG1hdGNoZWRUb29scyA9IFRvb2xtYXRjaGVyLm1hdGNoVG9vbHMoYVNlbnRlbmNlc1JlaW5mb3JjZWQsIGFUb29scyk7IC8vYVRvb2w6IEFycmF5PElNYXRjaC5JVG9vbD4pOiBhbnkgLyogb2JqZWN0c3RyZWFtKi8ge1xuICAgIHBlcmYoJ21hdGNoVG9vbHMnKTtcbiAgICBkZWJ1Z2xvZyhcIiBtYXRjaGVkVG9vbHNcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRUb29scywgdW5kZWZpbmVkLCAyKSk7XG4gICAgcmV0dXJuIG1hdGNoZWRUb29scztcbiAgfVxufVxuXG4vKipcbiAqIFRPRE86IHJld29yayB0aGlzIHRvIHdvcmsgY29ycmVjdGx5IHdpdGggc2V0c1xuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NvbXBsZXRlKG1hdGNoIDogIElNYXRjaC5JVG9vbE1hdGNoKSB7XG4gIC8vIFRPRE8gLT4gYW5hbHl6ZSBzZXRzXG4gIHJldHVybiBtYXRjaCAmJiBtYXRjaC5yYW5rID4gMC42ICYmXG4gICAgT2JqZWN0LmtleXMobWF0Y2gudG9vbG1hdGNocmVzdWx0Lm1pc3NpbmcgfHx7fSkubGVuZ3RoID09PSAwXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQcm9tcHQobWF0Y2ggOiAgSU1hdGNoLklUb29sTWF0Y2gpIHtcbiAgaWYoIW1hdGNoKSB7XG4gICAgICByZXR1cm47XG4gIH1cbiAgaWYgKG1hdGNoLnJhbmsgPCAwLjYgKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZihPYmplY3Qua2V5cyhtYXRjaC50b29sbWF0Y2hyZXN1bHQubWlzc2luZykubGVuZ3RoICkge1xuICAgIHZhciBtaXNzaW5nID0gT2JqZWN0LmtleXMobWF0Y2gudG9vbG1hdGNocmVzdWx0Lm1pc3NpbmcpWzBdO1xuICAgIHJldHVybiB7XG4gICAgICBjYXRlZ29yeSA6IG1pc3NpbmcsXG4gICAgICB0ZXh0IDogJ1BsZWFzZSBwcm92aWRlIGEgbWlzc2luZyBcIicgKyBtaXNzaW5nICsgJ1wiPydcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gc2V0UHJvbXB0KG1hdGNoIDogSU1hdGNoLklUb29sTWF0Y2gsIHByb21wdDogSU1hdGNoLklQcm9tcHQsXG4gIHJlc3BvbnNlIDogc3RyaW5nKSB7XG4gICAgaWYoIW1hdGNoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChyZXNwb25zZS50b0xvd2VyQ2FzZSgpICE9PSAnY2FuY2VsJyAmJiByZXNwb25zZS50b0xvd2VyQ2FzZSgpICE9PSAnYWJvcnQnKSB7XG4gICAgICB2YXIgdSA9IHt9IGFzIElNYXRjaC5JV29yZDtcbiAgICAgIHUuY2F0ZWdvcnkgPSBwcm9tcHQuY2F0ZWdvcnk7XG4gICAgICB1Ll9yYW5raW5nID0gMS4wO1xuICAgICAgdS5tYXRjaGVkU3RyaW5nID0gcmVzcG9uc2U7XG4gICAgICAvLy8gVE9ETyB0ZXN0IHdoZXRoZXIgdGhpcyBjYW4gYmUgdmFsaWQgYXQgYWxsP1xuICAgICAgbWF0Y2gudG9vbG1hdGNocmVzdWx0LnJlcXVpcmVkW3Byb21wdC5jYXRlZ29yeV0gPSB1O1xuICAgICAgZGVsZXRlIG1hdGNoLnRvb2xtYXRjaHJlc3VsdC5taXNzaW5nW3Byb21wdC5jYXRlZ29yeV07XG4gICB9XG59XG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
