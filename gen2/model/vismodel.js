"use strict";
/**
 * visualize a model and calculate some statistics
 */

Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs");
var fdevsta_monmove_1 = require("fdevsta_monmove");
var Util = require("abot_utils");
var Describe = require("../match/describe");
var _ = require("lodash");
var debug = require("debug");
//import * as elasticlunr from 'elasticlunr';
var debuglog = debug('vismodel.ts');
;
var elasticlunr = require('elasticlunr');
function JSONEscape(s) {
    return s.replace(/\\/g, "\\\\").replace(/\n/g, "\\n").replace(/\'/g, "\\'").replace(/\"/g, '\\"').replace(/\&/g, "\\&").replace(/\r/g, "\\r").replace(/\t/g, "\\t");
    // .replace(/\b/g, "\\b")
    // .replace(/\f/g, "\\f");
}
exports.JSONEscape = JSONEscape;
;
function makeLunrIndex(modelpath, output, silent) {
    var mdl = JSON.parse('' + fs.readFileSync(modelpath + '.model.json'));
    var data = JSON.parse('' + fs.readFileSync(modelpath + '.data.json'));
    var cats = mdl.category.filter(function (a) {
        return typeof a !== 'string';
    });
    var qbeDataObjects = cats.filter(function (cat) {
        return cat.QBE || cat.QBEInclude;
    });
    //console.log("here cats" + JSON.stringify(cats));
    //console.log("\nhere data objects" + JSON.stringify(qbeDataObjects));
    var qbeDataNames = qbeDataObjects.map(function (cat) {
        return cat.name;
    });
    qbeDataNames = _.union(qbeDataNames, mdl.columns);
    var LUNRIndex = cats.filter(function (cat) {
        return cat.LUNRIndex;
    }).map(function (cat) {
        return cat.name;
    });
    //var elasticlunr = require('lunr');
    var bomdata = data;
    // index all LUNR properties
    var index = elasticlunr(function () {
        var that = this;
        LUNRIndex /*
                  ["appId",
                  "AppKey",
                  "AppName",
                    "ApplicationComponent",
                    "RoleName",
                    "ApplicationType",
                    "BSPName",
                    "BSPApplicationURL",
                    "releaseName",
                    "BusinessCatalog",
                    "TechnicalCatalog"] */
        .forEach(function (field) {
            that.addField(field);
        });
        this.setRef('id');
        this.saveDocument(false);
    });
    bomdata.forEach(function (o, index) {
        o.id = index;
    });
    bomdata.forEach(function (record) {
        index.addDoc(record);
    });
    var elastic = index;
    // dump the lunr index
    //
    var theIndex = index.toJSON();
    var columns = mdl.columns.map(function (colname) {
        var res = cats.filter(function (cat) {
            return cat.name === colname;
        });
        if (res.length !== 1) {
            throw new Error("undefined or non-object column : " + colname);
        }
        ;
        return res[0];
    });
    var columnNames = columns.map(function (col) {
        return col.name;
    });
    var jsonp = "var mdldata = {};\n//columns \n mdldata.columns = [\"" + columns.map(function (col) {
        return col.name;
    }).join('","') + "\"];";
    var json = "{ \"columns\"  : [\"" + columns.map(function (col) {
        return JSONEscape(col.name);
    }).join('","') + "\"],";
    // jsonp += `\n mdldata.fulldata = ${JSON.stringify(bomdata)};\n`;
    //jsonp += `\n//columns info \n mdldata.lunrcolumns = ["{${LUNRIndex.join('","')}"];`;
    jsonp += "\n//columns info \n mdldata.columnsDescription = {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" :  \"" + JSONEscape(col.description || col.name) + "\" ";
    }).join(',') + "\n      };";
    json += "\"columnsDescription\" : {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" :  \"" + JSONEscape(col.description || col.name) + "\" ";
    }).join(',') + "\n      },";
    jsonp += "\n//columns info \n mdldata.columnsDefaultWidth = {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" : " + (col.defaultWidth || 150) + " ";
    }).join(',') + "\n      };";
    json += "\n\"columnsDefaultWidth\" : {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" : " + (col.defaultWidth || 150) + " ";
    }).join(',') + "\n      },";
    var theIndexStr = JSON.stringify(theIndex);
    jsonp += "\nvar serIndex =\"" + JSONEscape(theIndexStr) + "\";\n";
    // jsonp += "\nvar serIndex =" + JSON.stringify(theIndex) + ";\n";
    json += '\n"serIndex" :' + theIndexStr + ',';
    //console.log("here all names " + JSON.stringify(qbeDataNames));
    var cleanseddata = bomdata.map(function (o) {
        var res = {};
        qbeDataNames.forEach(function (key) {
            res[key] = o[key];
        });
        return res;
    });
    if (!silent) {
        console.log("dumping " + output);
        console.log("length of index str" + theIndexStr.length);
        console.log("available          " + columns.length + " columns");
        console.log("returning as data  " + qbeDataNames.length + " columns");
        console.log("indexing           " + LUNRIndex.length + " columns");
        console.log('returned but not available', _.difference(qbeDataNames, columnNames).join(", "));
        console.log('returned but not indexed', _.difference(qbeDataNames, LUNRIndex).join(", "));
    }
    jsonp += "var data=" + JSON.stringify(cleanseddata) + ";";
    json += '"data":' + JSON.stringify(cleanseddata) + "\n}";
    jsonp += "\n\n           // var elastic = elasticlunr.Index.load(serIndex);\n\n  ";
    //fs.writeFileSync(output + ".lunr.js", jsonp);
    fs.writeFileSync(output + ".lunr.json", json);
}
exports.makeLunrIndex = makeLunrIndex;
/*

  var index = elastilunr.Index.load(obj);


}

 "QBE" : false,
      "QBEInclude" : true,
      "LUNRIndex": false
*/
function calcCategoryRecord(m, category, domain) {
    var otherdomains = fdevsta_monmove_1.Model.getDomainsForCategory(m, category);
    _.pull(otherdomains, domain);
    var res = {
        otherdomains: otherdomains,
        nrDistinctValues: 0,
        nrDistinctValuesInDomain: 0,
        nrRecords: 0,
        nrRecordsInDomain: 0,
        nrTotalRecordsInDomain: 0
    };
    var values = [];
    var valuesInDomain = [];
    var nrRecordsInDomain = 0;
    var distinctValues = m.records.forEach(function (oEntry) {
        if (oEntry._domain === domain) {
            res.nrTotalRecordsInDomain += 1;
        }
        if (oEntry[category]) {
            var value = oEntry[category];
            if (oEntry._domain === domain) {
                valuesInDomain[value] = (valuesInDomain[value] || 0) + 1;
                res.nrRecordsInDomain += 1;
            }
            values[value] = (values[value] || 0) + 1;
            res.nrRecords += 1;
        }
    });
    res.nrDistinctValues = Object.keys(values).length;
    res.nrDistinctValuesInDomain = Object.keys(valuesInDomain).length;
    return res;
}
exports.calcCategoryRecord = calcCategoryRecord;
function graphDomain(domain, m) {
    // draw a model domains
    var res = "\n    digraph sdsu {\n\tsize=\"36,36\";\n   rankdir=LR\n\tnode [color=yellow, style=filled];\n    \"" + domain + "\"\n  ";
    // add all category nodes
    res += "node [shape=record, color=yellow, style=filled];\n ";
    var cats = fdevsta_monmove_1.Model.getCategoriesForDomain(m, domain);
    var categoryResults = {};
    var otherdomains = [];
    cats.forEach(function (cat) {
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        res += "\"" + cat + "\" [label=\"{ " + cat + " | " + catResult.nrDistinctValuesInDomain + " Values in " + catResult.nrRecordsInDomain + " ";
        if (catResult.nrRecordsInDomain !== catResult.nrRecords) {
            res += "|  " + (catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain) + " other values in " + (catResult.nrRecords - catResult.nrRecordsInDomain) + " other records";
        } else {
            res += " ";
        }
        res += "}\"]\n";
    });
    // calculate other domains.
    // draw "other categories"
    res += "node [color=purple, style=filled]; \n";
    otherdomains.forEach(function (otherdomain) {
        res += "\"" + otherdomain + "\" \n";
    });
    // count records in domain :
    var nrRecords = m.records.reduce(function (prev, entry) {
        return prev + (entry._domain === domain ? 1 : 0);
    }, 0);
    res += "node [shape=record]; \n";
    res += " \"record\" [label=\"{<f0> " + domain + " | " + nrRecords + "}\"] \n";
    res += " \"r_other\" [label=\"{<f0> other | " + nrRecords + "}\"] \n ";
    res += "# relation from categories to domain\n";
    cats.forEach(function (cat) {
        res += " \"" + cat + "\" -> \"" + domain + "\" \n";
    });
    res += "# relation from categories to records\n";
    cats.forEach(function (cat) {
        var rec = categoryResults[cat];
        res += " \"" + cat + "\" -> \"record\" \n";
    });
    //other domains to this
    cats.forEach(function (cat) {});
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "}\n";
    return res;
}
exports.graphDomain = graphDomain;
/*
    categoryDesc : theModel.full.domain[filterdomain].categories[category],
    distinct : distinct,
    delta : delta,
    presentRecords : recordCount.presentrecords,
    percPresent : percent,
    sampleValues : valuesList
  }
*/
function replaceBr(string) {
    string = string.replace(/\n/g, "\n\t\t\t\t\t\t\t\t\t\t\tbr\n\t\t\t\t\t\t\t\t\t\t\t| ");
    return string;
}
/**
 * generate a textual representation of a domain
 */
function tabDomain(domain, m) {
    // draw a model domains
    var cats = fdevsta_monmove_1.Model.getCategoriesForDomain(m, domain);
    cats = fdevsta_monmove_1.Model.sortCategoriesByImportance(m.full.domain[domain].categories || {}, cats);
    //console.log(cats.join("\n"));
    var catdesc = Describe.getCategoryStatsInDomain(cats[0], domain, m);
    var catResult = calcCategoryRecord(m, cats[0], domain);
    var domainDescr = m.full.domain[domain].description || "";
    domainDescr = replaceBr(domainDescr);
    var res = "\n\n// preset form values if we receive a userdata object //\n- user = user\n\nextends ../layout_p\n\nblock content\n\n\tnav.navbar.navbar-default.navbar-fixed-top\n\t\t.container\n\t\t\t.navbar-header\n\t\t\t\t.navbar-brand(style='bgcolor:orange;color:darkblue;font-family:Arial Black;font-size:15.118px') wosap domain " + domain + "\n\t\t\tul.nav.navbar-nav.navbar-right #{uid}\n\t\t\t\tli\n\t\t\t\t\t.navbar-btn#btn-logout.btn.btn-default(onclick=\"location.href='/home'\")\n\t\t\t\t\t\t| back to home\n\n\tp  &nbsp;\n\tp &nbsp;\n\tp\n\n\tdiv.well\n\t\th3 domain \"" + domain + "\"\n\t\t\tspan.pull-right " + catResult.nrTotalRecordsInDomain + " records\n\t\tp\n\t\tspan " + domainDescr + "\n\n\t\ttable.table.table-condensed.table-striped\n\t\t\tthead\n\t\t\t\ttr\n\t\t\t\t\tth category\n\t\t\t\t\tth(style=\"width:10%\") count\n\t\t\t\t\tth\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd synonyms\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd description\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd example values\n\t\t\ttbody\n";
    var categoryResults = {};
    var otherdomains = [];
    var categoryMap = m.full.domain[domain].categories || {};
    cats.forEach(function (cat) {
        var catdesc = Describe.getCategoryStatsInDomain(cat, domain, m);
        //console.log(JSON.stringify(catdesc));
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        /*
            res += `"${cat}" [label="{ ${cat} | ${catResult.nrDistinctValuesInDomain} Values in ${catResult.nrRecordsInDomain} `;
            if(catResult.nrRecordsInDomain !== catResult.nrRecords) {
              res +=  `|  ${catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain} other values in ${catResult.nrRecords - catResult.nrRecordsInDomain} other records`;
            } else {
              res += ` `;
            }
            res += `}"]\n`;
        */
        //console.log(JSON.stringify(m.full.domain[domain]));
        if (m.full.domain[domain].categories[cat]) {
            var synonymsString = Util.listToCommaAnd(catdesc.categoryDesc && catdesc.categoryDesc.synonyms && catdesc.categoryDesc.synonyms || []) || "&nbsp;";
            res += "\n\t\t\ttr\n\t\t\t\t\ttd.cat_count " + cat + "\n\t\t\t\t\ttd " + catdesc.presentRecords + " distinct values in " + catdesc.percPresent + "% of records\n\t\t\t\t\ttd\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr.cat_synonyms\n\t\t\t\t\t\t\t\ttd " + synonymsString + "\n\t\t\t\t\t\t\ttr.cat_description\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.categoryDesc && catdesc.categoryDesc.description || "") + "\n\t\t\t\t\t\t\ttr.cat_samplevalues\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.sampleValues) + "\n      ";
        }
    });
    var othercats = cats.length - Object.keys(m.full.domain[domain].categories).length;
    var remainingCategories = _.difference(cats, Object.keys(m.full.domain[domain].categories));
    if (othercats > 0) {
        res += "\n\t\tp   and " + othercats + " other categories\n\t\t| " + Util.listToCommaAnd(remainingCategories) + "\n       ";
    }
    /*
      // calculate other domains.
      // draw "other categories"
      res += `node [color=purple, style=filled]; \n`
      otherdomains.forEach(function(otherdomain) {
        res += `"${otherdomain}" \n`;
      });
      // count records in domain :
      var nrRecords = m.records.reduce(function(prev,entry) {
      return prev + ((entry._domain === domain) ? 1 : 0);
      },0);
      res += `node [shape=record]; \n`
      res += ` "record" [label="{<f0> ${domain} | ${nrRecords}}"] \n`;
          res += ` "r_other" [label="{<f0> other | ${nrRecords}}"] \n `;
          res += `# relation from categories to domain\n`;
      cats.forEach(function(cat) {
        res += ` "${cat}" -> "${domain}" \n`;
      })
      
      res += `# relation from categories to records\n`;
      cats.forEach(function(cat) {
        var rec = categoryResults[cat];
        res += ` "${cat}" -> "record" \n`;
      })
      
      //other domains to this
      cats.forEach(function(cat) {
      
      })
    */
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "\n\t\th3 Version\n\t\t\ta.small(href=\"/whatsnew\")\n\n\nblock scripts\n\tscript(src='/vendor/jquery-2.2.3.min.js')\n\tscript(src='/vendor/bootstrap.min.js')\n\tscript(src='/js/views/settings.js')\n";
    return res;
}
exports.tabDomain = tabDomain;
var child_process_1 = require("child_process");
function execCmd(cmd) {
    child_process_1.exec(cmd, function (error, stdout, stderr) {
        if (error) {
            console.error("exec error: " + error);
            return;
        }
        console.log("stdout: " + stdout);
        console.log("stderr: " + stderr);
    });
}
;
function visModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = graphDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".gv";
        fs.writeFileSync(fnGraph, s);
        if (process.env.GRAPHVIZ) {
            console.log("here the file " + fnGraph);
            execCmd(process.env.GRAPHVIZ + " -Tjpeg -O " + fnGraph);
        }
    });
}
exports.visModels = visModels;
function tabModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = tabDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".jade";
        debuglog("here the file " + fnGraph);
        fs.writeFileSync(fnGraph, s);
    });
}
exports.tabModels = tabModels;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL3Zpc21vZGVsLmpzIiwiLi4vc3JjL21vZGVsL3Zpc21vZGVsLnRzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZnMiLCJyZXF1aXJlIiwiZmRldnN0YV9tb25tb3ZlXzEiLCJVdGlsIiwiRGVzY3JpYmUiLCJfIiwiZGVidWciLCJkZWJ1Z2xvZyIsImVsYXN0aWNsdW5yIiwiSlNPTkVzY2FwZSIsInMiLCJyZXBsYWNlIiwibWFrZUx1bnJJbmRleCIsIm1vZGVscGF0aCIsIm91dHB1dCIsInNpbGVudCIsIm1kbCIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsImRhdGEiLCJjYXRzIiwiY2F0ZWdvcnkiLCJmaWx0ZXIiLCJhIiwicWJlRGF0YU9iamVjdHMiLCJjYXQiLCJRQkUiLCJRQkVJbmNsdWRlIiwicWJlRGF0YU5hbWVzIiwibWFwIiwibmFtZSIsInVuaW9uIiwiY29sdW1ucyIsIkxVTlJJbmRleCIsImJvbWRhdGEiLCJpbmRleCIsInRoYXQiLCJmb3JFYWNoIiwiZmllbGQiLCJhZGRGaWVsZCIsInNldFJlZiIsInNhdmVEb2N1bWVudCIsIm8iLCJpZCIsInJlY29yZCIsImFkZERvYyIsImVsYXN0aWMiLCJ0aGVJbmRleCIsInRvSlNPTiIsImNvbG5hbWUiLCJyZXMiLCJsZW5ndGgiLCJFcnJvciIsImNvbHVtbk5hbWVzIiwiY29sIiwianNvbnAiLCJqb2luIiwianNvbiIsImRlc2NyaXB0aW9uIiwiZGVmYXVsdFdpZHRoIiwidGhlSW5kZXhTdHIiLCJzdHJpbmdpZnkiLCJjbGVhbnNlZGRhdGEiLCJrZXkiLCJjb25zb2xlIiwibG9nIiwiZGlmZmVyZW5jZSIsIndyaXRlRmlsZVN5bmMiLCJjYWxjQ2F0ZWdvcnlSZWNvcmQiLCJtIiwiZG9tYWluIiwib3RoZXJkb21haW5zIiwiTW9kZWwiLCJnZXREb21haW5zRm9yQ2F0ZWdvcnkiLCJwdWxsIiwibnJEaXN0aW5jdFZhbHVlcyIsIm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiIsIm5yUmVjb3JkcyIsIm5yUmVjb3Jkc0luRG9tYWluIiwibnJUb3RhbFJlY29yZHNJbkRvbWFpbiIsInZhbHVlcyIsInZhbHVlc0luRG9tYWluIiwiZGlzdGluY3RWYWx1ZXMiLCJyZWNvcmRzIiwib0VudHJ5IiwiX2RvbWFpbiIsImtleXMiLCJncmFwaERvbWFpbiIsImdldENhdGVnb3JpZXNGb3JEb21haW4iLCJjYXRlZ29yeVJlc3VsdHMiLCJjYXRSZXN1bHQiLCJvdGhlckRvbWFpbnMiLCJvdGhlcmRvbWFpbiIsInJlZHVjZSIsInByZXYiLCJlbnRyeSIsInJlYyIsInJlcGxhY2VCciIsInN0cmluZyIsInRhYkRvbWFpbiIsInNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlIiwiZnVsbCIsImNhdGVnb3JpZXMiLCJjYXRkZXNjIiwiZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluIiwiZG9tYWluRGVzY3IiLCJjYXRlZ29yeU1hcCIsInN5bm9ueW1zU3RyaW5nIiwibGlzdFRvQ29tbWFBbmQiLCJjYXRlZ29yeURlc2MiLCJzeW5vbnltcyIsInByZXNlbnRSZWNvcmRzIiwicGVyY1ByZXNlbnQiLCJzYW1wbGVWYWx1ZXMiLCJvdGhlcmNhdHMiLCJyZW1haW5pbmdDYXRlZ29yaWVzIiwiY2hpbGRfcHJvY2Vzc18xIiwiZXhlY0NtZCIsImNtZCIsImV4ZWMiLCJlcnJvciIsInN0ZG91dCIsInN0ZGVyciIsInZpc01vZGVscyIsImZvbGRlck91dCIsImRvbWFpbnMiLCJzRG9tYWluIiwiZm5HcmFwaCIsInByb2Nlc3MiLCJlbnYiLCJHUkFQSFZJWiIsInRhYk1vZGVscyJdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTs7OztBRElBQSxPQUFPQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QyxFQUFFQyxPQUFPLElBQVQsRUFBN0M7QUNLQSxJQUFBQyxLQUFBQyxRQUFBLElBQUEsQ0FBQTtBQUVBLElBQUFDLG9CQUFBRCxRQUFBLGlCQUFBLENBQUE7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T0FBakIsRUFBMEJ0SCxDQUExQjtBQUNBLFlBQUl1SCxRQUFRQyxHQUFSLENBQVlDLFFBQWhCLEVBQTBCO0FBQ3hCbEUsb0JBQVFDLEdBQVIsQ0FBWSxtQkFBbUI4RCxPQUEvQjtBQUNBVixvQkFBUVcsUUFBUUMsR0FBUixDQUFZQyxRQUFaLEdBQXVCLGFBQXZCLEdBQXVDSCxPQUEvQztBQUNEO0FBQ0YsS0FSRDtBQVNEO0FBVkRsSSxRQUFBOEgsU0FBQSxHQUFBQSxTQUFBO0FBWUEsU0FBQVEsU0FBQSxDQUEwQjlELENBQTFCLEVBQTZDdUQsU0FBN0MsRUFBOEQ7QUFDNUR2RCxNQUFFd0QsT0FBRixDQUFVeEYsT0FBVixDQUFrQixVQUFVeUYsT0FBVixFQUFpQjtBQUNqQyxZQUFJckgsSUFBSTBGLFVBQVUyQixPQUFWLEVBQW1CekQsQ0FBbkIsQ0FBUjtBQUNBLFlBQUkwRCxVQUFVSCxZQUFZLEdBQVosR0FBa0JFLFFBQVFwSCxPQUFSLENBQWdCLElBQWhCLEVBQXNCLEdBQXRCLENBQWxCLEdBQStDLE9BQTdEO0FBQ0FKLGlCQUFTLG1CQUFtQnlILE9BQTVCO0FBQ0FoSSxXQUFHb0UsYUFBSCxDQUFpQjRELE9BQWpCLEVBQTBCdEgsQ0FBMUI7QUFDRCxLQUxEO0FBTUQ7QUFQRFosUUFBQXNJLFNBQUEsR0FBQUEsU0FBQSIsImZpbGUiOiJtb2RlbC92aXNtb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiB2aXN1YWxpemUgYSBtb2RlbCBhbmQgY2FsY3VsYXRlIHNvbWUgc3RhdGlzdGljc1xuICovXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgZnMgPSByZXF1aXJlKFwiZnNcIik7XG52YXIgZmRldnN0YV9tb25tb3ZlXzEgPSByZXF1aXJlKFwiZmRldnN0YV9tb25tb3ZlXCIpO1xudmFyIFV0aWwgPSByZXF1aXJlKFwiYWJvdF91dGlsc1wiKTtcbnZhciBEZXNjcmliZSA9IHJlcXVpcmUoXCIuLi9tYXRjaC9kZXNjcmliZVwiKTtcbnZhciBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbnZhciBkZWJ1ZyA9IHJlcXVpcmUoXCJkZWJ1Z1wiKTtcbi8vaW1wb3J0ICogYXMgZWxhc3RpY2x1bnIgZnJvbSAnZWxhc3RpY2x1bnInO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ3Zpc21vZGVsLnRzJyk7XG47XG52YXIgZWxhc3RpY2x1bnIgPSByZXF1aXJlKCdlbGFzdGljbHVucicpO1xuZnVuY3Rpb24gSlNPTkVzY2FwZShzKSB7XG4gICAgcmV0dXJuIHMucmVwbGFjZSgvXFxcXC9nLCBcIlxcXFxcXFxcXCIpLnJlcGxhY2UoL1xcbi9nLCBcIlxcXFxuXCIpXG4gICAgICAgIC5yZXBsYWNlKC9cXCcvZywgXCJcXFxcJ1wiKVxuICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCAnXFxcXFwiJylcbiAgICAgICAgLnJlcGxhY2UoL1xcJi9nLCBcIlxcXFwmXCIpXG4gICAgICAgIC5yZXBsYWNlKC9cXHIvZywgXCJcXFxcclwiKVxuICAgICAgICAucmVwbGFjZSgvXFx0L2csIFwiXFxcXHRcIik7XG4gICAgLy8gLnJlcGxhY2UoL1xcYi9nLCBcIlxcXFxiXCIpXG4gICAgLy8gLnJlcGxhY2UoL1xcZi9nLCBcIlxcXFxmXCIpO1xufVxuZXhwb3J0cy5KU09ORXNjYXBlID0gSlNPTkVzY2FwZTtcbjtcbmZ1bmN0aW9uIG1ha2VMdW5ySW5kZXgobW9kZWxwYXRoLCBvdXRwdXQsIHNpbGVudCkge1xuICAgIHZhciBtZGwgPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKG1vZGVscGF0aCArICcubW9kZWwuanNvbicpKTtcbiAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoJycgKyBmcy5yZWFkRmlsZVN5bmMobW9kZWxwYXRoICsgJy5kYXRhLmpzb24nKSk7XG4gICAgdmFyIGNhdHMgPSBtZGwuY2F0ZWdvcnkuZmlsdGVyKGZ1bmN0aW9uIChhKSB7IHJldHVybiB0eXBlb2YgYSAhPT0gJ3N0cmluZyc7IH0pO1xuICAgIHZhciBxYmVEYXRhT2JqZWN0cyA9IGNhdHMuZmlsdGVyKGZ1bmN0aW9uIChjYXQpIHsgcmV0dXJuIChjYXQuUUJFIHx8IGNhdC5RQkVJbmNsdWRlKTsgfSk7XG4gICAgLy9jb25zb2xlLmxvZyhcImhlcmUgY2F0c1wiICsgSlNPTi5zdHJpbmdpZnkoY2F0cykpO1xuICAgIC8vY29uc29sZS5sb2coXCJcXG5oZXJlIGRhdGEgb2JqZWN0c1wiICsgSlNPTi5zdHJpbmdpZnkocWJlRGF0YU9iamVjdHMpKTtcbiAgICB2YXIgcWJlRGF0YU5hbWVzID0gcWJlRGF0YU9iamVjdHMubWFwKGZ1bmN0aW9uIChjYXQpIHsgcmV0dXJuIGNhdC5uYW1lOyB9KTtcbiAgICBxYmVEYXRhTmFtZXMgPSBfLnVuaW9uKHFiZURhdGFOYW1lcywgbWRsLmNvbHVtbnMpO1xuICAgIHZhciBMVU5SSW5kZXggPSBjYXRzLmZpbHRlcihmdW5jdGlvbiAoY2F0KSB7IHJldHVybiBjYXQuTFVOUkluZGV4OyB9KS5tYXAoZnVuY3Rpb24gKGNhdCkgeyByZXR1cm4gY2F0Lm5hbWU7IH0pO1xuICAgIC8vdmFyIGVsYXN0aWNsdW5yID0gcmVxdWlyZSgnbHVucicpO1xuICAgIHZhciBib21kYXRhID0gZGF0YTtcbiAgICAvLyBpbmRleCBhbGwgTFVOUiBwcm9wZXJ0aWVzXG4gICAgdmFyIGluZGV4ID0gZWxhc3RpY2x1bnIoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIExVTlJJbmRleCAvKlxuICAgICAgICAgICAgICAgIFtcImFwcElkXCIsXG4gICAgICAgICAgICAgICAgXCJBcHBLZXlcIixcbiAgICAgICAgICAgICAgICBcIkFwcE5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJBcHBsaWNhdGlvbkNvbXBvbmVudFwiLFxuICAgICAgICAgICAgICAgICAgICBcIlJvbGVOYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25UeXBlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiQlNQTmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcIkJTUEFwcGxpY2F0aW9uVVJMXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZU5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJCdXNpbmVzc0NhdGFsb2dcIixcbiAgICAgICAgICAgICAgICAgICAgXCJUZWNobmljYWxDYXRhbG9nXCJdICovXG4gICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgIHRoYXQuYWRkRmllbGQoZmllbGQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXRSZWYoJ2lkJyk7XG4gICAgICAgIHRoaXMuc2F2ZURvY3VtZW50KGZhbHNlKTtcbiAgICB9KTtcbiAgICBib21kYXRhLmZvckVhY2goZnVuY3Rpb24gKG8sIGluZGV4KSB7XG4gICAgICAgIG8uaWQgPSBpbmRleDtcbiAgICB9KTtcbiAgICBib21kYXRhLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgICBpbmRleC5hZGREb2MocmVjb3JkKTtcbiAgICB9KTtcbiAgICB2YXIgZWxhc3RpYyA9IGluZGV4O1xuICAgIC8vIGR1bXAgdGhlIGx1bnIgaW5kZXhcbiAgICAvL1xuICAgIHZhciB0aGVJbmRleCA9IGluZGV4LnRvSlNPTigpO1xuICAgIHZhciBjb2x1bW5zID0gbWRsLmNvbHVtbnMubWFwKGZ1bmN0aW9uIChjb2xuYW1lKSB7XG4gICAgICAgIHZhciByZXMgPSBjYXRzLmZpbHRlcihmdW5jdGlvbiAoY2F0KSB7IHJldHVybiBjYXQubmFtZSA9PT0gY29sbmFtZTsgfSk7XG4gICAgICAgIGlmIChyZXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRlZmluZWQgb3Igbm9uLW9iamVjdCBjb2x1bW4gOiBcIiArIGNvbG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIDtcbiAgICAgICAgcmV0dXJuIHJlc1swXTtcbiAgICB9KTtcbiAgICB2YXIgY29sdW1uTmFtZXMgPSBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7IHJldHVybiBjb2wubmFtZTsgfSk7XG4gICAgdmFyIGpzb25wID0gXCJ2YXIgbWRsZGF0YSA9IHt9O1xcbi8vY29sdW1ucyBcXG4gbWRsZGF0YS5jb2x1bW5zID0gW1xcXCJcIiArIGNvbHVtbnMubWFwKGZ1bmN0aW9uIChjb2wpIHsgcmV0dXJuIGNvbC5uYW1lOyB9KS5qb2luKCdcIixcIicpICsgXCJcXFwiXTtcIjtcbiAgICB2YXIganNvbiA9IFwieyBcXFwiY29sdW1uc1xcXCIgIDogW1xcXCJcIiArIGNvbHVtbnMubWFwKGZ1bmN0aW9uIChjb2wpIHsgcmV0dXJuIEpTT05Fc2NhcGUoY29sLm5hbWUpOyB9KS5qb2luKCdcIixcIicpICsgXCJcXFwiXSxcIjtcbiAgICAvLyBqc29ucCArPSBgXFxuIG1kbGRhdGEuZnVsbGRhdGEgPSAke0pTT04uc3RyaW5naWZ5KGJvbWRhdGEpfTtcXG5gO1xuICAgIC8vanNvbnAgKz0gYFxcbi8vY29sdW1ucyBpbmZvIFxcbiBtZGxkYXRhLmx1bnJjb2x1bW5zID0gW1wieyR7TFVOUkluZGV4LmpvaW4oJ1wiLFwiJyl9XCJdO2A7XG4gICAganNvbnAgKz0gXCJcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5jb2x1bW5zRGVzY3JpcHRpb24gPSB7XCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgIHJldHVybiBcIiBcXG4gXFxcIlwiICsgY29sLm5hbWUgKyBcIlxcXCIgOiAgXFxcIlwiICsgSlNPTkVzY2FwZShjb2wuZGVzY3JpcHRpb24gfHwgY29sLm5hbWUpICsgXCJcXFwiIFwiO1xuICAgIH0pLmpvaW4oJywnKSArIFwiXFxuICAgICAgfTtcIjtcbiAgICBqc29uICs9IFwiXFxcImNvbHVtbnNEZXNjcmlwdGlvblxcXCIgOiB7XCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgIHJldHVybiBcIiBcXG4gXFxcIlwiICsgY29sLm5hbWUgKyBcIlxcXCIgOiAgXFxcIlwiICsgSlNPTkVzY2FwZShjb2wuZGVzY3JpcHRpb24gfHwgY29sLm5hbWUpICsgXCJcXFwiIFwiO1xuICAgIH0pLmpvaW4oJywnKSArIFwiXFxuICAgICAgfSxcIjtcbiAgICBqc29ucCArPSBcIlxcbi8vY29sdW1ucyBpbmZvIFxcbiBtZGxkYXRhLmNvbHVtbnNEZWZhdWx0V2lkdGggPSB7XCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgIHJldHVybiBcIiBcXG4gXFxcIlwiICsgY29sLm5hbWUgKyBcIlxcXCIgOiBcIiArIChjb2wuZGVmYXVsdFdpZHRoIHx8IDE1MCkgKyBcIiBcIjtcbiAgICB9KS5qb2luKCcsJykgKyBcIlxcbiAgICAgIH07XCI7XG4gICAganNvbiArPSBcIlxcblxcXCJjb2x1bW5zRGVmYXVsdFdpZHRoXFxcIiA6IHtcIiArIGNvbHVtbnMubWFwKGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgcmV0dXJuIFwiIFxcbiBcXFwiXCIgKyBjb2wubmFtZSArIFwiXFxcIiA6IFwiICsgKGNvbC5kZWZhdWx0V2lkdGggfHwgMTUwKSArIFwiIFwiO1xuICAgIH0pLmpvaW4oJywnKSArIFwiXFxuICAgICAgfSxcIjtcbiAgICB2YXIgdGhlSW5kZXhTdHIgPSBKU09OLnN0cmluZ2lmeSh0aGVJbmRleCk7XG4gICAganNvbnAgKz0gXCJcXG52YXIgc2VySW5kZXggPVxcXCJcIiArIEpTT05Fc2NhcGUodGhlSW5kZXhTdHIpICsgXCJcXFwiO1xcblwiO1xuICAgIC8vIGpzb25wICs9IFwiXFxudmFyIHNlckluZGV4ID1cIiArIEpTT04uc3RyaW5naWZ5KHRoZUluZGV4KSArIFwiO1xcblwiO1xuICAgIGpzb24gKz0gJ1xcblwic2VySW5kZXhcIiA6JyArIHRoZUluZGV4U3RyICsgJywnO1xuICAgIC8vY29uc29sZS5sb2coXCJoZXJlIGFsbCBuYW1lcyBcIiArIEpTT04uc3RyaW5naWZ5KHFiZURhdGFOYW1lcykpO1xuICAgIHZhciBjbGVhbnNlZGRhdGEgPSBib21kYXRhLm1hcChmdW5jdGlvbiAobykge1xuICAgICAgICB2YXIgcmVzID0ge307XG4gICAgICAgIHFiZURhdGFOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHJlc1trZXldID0gb1trZXldO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9KTtcbiAgICBpZiAoIXNpbGVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImR1bXBpbmcgXCIgKyBvdXRwdXQpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImxlbmd0aCBvZiBpbmRleCBzdHJcIiArIHRoZUluZGV4U3RyLmxlbmd0aCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXZhaWxhYmxlICAgICAgICAgIFwiICsgY29sdW1ucy5sZW5ndGggKyBcIiBjb2x1bW5zXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInJldHVybmluZyBhcyBkYXRhICBcIiArIHFiZURhdGFOYW1lcy5sZW5ndGggKyBcIiBjb2x1bW5zXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImluZGV4aW5nICAgICAgICAgICBcIiArIExVTlJJbmRleC5sZW5ndGggKyBcIiBjb2x1bW5zXCIpO1xuICAgICAgICBjb25zb2xlLmxvZygncmV0dXJuZWQgYnV0IG5vdCBhdmFpbGFibGUnLCBfLmRpZmZlcmVuY2UocWJlRGF0YU5hbWVzLCBjb2x1bW5OYW1lcykuam9pbihcIiwgXCIpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3JldHVybmVkIGJ1dCBub3QgaW5kZXhlZCcsIF8uZGlmZmVyZW5jZShxYmVEYXRhTmFtZXMsIExVTlJJbmRleCkuam9pbihcIiwgXCIpKTtcbiAgICB9XG4gICAganNvbnAgKz0gXCJ2YXIgZGF0YT1cIiArIEpTT04uc3RyaW5naWZ5KGNsZWFuc2VkZGF0YSkgKyBcIjtcIjtcbiAgICBqc29uICs9ICdcImRhdGFcIjonICsgSlNPTi5zdHJpbmdpZnkoY2xlYW5zZWRkYXRhKSArIFwiXFxufVwiO1xuICAgIGpzb25wICs9IFwiXFxuXFxuICAgICAgICAgICAvLyB2YXIgZWxhc3RpYyA9IGVsYXN0aWNsdW5yLkluZGV4LmxvYWQoc2VySW5kZXgpO1xcblxcbiAgXCI7XG4gICAgLy9mcy53cml0ZUZpbGVTeW5jKG91dHB1dCArIFwiLmx1bnIuanNcIiwganNvbnApO1xuICAgIGZzLndyaXRlRmlsZVN5bmMob3V0cHV0ICsgXCIubHVuci5qc29uXCIsIGpzb24pO1xufVxuZXhwb3J0cy5tYWtlTHVuckluZGV4ID0gbWFrZUx1bnJJbmRleDtcbi8qXG5cclxuICB2YXIgaW5kZXggPSBlbGFzdGlsdW5yLkluZGV4LmxvYWQob2JqKTtcblxyXG5cclxufVxuXHJcbiBcIlFCRVwiIDogZmFsc2UsXG4gICAgICBcIlFCRUluY2x1ZGVcIiA6IHRydWUsXG4gICAgICBcIkxVTlJJbmRleFwiOiBmYWxzZVxuKi9cbmZ1bmN0aW9uIGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXRlZ29yeSwgZG9tYWluKSB7XG4gICAgdmFyIG90aGVyZG9tYWlucyA9IGZkZXZzdGFfbW9ubW92ZV8xLk1vZGVsLmdldERvbWFpbnNGb3JDYXRlZ29yeShtLCBjYXRlZ29yeSk7XG4gICAgXy5wdWxsKG90aGVyZG9tYWlucywgZG9tYWluKTtcbiAgICB2YXIgcmVzID0ge1xuICAgICAgICBvdGhlcmRvbWFpbnM6IG90aGVyZG9tYWlucyxcbiAgICAgICAgbnJEaXN0aW5jdFZhbHVlczogMCxcbiAgICAgICAgbnJEaXN0aW5jdFZhbHVlc0luRG9tYWluOiAwLFxuICAgICAgICBuclJlY29yZHM6IDAsXG4gICAgICAgIG5yUmVjb3Jkc0luRG9tYWluOiAwLFxuICAgICAgICBuclRvdGFsUmVjb3Jkc0luRG9tYWluOiAwLFxuICAgIH07XG4gICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgIHZhciB2YWx1ZXNJbkRvbWFpbiA9IFtdO1xuICAgIHZhciBuclJlY29yZHNJbkRvbWFpbiA9IDA7XG4gICAgdmFyIGRpc3RpbmN0VmFsdWVzID0gbS5yZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICBpZiAob0VudHJ5Ll9kb21haW4gPT09IGRvbWFpbikge1xuICAgICAgICAgICAgcmVzLm5yVG90YWxSZWNvcmRzSW5Eb21haW4gKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gb0VudHJ5W2NhdGVnb3J5XTtcbiAgICAgICAgICAgIGlmIChvRW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzSW5Eb21haW5bdmFsdWVdID0gKHZhbHVlc0luRG9tYWluW3ZhbHVlXSB8fCAwKSArIDE7XG4gICAgICAgICAgICAgICAgcmVzLm5yUmVjb3Jkc0luRG9tYWluICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YWx1ZXNbdmFsdWVdID0gKHZhbHVlc1t2YWx1ZV0gfHwgMCkgKyAxO1xuICAgICAgICAgICAgcmVzLm5yUmVjb3JkcyArPSAxO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmVzLm5yRGlzdGluY3RWYWx1ZXMgPSBPYmplY3Qua2V5cyh2YWx1ZXMpLmxlbmd0aDtcbiAgICByZXMubnJEaXN0aW5jdFZhbHVlc0luRG9tYWluID0gT2JqZWN0LmtleXModmFsdWVzSW5Eb21haW4pLmxlbmd0aDtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5jYWxjQ2F0ZWdvcnlSZWNvcmQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQ7XG5mdW5jdGlvbiBncmFwaERvbWFpbihkb21haW4sIG0pIHtcbiAgICAvLyBkcmF3IGEgbW9kZWwgZG9tYWluc1xuICAgIHZhciByZXMgPSBcIlxcbiAgICBkaWdyYXBoIHNkc3Uge1xcblxcdHNpemU9XFxcIjM2LDM2XFxcIjtcXG4gICByYW5rZGlyPUxSXFxuXFx0bm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xcbiAgICBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCJcXG4gIFwiO1xuICAgIC8vIGFkZCBhbGwgY2F0ZWdvcnkgbm9kZXNcbiAgICByZXMgKz0gXCJub2RlIFtzaGFwZT1yZWNvcmQsIGNvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcXG4gXCI7XG4gICAgdmFyIGNhdHMgPSBmZGV2c3RhX21vbm1vdmVfMS5Nb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKG0sIGRvbWFpbik7XG4gICAgdmFyIGNhdGVnb3J5UmVzdWx0cyA9IHt9O1xuICAgIHZhciBvdGhlcmRvbWFpbnMgPSBbXTtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdCwgZG9tYWluKTtcbiAgICAgICAgY2F0ZWdvcnlSZXN1bHRzW2NhdF0gPSBjYXRSZXN1bHQ7XG4gICAgICAgIG90aGVyZG9tYWlucyA9IF8udW5pb24ob3RoZXJkb21haW5zLCBjYXRlZ29yeVJlc3VsdHNbY2F0XS5vdGhlckRvbWFpbnMpO1xuICAgICAgICByZXMgKz0gXCJcXFwiXCIgKyBjYXQgKyBcIlxcXCIgW2xhYmVsPVxcXCJ7IFwiICsgY2F0ICsgXCIgfCBcIiArIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW4gKyBcIiBWYWx1ZXMgaW4gXCIgKyBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4gKyBcIiBcIjtcbiAgICAgICAgaWYgKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgICAgICAgcmVzICs9IFwifCAgXCIgKyAoY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXMgLSBjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWluKSArIFwiIG90aGVyIHZhbHVlcyBpbiBcIiArIChjYXRSZXN1bHQubnJSZWNvcmRzIC0gY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWluKSArIFwiIG90aGVyIHJlY29yZHNcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcyArPSBcIiBcIjtcbiAgICAgICAgfVxuICAgICAgICByZXMgKz0gXCJ9XFxcIl1cXG5cIjtcbiAgICB9KTtcbiAgICAvLyBjYWxjdWxhdGUgb3RoZXIgZG9tYWlucy5cbiAgICAvLyBkcmF3IFwib3RoZXIgY2F0ZWdvcmllc1wiXG4gICAgcmVzICs9IFwibm9kZSBbY29sb3I9cHVycGxlLCBzdHlsZT1maWxsZWRdOyBcXG5cIjtcbiAgICBvdGhlcmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAob3RoZXJkb21haW4pIHtcbiAgICAgICAgcmVzICs9IFwiXFxcIlwiICsgb3RoZXJkb21haW4gKyBcIlxcXCIgXFxuXCI7XG4gICAgfSk7XG4gICAgLy8gY291bnQgcmVjb3JkcyBpbiBkb21haW4gOlxuICAgIHZhciBuclJlY29yZHMgPSBtLnJlY29yZHMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBlbnRyeSkge1xuICAgICAgICByZXR1cm4gcHJldiArICgoZW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSA/IDEgOiAwKTtcbiAgICB9LCAwKTtcbiAgICByZXMgKz0gXCJub2RlIFtzaGFwZT1yZWNvcmRdOyBcXG5cIjtcbiAgICByZXMgKz0gXCIgXFxcInJlY29yZFxcXCIgW2xhYmVsPVxcXCJ7PGYwPiBcIiArIGRvbWFpbiArIFwiIHwgXCIgKyBuclJlY29yZHMgKyBcIn1cXFwiXSBcXG5cIjtcbiAgICByZXMgKz0gXCIgXFxcInJfb3RoZXJcXFwiIFtsYWJlbD1cXFwiezxmMD4gb3RoZXIgfCBcIiArIG5yUmVjb3JkcyArIFwifVxcXCJdIFxcbiBcIjtcbiAgICByZXMgKz0gXCIjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byBkb21haW5cXG5cIjtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICByZXMgKz0gXCIgXFxcIlwiICsgY2F0ICsgXCJcXFwiIC0+IFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBcXG5cIjtcbiAgICB9KTtcbiAgICByZXMgKz0gXCIjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byByZWNvcmRzXFxuXCI7XG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICAgICAgdmFyIHJlYyA9IGNhdGVnb3J5UmVzdWx0c1tjYXRdO1xuICAgICAgICByZXMgKz0gXCIgXFxcIlwiICsgY2F0ICsgXCJcXFwiIC0+IFxcXCJyZWNvcmRcXFwiIFxcblwiO1xuICAgIH0pO1xuICAgIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICB9KTtcbiAgICAvKlxuICAgIGNhdHMgZm9cbiAgICAgIGRpZ3JhcGggc2RzdSB7XG4gICAgICBzaXplPVwiMzYsMzZcIjtcbiAgICAgIG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIEZMUEQgRkxQIFwiQk9NIEVkaXRvclwiLCBcIldJS0lVUkxcIiBcIlVJNSBEb2N1bWVudGF0aW9uXCIsIFwiVUk1IEV4YW1wbGVcIiwgXCJTVEFSVFRBXCJcbiAgICAgIEJDUFxuICAgICAgbm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIG5vZGUgW2ZvbnRuYW1lPVwiVmVyZGFuYVwiLCBzaXplPVwiMzAsMzBcIl07XG4gICAgICBub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuICAgICAgZ3JhcGggWyBmb250bmFtZSA9IFwiQXJpYWxcIixcbiAgICAqL1xuICAgIHJlcyArPSBcIn1cXG5cIjtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5ncmFwaERvbWFpbiA9IGdyYXBoRG9tYWluO1xuLypcbiAgICBjYXRlZ29yeURlc2MgOiB0aGVNb2RlbC5mdWxsLmRvbWFpbltmaWx0ZXJkb21haW5dLmNhdGVnb3JpZXNbY2F0ZWdvcnldLFxuICAgIGRpc3RpbmN0IDogZGlzdGluY3QsXG4gICAgZGVsdGEgOiBkZWx0YSxcbiAgICBwcmVzZW50UmVjb3JkcyA6IHJlY29yZENvdW50LnByZXNlbnRyZWNvcmRzLFxuICAgIHBlcmNQcmVzZW50IDogcGVyY2VudCxcbiAgICBzYW1wbGVWYWx1ZXMgOiB2YWx1ZXNMaXN0XG4gIH1cbiovXG5mdW5jdGlvbiByZXBsYWNlQnIoc3RyaW5nKSB7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xcbi9nLCBcIlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdGJyXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0fCBcIik7XG4gICAgcmV0dXJuIHN0cmluZztcbn1cbi8qKlxuICogZ2VuZXJhdGUgYSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIGEgZG9tYWluXG4gKi9cbmZ1bmN0aW9uIHRhYkRvbWFpbihkb21haW4sIG0pIHtcbiAgICAvLyBkcmF3IGEgbW9kZWwgZG9tYWluc1xuICAgIHZhciBjYXRzID0gZmRldnN0YV9tb25tb3ZlXzEuTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbihtLCBkb21haW4pO1xuICAgIGNhdHMgPSBmZGV2c3RhX21vbm1vdmVfMS5Nb2RlbC5zb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZShtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllcyB8fCB7fSwgY2F0cyk7XG4gICAgLy9jb25zb2xlLmxvZyhjYXRzLmpvaW4oXCJcXG5cIikpO1xuICAgIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdHNbMF0sIGRvbWFpbiwgbSk7XG4gICAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXRzWzBdLCBkb21haW4pO1xuICAgIHZhciBkb21haW5EZXNjciA9IG0uZnVsbC5kb21haW5bZG9tYWluXS5kZXNjcmlwdGlvbiB8fCBcIlwiO1xuICAgIGRvbWFpbkRlc2NyID0gcmVwbGFjZUJyKGRvbWFpbkRlc2NyKTtcbiAgICB2YXIgcmVzID0gXCJcXG5cXG4vLyBwcmVzZXQgZm9ybSB2YWx1ZXMgaWYgd2UgcmVjZWl2ZSBhIHVzZXJkYXRhIG9iamVjdCAvL1xcbi0gdXNlciA9IHVzZXJcXG5cXG5leHRlbmRzIC4uL2xheW91dF9wXFxuXFxuYmxvY2sgY29udGVudFxcblxcblxcdG5hdi5uYXZiYXIubmF2YmFyLWRlZmF1bHQubmF2YmFyLWZpeGVkLXRvcFxcblxcdFxcdC5jb250YWluZXJcXG5cXHRcXHRcXHQubmF2YmFyLWhlYWRlclxcblxcdFxcdFxcdFxcdC5uYXZiYXItYnJhbmQoc3R5bGU9J2JnY29sb3I6b3JhbmdlO2NvbG9yOmRhcmtibHVlO2ZvbnQtZmFtaWx5OkFyaWFsIEJsYWNrO2ZvbnQtc2l6ZToxNS4xMThweCcpIHdvc2FwIGRvbWFpbiBcIiArIGRvbWFpbiArIFwiXFxuXFx0XFx0XFx0dWwubmF2Lm5hdmJhci1uYXYubmF2YmFyLXJpZ2h0ICN7dWlkfVxcblxcdFxcdFxcdFxcdGxpXFxuXFx0XFx0XFx0XFx0XFx0Lm5hdmJhci1idG4jYnRuLWxvZ291dC5idG4uYnRuLWRlZmF1bHQob25jbGljaz1cXFwibG9jYXRpb24uaHJlZj0nL2hvbWUnXFxcIilcXG5cXHRcXHRcXHRcXHRcXHRcXHR8IGJhY2sgdG8gaG9tZVxcblxcblxcdHAgICZuYnNwO1xcblxcdHAgJm5ic3A7XFxuXFx0cFxcblxcblxcdGRpdi53ZWxsXFxuXFx0XFx0aDMgZG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIlxcblxcdFxcdFxcdHNwYW4ucHVsbC1yaWdodCBcIiArIGNhdFJlc3VsdC5uclRvdGFsUmVjb3Jkc0luRG9tYWluICsgXCIgcmVjb3Jkc1xcblxcdFxcdHBcXG5cXHRcXHRzcGFuIFwiICsgZG9tYWluRGVzY3IgKyBcIlxcblxcblxcdFxcdHRhYmxlLnRhYmxlLnRhYmxlLWNvbmRlbnNlZC50YWJsZS1zdHJpcGVkXFxuXFx0XFx0XFx0dGhlYWRcXG5cXHRcXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdHRoIGNhdGVnb3J5XFxuXFx0XFx0XFx0XFx0XFx0dGgoc3R5bGU9XFxcIndpZHRoOjEwJVxcXCIpIGNvdW50XFxuXFx0XFx0XFx0XFx0XFx0dGhcXG5cXHRcXHRcXHRcXHRcXHRcXHR0YWJsZVxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgc3lub255bXNcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIGRlc2NyaXB0aW9uXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCBleGFtcGxlIHZhbHVlc1xcblxcdFxcdFxcdHRib2R5XFxuXCI7XG4gICAgdmFyIGNhdGVnb3J5UmVzdWx0cyA9IHt9O1xuICAgIHZhciBvdGhlcmRvbWFpbnMgPSBbXTtcbiAgICB2YXIgY2F0ZWdvcnlNYXAgPSBtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllcyB8fCB7fTtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICB2YXIgY2F0ZGVzYyA9IERlc2NyaWJlLmdldENhdGVnb3J5U3RhdHNJbkRvbWFpbihjYXQsIGRvbWFpbiwgbSk7XG4gICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY2F0ZGVzYykpO1xuICAgICAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdCwgZG9tYWluKTtcbiAgICAgICAgY2F0ZWdvcnlSZXN1bHRzW2NhdF0gPSBjYXRSZXN1bHQ7XG4gICAgICAgIG90aGVyZG9tYWlucyA9IF8udW5pb24ob3RoZXJkb21haW5zLCBjYXRlZ29yeVJlc3VsdHNbY2F0XS5vdGhlckRvbWFpbnMpO1xuICAgICAgICAvKlxuICAgICAgICAgICAgcmVzICs9IGBcIiR7Y2F0fVwiIFtsYWJlbD1cInsgJHtjYXR9IHwgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWlufSBWYWx1ZXMgaW4gJHtjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IGA7XG4gICAgICAgICAgICBpZihjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4gIT09IGNhdFJlc3VsdC5uclJlY29yZHMpIHtcbiAgICAgICAgICAgICAgcmVzICs9ICBgfCAgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlcyAtIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IG90aGVyIHZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHMgLSBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IG90aGVyIHJlY29yZHNgO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzICs9IGAgYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcyArPSBgfVwiXVxcbmA7XG4gICAgICAgICovXG4gICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkobS5mdWxsLmRvbWFpbltkb21haW5dKSk7XG4gICAgICAgIGlmIChtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllc1tjYXRdKSB7XG4gICAgICAgICAgICB2YXIgc3lub255bXNTdHJpbmcgPSBVdGlsLmxpc3RUb0NvbW1hQW5kKGNhdGRlc2MuY2F0ZWdvcnlEZXNjICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLnN5bm9ueW1zICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLnN5bm9ueW1zIHx8IFtdKSB8fCBcIiZuYnNwO1wiO1xuICAgICAgICAgICAgcmVzICs9IFwiXFxuXFx0XFx0XFx0dHJcXG5cXHRcXHRcXHRcXHRcXHR0ZC5jYXRfY291bnQgXCIgKyBjYXQgKyBcIlxcblxcdFxcdFxcdFxcdFxcdHRkIFwiICsgY2F0ZGVzYy5wcmVzZW50UmVjb3JkcyArIFwiIGRpc3RpbmN0IHZhbHVlcyBpbiBcIiArIGNhdGRlc2MucGVyY1ByZXNlbnQgKyBcIiUgb2YgcmVjb3Jkc1xcblxcdFxcdFxcdFxcdFxcdHRkXFxuXFx0XFx0XFx0XFx0XFx0XFx0dGFibGVcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfc3lub255bXNcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCBcIiArIHN5bm9ueW1zU3RyaW5nICsgXCJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfZGVzY3JpcHRpb25cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCBcIiArIHJlcGxhY2VCcihjYXRkZXNjLmNhdGVnb3J5RGVzYyAmJiBjYXRkZXNjLmNhdGVnb3J5RGVzYy5kZXNjcmlwdGlvbiB8fCBcIlwiKSArIFwiXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X3NhbXBsZXZhbHVlc1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIFwiICsgcmVwbGFjZUJyKGNhdGRlc2Muc2FtcGxlVmFsdWVzKSArIFwiXFxuICAgICAgXCI7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgb3RoZXJjYXRzID0gY2F0cy5sZW5ndGggLSBPYmplY3Qua2V5cyhtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllcykubGVuZ3RoO1xuICAgIHZhciByZW1haW5pbmdDYXRlZ29yaWVzID0gXy5kaWZmZXJlbmNlKGNhdHMsIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKSk7XG4gICAgaWYgKChvdGhlcmNhdHMpID4gMCkge1xuICAgICAgICByZXMgKz0gXCJcXG5cXHRcXHRwICAgYW5kIFwiICsgb3RoZXJjYXRzICsgXCIgb3RoZXIgY2F0ZWdvcmllc1xcblxcdFxcdHwgXCIgKyBVdGlsLmxpc3RUb0NvbW1hQW5kKHJlbWFpbmluZ0NhdGVnb3JpZXMpICsgXCJcXG4gICAgICAgXCI7XG4gICAgfVxuICAgIC8qXG4gICAgICAvLyBjYWxjdWxhdGUgb3RoZXIgZG9tYWlucy5cbiAgICAgIC8vIGRyYXcgXCJvdGhlciBjYXRlZ29yaWVzXCJcbiAgICAgIHJlcyArPSBgbm9kZSBbY29sb3I9cHVycGxlLCBzdHlsZT1maWxsZWRdOyBcXG5gXG4gICAgICBvdGhlcmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihvdGhlcmRvbWFpbikge1xuICAgICAgICByZXMgKz0gYFwiJHtvdGhlcmRvbWFpbn1cIiBcXG5gO1xuICAgICAgfSk7XG4gICAgICAvLyBjb3VudCByZWNvcmRzIGluIGRvbWFpbiA6XG4gICAgICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbihwcmV2LGVudHJ5KSB7XG4gICAgICByZXR1cm4gcHJldiArICgoZW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSA/IDEgOiAwKTtcbiAgICAgIH0sMCk7XG4gICAgICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZF07IFxcbmBcbiAgICAgIHJlcyArPSBgIFwicmVjb3JkXCIgW2xhYmVsPVwiezxmMD4gJHtkb21haW59IHwgJHtuclJlY29yZHN9fVwiXSBcXG5gO1xuICBcclxuICAgICAgcmVzICs9IGAgXCJyX290aGVyXCIgW2xhYmVsPVwiezxmMD4gb3RoZXIgfCAke25yUmVjb3Jkc319XCJdIFxcbiBgO1xuICBcclxuICAgICAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byBkb21haW5cXG5gO1xuICAgICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgICAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwiJHtkb21haW59XCIgXFxuYDtcbiAgICAgIH0pXG4gIFxyXG4gIFxyXG4gICAgICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIHJlY29yZHNcXG5gO1xuICAgICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgICAgICB2YXIgcmVjID0gY2F0ZWdvcnlSZXN1bHRzW2NhdF07XG4gICAgICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCJyZWNvcmRcIiBcXG5gO1xuICAgICAgfSlcbiAgXHJcbiAgXHJcbiAgICAgIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gICAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XG4gIFxyXG4gIFxyXG4gICAgICB9KVxuICAgICovXG4gICAgLypcbiAgICBjYXRzIGZvXG4gICAgICBkaWdyYXBoIHNkc3Uge1xuICAgICAgc2l6ZT1cIjM2LDM2XCI7XG4gICAgICBub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XG4gICAgICBGTFBEIEZMUCBcIkJPTSBFZGl0b3JcIiwgXCJXSUtJVVJMXCIgXCJVSTUgRG9jdW1lbnRhdGlvblwiLCBcIlVJNSBFeGFtcGxlXCIsIFwiU1RBUlRUQVwiXG4gICAgICBCQ1BcbiAgICAgIG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG4gICAgICBub2RlIFtmb250bmFtZT1cIlZlcmRhbmFcIiwgc2l6ZT1cIjMwLDMwXCJdO1xuICAgICAgbm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIGdyYXBoIFsgZm9udG5hbWUgPSBcIkFyaWFsXCIsXG4gICAgKi9cbiAgICByZXMgKz0gXCJcXG5cXHRcXHRoMyBWZXJzaW9uXFxuXFx0XFx0XFx0YS5zbWFsbChocmVmPVxcXCIvd2hhdHNuZXdcXFwiKVxcblxcblxcbmJsb2NrIHNjcmlwdHNcXG5cXHRzY3JpcHQoc3JjPScvdmVuZG9yL2pxdWVyeS0yLjIuMy5taW4uanMnKVxcblxcdHNjcmlwdChzcmM9Jy92ZW5kb3IvYm9vdHN0cmFwLm1pbi5qcycpXFxuXFx0c2NyaXB0KHNyYz0nL2pzL3ZpZXdzL3NldHRpbmdzLmpzJylcXG5cIjtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy50YWJEb21haW4gPSB0YWJEb21haW47XG52YXIgY2hpbGRfcHJvY2Vzc18xID0gcmVxdWlyZShcImNoaWxkX3Byb2Nlc3NcIik7XG5mdW5jdGlvbiBleGVjQ21kKGNtZCkge1xuICAgIGNoaWxkX3Byb2Nlc3NfMS5leGVjKGNtZCwgZnVuY3Rpb24gKGVycm9yLCBzdGRvdXQsIHN0ZGVycikge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJleGVjIGVycm9yOiBcIiArIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhcInN0ZG91dDogXCIgKyBzdGRvdXQpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInN0ZGVycjogXCIgKyBzdGRlcnIpO1xuICAgIH0pO1xufVxuO1xuZnVuY3Rpb24gdmlzTW9kZWxzKG0sIGZvbGRlck91dCkge1xuICAgIG0uZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChzRG9tYWluKSB7XG4gICAgICAgIHZhciBzID0gZ3JhcGhEb21haW4oc0RvbWFpbiwgbSk7XG4gICAgICAgIHZhciBmbkdyYXBoID0gZm9sZGVyT3V0ICsgXCIvXCIgKyBzRG9tYWluLnJlcGxhY2UoLyAvZywgJ18nKSArIFwiLmd2XCI7XG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZm5HcmFwaCwgcyk7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5HUkFQSFZJWikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJoZXJlIHRoZSBmaWxlIFwiICsgZm5HcmFwaCk7XG4gICAgICAgICAgICBleGVjQ21kKHByb2Nlc3MuZW52LkdSQVBIVklaICsgXCIgLVRqcGVnIC1PIFwiICsgZm5HcmFwaCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMudmlzTW9kZWxzID0gdmlzTW9kZWxzO1xuZnVuY3Rpb24gdGFiTW9kZWxzKG0sIGZvbGRlck91dCkge1xuICAgIG0uZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChzRG9tYWluKSB7XG4gICAgICAgIHZhciBzID0gdGFiRG9tYWluKHNEb21haW4sIG0pO1xuICAgICAgICB2YXIgZm5HcmFwaCA9IGZvbGRlck91dCArIFwiL1wiICsgc0RvbWFpbi5yZXBsYWNlKC8gL2csICdfJykgKyBcIi5qYWRlXCI7XG4gICAgICAgIGRlYnVnbG9nKFwiaGVyZSB0aGUgZmlsZSBcIiArIGZuR3JhcGgpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICAgIH0pO1xufVxuZXhwb3J0cy50YWJNb2RlbHMgPSB0YWJNb2RlbHM7XG4iLCIvKipcbiAqIHZpc3VhbGl6ZSBhIG1vZGVsIGFuZCBjYWxjdWxhdGUgc29tZSBzdGF0aXN0aWNzXG4gKi9cblxuXG5cbmltcG9ydCAqIGFzIElNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcblxuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5cbmltcG9ydCB7TW9kZWwgYXMgTW9kZWx9ICBmcm9tICdmZGV2c3RhX21vbm1vdmUnO1xuXG5pbXBvcnQgKiBhcyBVdGlsIGZyb20gJ2Fib3RfdXRpbHMnO1xuXG5pbXBvcnQgKiBhcyBEZXNjcmliZSBmcm9tICcuLi9tYXRjaC9kZXNjcmliZSc7XG5cbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuLy9pbXBvcnQgKiBhcyBlbGFzdGljbHVuciBmcm9tICdlbGFzdGljbHVucic7XG5cbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCd2aXNtb2RlbC50cycpO1xuXG5pbnRlcmZhY2UgQ2F0ZWdvcnlSZWNvcmQge1xuICBvdGhlcmRvbWFpbnM6IHN0cmluZ1tdLFxuICBuckRpc3RpbmN0VmFsdWVzOiBudW1iZXIsXG4gIG5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbjogbnVtYmVyLFxuICBuclJlY29yZHM6IG51bWJlcixcbiAgbnJSZWNvcmRzSW5Eb21haW46IG51bWJlcixcbiAgbnJUb3RhbFJlY29yZHNJbkRvbWFpbjogbnVtYmVyXG59O1xuXG52YXIgZWxhc3RpY2x1bnIgPSByZXF1aXJlKCdlbGFzdGljbHVucicpO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBKU09ORXNjYXBlKHM6IHN0cmluZykge1xuXG4gIHJldHVybiBzLnJlcGxhY2UoL1xcXFwvZywgXCJcXFxcXFxcXFwiKS5yZXBsYWNlKC9cXG4vZywgXCJcXFxcblwiKVxuICAgIC5yZXBsYWNlKC9cXCcvZywgXCJcXFxcJ1wiKVxuICAgIC5yZXBsYWNlKC9cXFwiL2csICdcXFxcXCInKVxuICAgIC5yZXBsYWNlKC9cXCYvZywgXCJcXFxcJlwiKVxuICAgIC5yZXBsYWNlKC9cXHIvZywgXCJcXFxcclwiKVxuICAgIC5yZXBsYWNlKC9cXHQvZywgXCJcXFxcdFwiKTtcbiAgLy8gLnJlcGxhY2UoL1xcYi9nLCBcIlxcXFxiXCIpXG4gIC8vIC5yZXBsYWNlKC9cXGYvZywgXCJcXFxcZlwiKTtcbn07XG5cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VMdW5ySW5kZXgobW9kZWxwYXRoOiBzdHJpbmcsIG91dHB1dDogc3RyaW5nLCBzaWxlbnQgPyA6IGJvb2xlYW4pIHtcbiAgdmFyIG1kbCA9IEpTT04ucGFyc2UoJycgKyBmcy5yZWFkRmlsZVN5bmMobW9kZWxwYXRoICsgJy5tb2RlbC5qc29uJykpO1xuICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoJycgKyBmcy5yZWFkRmlsZVN5bmMobW9kZWxwYXRoICsgJy5kYXRhLmpzb24nKSk7XG5cbiAgdmFyIGNhdHMgPSBtZGwuY2F0ZWdvcnkuZmlsdGVyKGEgPT4gdHlwZW9mIGEgIT09ICdzdHJpbmcnKTtcblxuICB2YXIgcWJlRGF0YU9iamVjdHMgPSBjYXRzLmZpbHRlcihjYXQgPT4gKGNhdC5RQkUgfHwgY2F0LlFCRUluY2x1ZGUpKTtcblxuICAvL2NvbnNvbGUubG9nKFwiaGVyZSBjYXRzXCIgKyBKU09OLnN0cmluZ2lmeShjYXRzKSk7XG4gIC8vY29uc29sZS5sb2coXCJcXG5oZXJlIGRhdGEgb2JqZWN0c1wiICsgSlNPTi5zdHJpbmdpZnkocWJlRGF0YU9iamVjdHMpKTtcbiAgdmFyIHFiZURhdGFOYW1lcyA9IHFiZURhdGFPYmplY3RzLm1hcChjYXQgPT4gY2F0Lm5hbWUpO1xuXG4gIHFiZURhdGFOYW1lcyA9IF8udW5pb24ocWJlRGF0YU5hbWVzLCBtZGwuY29sdW1ucylcblxuXG4gIHZhciBMVU5SSW5kZXggPSBjYXRzLmZpbHRlcihjYXQgPT4gY2F0LkxVTlJJbmRleCkubWFwKGNhdCA9PiBjYXQubmFtZSk7XG4gIC8vdmFyIGVsYXN0aWNsdW5yID0gcmVxdWlyZSgnbHVucicpO1xuICB2YXIgYm9tZGF0YSA9IGRhdGE7XG4gIC8vIGluZGV4IGFsbCBMVU5SIHByb3BlcnRpZXNcbiAgdmFyIGluZGV4ID0gZWxhc3RpY2x1bnIoZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICBMVU5SSW5kZXggLypcbiAgICAgICAgICAgIFtcImFwcElkXCIsXG4gICAgICAgICAgICBcIkFwcEtleVwiLFxuICAgICAgICAgICAgXCJBcHBOYW1lXCIsXG4gICAgICAgICAgICAgICAgXCJBcHBsaWNhdGlvbkNvbXBvbmVudFwiLFxuICAgICAgICAgICAgICAgIFwiUm9sZU5hbWVcIixcbiAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uVHlwZVwiLFxuICAgICAgICAgICAgICAgIFwiQlNQTmFtZVwiLFxuICAgICAgICAgICAgICAgIFwiQlNQQXBwbGljYXRpb25VUkxcIixcbiAgICAgICAgICAgICAgICBcInJlbGVhc2VOYW1lXCIsXG4gICAgICAgICAgICAgICAgXCJCdXNpbmVzc0NhdGFsb2dcIixcbiAgICAgICAgICAgICAgICBcIlRlY2huaWNhbENhdGFsb2dcIl0gKi8gLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgIHRoYXQuYWRkRmllbGQoZmllbGQpO1xuICAgICAgfSk7XG4gICAgdGhpcy5zZXRSZWYoJ2lkJyk7XG4gICAgdGhpcy5zYXZlRG9jdW1lbnQoZmFsc2UpO1xuICB9KTtcbiAgYm9tZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvLCBpbmRleCkge1xuICAgIG8uaWQgPSBpbmRleDtcbiAgfSk7XG4gIGJvbWRhdGEuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7XG4gICAgaW5kZXguYWRkRG9jKHJlY29yZCk7XG4gIH0pO1xuICB2YXIgZWxhc3RpYyA9IGluZGV4O1xuXG4gIC8vIGR1bXAgdGhlIGx1bnIgaW5kZXhcbiAgLy9cbiAgdmFyIHRoZUluZGV4ID0gaW5kZXgudG9KU09OKCk7XG4gIHZhciBjb2x1bW5zID0gbWRsLmNvbHVtbnMubWFwKGNvbG5hbWUgPT4gIHtcbiAgICB2YXIgcmVzID0gY2F0cy5maWx0ZXIoY2F0ID0+IGNhdC5uYW1lID09PSBjb2xuYW1lKTtcbiAgICBpZihyZXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRlZmluZWQgb3Igbm9uLW9iamVjdCBjb2x1bW4gOiBcIiArIGNvbG5hbWUgKTtcbiAgICB9O1xuICAgIHJldHVybiByZXNbMF07XG4gIH0pO1xuXG4gIHZhciBjb2x1bW5OYW1lcyA9IGNvbHVtbnMubWFwKGNvbCA9PiBjb2wubmFtZSk7XG5cbiAgdmFyIGpzb25wID0gYHZhciBtZGxkYXRhID0ge307XFxuLy9jb2x1bW5zIFxcbiBtZGxkYXRhLmNvbHVtbnMgPSBbXCIke2NvbHVtbnMubWFwKGNvbCA9PiBjb2wubmFtZSkuam9pbignXCIsXCInKX1cIl07YDtcblxuICB2YXIganNvbiA9IGB7IFwiY29sdW1uc1wiICA6IFtcIiR7Y29sdW1ucy5tYXAoY29sID0+IEpTT05Fc2NhcGUoY29sLm5hbWUpKS5qb2luKCdcIixcIicpfVwiXSxgO1xuICAvLyBqc29ucCArPSBgXFxuIG1kbGRhdGEuZnVsbGRhdGEgPSAke0pTT04uc3RyaW5naWZ5KGJvbWRhdGEpfTtcXG5gO1xuICAvL2pzb25wICs9IGBcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5sdW5yY29sdW1ucyA9IFtcInske0xVTlJJbmRleC5qb2luKCdcIixcIicpfVwiXTtgO1xuXG4gIGpzb25wICs9IGBcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5jb2x1bW5zRGVzY3JpcHRpb24gPSB7JHtjb2x1bW5zLm1hcChjb2wgPT5cbiAgICBgIFxcbiBcIiR7Y29sLm5hbWV9XCIgOiAgXCIke0pTT05Fc2NhcGUoY29sLmRlc2NyaXB0aW9uIHx8IGNvbC5uYW1lKX1cIiBgXG4gICkuam9pbignLCcpfVxuICAgICAgfTtgO1xuXG4gIGpzb24gKz0gYFwiY29sdW1uc0Rlc2NyaXB0aW9uXCIgOiB7JHtjb2x1bW5zLm1hcChjb2wgPT5cbiAgICBgIFxcbiBcIiR7Y29sLm5hbWV9XCIgOiAgXCIke0pTT05Fc2NhcGUoY29sLmRlc2NyaXB0aW9uIHx8IGNvbC5uYW1lKX1cIiBgXG4gICkuam9pbignLCcpfVxuICAgICAgfSxgO1xuXG5cbiAganNvbnAgKz0gYFxcbi8vY29sdW1ucyBpbmZvIFxcbiBtZGxkYXRhLmNvbHVtbnNEZWZhdWx0V2lkdGggPSB7JHtjb2x1bW5zLm1hcChjb2wgPT5cbiAgICBgIFxcbiBcIiR7Y29sLm5hbWV9XCIgOiAke2NvbC5kZWZhdWx0V2lkdGggfHwgMTUwfSBgXG4gICkuam9pbignLCcpfVxuICAgICAgfTtgO1xuXG4gIGpzb24gKz0gYFxcblwiY29sdW1uc0RlZmF1bHRXaWR0aFwiIDogeyR7Y29sdW1ucy5tYXAoY29sID0+XG4gICAgYCBcXG4gXCIke2NvbC5uYW1lfVwiIDogJHtjb2wuZGVmYXVsdFdpZHRoIHx8IDE1MH0gYFxuICApLmpvaW4oJywnKX1cbiAgICAgIH0sYDtcblxuXG5cbiAgdmFyIHRoZUluZGV4U3RyID0gSlNPTi5zdHJpbmdpZnkodGhlSW5kZXgpO1xuXG4gIGpzb25wICs9IFwiXFxudmFyIHNlckluZGV4ID1cXFwiXCIgKyBKU09ORXNjYXBlKHRoZUluZGV4U3RyKSArIFwiXFxcIjtcXG5cIjtcbiAgLy8ganNvbnAgKz0gXCJcXG52YXIgc2VySW5kZXggPVwiICsgSlNPTi5zdHJpbmdpZnkodGhlSW5kZXgpICsgXCI7XFxuXCI7XG5cblxuICBqc29uICs9ICdcXG5cInNlckluZGV4XCIgOicgKyB0aGVJbmRleFN0ciArICAnLCc7XG5cbiAgLy9jb25zb2xlLmxvZyhcImhlcmUgYWxsIG5hbWVzIFwiICsgSlNPTi5zdHJpbmdpZnkocWJlRGF0YU5hbWVzKSk7XG4gIHZhciBjbGVhbnNlZGRhdGEgPSBib21kYXRhLm1hcChvID0+IHtcbiAgICB2YXIgcmVzID0ge307XG4gICAgcWJlRGF0YU5hbWVzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIHJlc1trZXldID0gb1trZXldO1xuICAgIH0pO1xuICAgIHJldHVybiByZXM7XG4gIH0pO1xuXG4gIGlmKCFzaWxlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhcImR1bXBpbmcgXCIgKyBvdXRwdXQpO1xuICAgIGNvbnNvbGUubG9nKFwibGVuZ3RoIG9mIGluZGV4IHN0clwiICsgdGhlSW5kZXhTdHIubGVuZ3RoKVxuICAgIGNvbnNvbGUubG9nKFwiYXZhaWxhYmxlICAgICAgICAgIFwiICsgY29sdW1ucy5sZW5ndGggKyBcIiBjb2x1bW5zXCIpO1xuICAgIGNvbnNvbGUubG9nKFwicmV0dXJuaW5nIGFzIGRhdGEgIFwiICsgcWJlRGF0YU5hbWVzLmxlbmd0aCArIFwiIGNvbHVtbnNcIik7XG4gICAgY29uc29sZS5sb2coXCJpbmRleGluZyAgICAgICAgICAgXCIgKyBMVU5SSW5kZXgubGVuZ3RoICsgXCIgY29sdW1uc1wiKTtcbiAgICBjb25zb2xlLmxvZygncmV0dXJuZWQgYnV0IG5vdCBhdmFpbGFibGUnICwgXy5kaWZmZXJlbmNlKHFiZURhdGFOYW1lcywgY29sdW1uTmFtZXMpLmpvaW4oXCIsIFwiKSk7XG4gICAgY29uc29sZS5sb2coJ3JldHVybmVkIGJ1dCBub3QgaW5kZXhlZCcgLCBfLmRpZmZlcmVuY2UocWJlRGF0YU5hbWVzLCBMVU5SSW5kZXgpLmpvaW4oXCIsIFwiKSk7XG4gIH1cblxuICBqc29ucCArPSBcInZhciBkYXRhPVwiICsgSlNPTi5zdHJpbmdpZnkoY2xlYW5zZWRkYXRhKSArIFwiO1wiO1xuXG4gIGpzb24gKz0gJ1wiZGF0YVwiOicgKyBKU09OLnN0cmluZ2lmeShjbGVhbnNlZGRhdGEpICsgXCJcXG59XCI7XG5cbiAganNvbnAgKz0gYFxuXG4gICAgICAgICAgIC8vIHZhciBlbGFzdGljID0gZWxhc3RpY2x1bnIuSW5kZXgubG9hZChzZXJJbmRleCk7XG5cbiAgYDtcblxuICAvL2ZzLndyaXRlRmlsZVN5bmMob3V0cHV0ICsgXCIubHVuci5qc1wiLCBqc29ucCk7XG4gIGZzLndyaXRlRmlsZVN5bmMob3V0cHV0ICsgXCIubHVuci5qc29uXCIsIGpzb24pO1xufVxuXG5cblxuXG5cbi8qXG5cbiAgdmFyIGluZGV4ID0gZWxhc3RpbHVuci5JbmRleC5sb2FkKG9iaik7XG5cblxufVxuXG4gXCJRQkVcIiA6IGZhbHNlLFxuICAgICAgXCJRQkVJbmNsdWRlXCIgOiB0cnVlLFxuICAgICAgXCJMVU5SSW5kZXhcIjogZmFsc2VcbiovXG5cblxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0NhdGVnb3J5UmVjb3JkKG06IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeTogc3RyaW5nLCBkb21haW46IHN0cmluZyk6IENhdGVnb3J5UmVjb3JkIHtcblxuICB2YXIgb3RoZXJkb21haW5zID0gTW9kZWwuZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG0sIGNhdGVnb3J5KTtcbiAgXy5wdWxsKG90aGVyZG9tYWlucywgZG9tYWluKTtcbiAgdmFyIHJlcyA9IHtcbiAgICBvdGhlcmRvbWFpbnM6IG90aGVyZG9tYWlucyxcbiAgICBuckRpc3RpbmN0VmFsdWVzOiAwLFxuICAgIG5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbjogMCxcbiAgICBuclJlY29yZHM6IDAsXG4gICAgbnJSZWNvcmRzSW5Eb21haW46IDAsXG4gICAgbnJUb3RhbFJlY29yZHNJbkRvbWFpbjogMCxcbiAgfSBhcyBDYXRlZ29yeVJlY29yZDtcblxuICB2YXIgdmFsdWVzID0gW107XG4gIHZhciB2YWx1ZXNJbkRvbWFpbiA9IFtdO1xuICB2YXIgbnJSZWNvcmRzSW5Eb21haW4gPSAwO1xuICB2YXIgZGlzdGluY3RWYWx1ZXMgPSBtLnJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAob0VudHJ5KSB7XG4gICAgaWYgKG9FbnRyeS5fZG9tYWluID09PSBkb21haW4pIHtcbiAgICAgIHJlcy5uclRvdGFsUmVjb3Jkc0luRG9tYWluICs9IDE7XG4gICAgfVxuICAgIGlmIChvRW50cnlbY2F0ZWdvcnldKSB7XG4gICAgICB2YXIgdmFsdWUgPSBvRW50cnlbY2F0ZWdvcnldO1xuICAgICAgaWYgKG9FbnRyeS5fZG9tYWluID09PSBkb21haW4pIHtcbiAgICAgICAgdmFsdWVzSW5Eb21haW5bdmFsdWVdID0gKHZhbHVlc0luRG9tYWluW3ZhbHVlXSB8fCAwKSArIDE7XG4gICAgICAgIHJlcy5uclJlY29yZHNJbkRvbWFpbiArPSAxO1xuICAgICAgfVxuICAgICAgdmFsdWVzW3ZhbHVlXSA9ICh2YWx1ZXNbdmFsdWVdIHx8IDApICsgMTtcbiAgICAgIHJlcy5uclJlY29yZHMgKz0gMTtcbiAgICB9XG4gIH0pO1xuICByZXMubnJEaXN0aW5jdFZhbHVlcyA9IE9iamVjdC5rZXlzKHZhbHVlcykubGVuZ3RoO1xuICByZXMubnJEaXN0aW5jdFZhbHVlc0luRG9tYWluID0gT2JqZWN0LmtleXModmFsdWVzSW5Eb21haW4pLmxlbmd0aDtcbiAgcmV0dXJuIHJlcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdyYXBoRG9tYWluKGRvbWFpbjogc3RyaW5nLCBtOiBJTWF0Y2guSU1vZGVscykge1xuICAvLyBkcmF3IGEgbW9kZWwgZG9tYWluc1xuICB2YXIgcmVzID0gYFxuICAgIGRpZ3JhcGggc2RzdSB7XG5cdHNpemU9XCIzNiwzNlwiO1xuICAgcmFua2Rpcj1MUlxuXHRub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XG4gICAgXCIke2RvbWFpbn1cIlxuICBgO1xuICAvLyBhZGQgYWxsIGNhdGVnb3J5IG5vZGVzXG4gIHJlcyArPSBgbm9kZSBbc2hhcGU9cmVjb3JkLCBjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XFxuIGBcbiAgdmFyIGNhdHMgPSBNb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKG0sIGRvbWFpbik7XG5cbiAgdmFyIGNhdGVnb3J5UmVzdWx0cyA9IHt9O1xuICB2YXIgb3RoZXJkb21haW5zID0gW107XG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXQsIGRvbWFpbik7XG4gICAgY2F0ZWdvcnlSZXN1bHRzW2NhdF0gPSBjYXRSZXN1bHQ7XG4gICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4gICAgcmVzICs9IGBcIiR7Y2F0fVwiIFtsYWJlbD1cInsgJHtjYXR9IHwgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWlufSBWYWx1ZXMgaW4gJHtjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IGA7XG4gICAgaWYgKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgcmVzICs9IGB8ICAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzIC0gY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbn0gb3RoZXIgdmFsdWVzIGluICR7Y2F0UmVzdWx0Lm5yUmVjb3JkcyAtIGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gb3RoZXIgcmVjb3Jkc2A7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcyArPSBgIGA7XG4gICAgfVxuICAgIHJlcyArPSBgfVwiXVxcbmA7XG4gIH0pO1xuXG4gIC8vIGNhbGN1bGF0ZSBvdGhlciBkb21haW5zLlxuICAvLyBkcmF3IFwib3RoZXIgY2F0ZWdvcmllc1wiXG4gIHJlcyArPSBgbm9kZSBbY29sb3I9cHVycGxlLCBzdHlsZT1maWxsZWRdOyBcXG5gXG4gIG90aGVyZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChvdGhlcmRvbWFpbikge1xuICAgIHJlcyArPSBgXCIke290aGVyZG9tYWlufVwiIFxcbmA7XG4gIH0pO1xuICAvLyBjb3VudCByZWNvcmRzIGluIGRvbWFpbiA6XG4gIHZhciBuclJlY29yZHMgPSBtLnJlY29yZHMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBlbnRyeSkge1xuICAgIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICB9LCAwKTtcbiAgcmVzICs9IGBub2RlIFtzaGFwZT1yZWNvcmRdOyBcXG5gXG4gIHJlcyArPSBgIFwicmVjb3JkXCIgW2xhYmVsPVwiezxmMD4gJHtkb21haW59IHwgJHtuclJlY29yZHN9fVwiXSBcXG5gO1xuXG4gIHJlcyArPSBgIFwicl9vdGhlclwiIFtsYWJlbD1cIns8ZjA+IG90aGVyIHwgJHtuclJlY29yZHN9fVwiXSBcXG4gYDtcblxuICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIGRvbWFpblxcbmA7XG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgcmVzICs9IGAgXCIke2NhdH1cIiAtPiBcIiR7ZG9tYWlufVwiIFxcbmA7XG4gIH0pXG5cblxuICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIHJlY29yZHNcXG5gO1xuICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwicmVjb3JkXCIgXFxuYDtcbiAgfSlcblxuXG4gIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG5cblxuICB9KVxuXG4gIC8qXG4gIGNhdHMgZm9cbiAgICBkaWdyYXBoIHNkc3Uge1xuXHRzaXplPVwiMzYsMzZcIjtcblx0bm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xuXHRGTFBEIEZMUCBcIkJPTSBFZGl0b3JcIiwgXCJXSUtJVVJMXCIgXCJVSTUgRG9jdW1lbnRhdGlvblwiLCBcIlVJNSBFeGFtcGxlXCIsIFwiU1RBUlRUQVwiXG5cdEJDUFxuXHRub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuXHRub2RlIFtmb250bmFtZT1cIlZlcmRhbmFcIiwgc2l6ZT1cIjMwLDMwXCJdO1xuXHRub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuXHRncmFwaCBbIGZvbnRuYW1lID0gXCJBcmlhbFwiLFxuICAqL1xuICByZXMgKz0gYH1cXG5gO1xuICByZXR1cm4gcmVzO1xufVxuLypcbiAgICBjYXRlZ29yeURlc2MgOiB0aGVNb2RlbC5mdWxsLmRvbWFpbltmaWx0ZXJkb21haW5dLmNhdGVnb3JpZXNbY2F0ZWdvcnldLFxuICAgIGRpc3RpbmN0IDogZGlzdGluY3QsXG4gICAgZGVsdGEgOiBkZWx0YSxcbiAgICBwcmVzZW50UmVjb3JkcyA6IHJlY29yZENvdW50LnByZXNlbnRyZWNvcmRzLFxuICAgIHBlcmNQcmVzZW50IDogcGVyY2VudCxcbiAgICBzYW1wbGVWYWx1ZXMgOiB2YWx1ZXNMaXN0XG4gIH1cbiovXG5cbmZ1bmN0aW9uIHJlcGxhY2VCcihzdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XG4gIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9cXG4vZyxcbiAgICBgXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRiclxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0fCBgXG4gICk7XG4gIHJldHVybiBzdHJpbmc7XG59XG5cblxuXG5cbi8qKlxuICogZ2VuZXJhdGUgYSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIGEgZG9tYWluXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YWJEb21haW4oZG9tYWluOiBzdHJpbmcsIG06IElNYXRjaC5JTW9kZWxzKSB7XG4gIC8vIGRyYXcgYSBtb2RlbCBkb21haW5zXG5cbiAgdmFyIGNhdHMgPSBNb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKG0sIGRvbWFpbik7XG4gIGNhdHMgPSBNb2RlbC5zb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZShtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllcyB8fCB7fSwgY2F0cyk7XG4gIC8vY29uc29sZS5sb2coY2F0cy5qb2luKFwiXFxuXCIpKTtcbiAgdmFyIGNhdGRlc2MgPSBEZXNjcmliZS5nZXRDYXRlZ29yeVN0YXRzSW5Eb21haW4oY2F0c1swXSwgZG9tYWluLCBtKTtcbiAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXRzWzBdLCBkb21haW4pO1xuXG4gIHZhciBkb21haW5EZXNjciA9IG0uZnVsbC5kb21haW5bZG9tYWluXS5kZXNjcmlwdGlvbiB8fCBcIlwiO1xuICBkb21haW5EZXNjciA9IHJlcGxhY2VCcihkb21haW5EZXNjcik7XG4gIHZhciByZXMgPSBgXG5cbi8vIHByZXNldCBmb3JtIHZhbHVlcyBpZiB3ZSByZWNlaXZlIGEgdXNlcmRhdGEgb2JqZWN0IC8vXG4tIHVzZXIgPSB1c2VyXG5cbmV4dGVuZHMgLi4vbGF5b3V0X3BcblxuYmxvY2sgY29udGVudFxuXG5cdG5hdi5uYXZiYXIubmF2YmFyLWRlZmF1bHQubmF2YmFyLWZpeGVkLXRvcFxuXHRcdC5jb250YWluZXJcblx0XHRcdC5uYXZiYXItaGVhZGVyXG5cdFx0XHRcdC5uYXZiYXItYnJhbmQoc3R5bGU9J2JnY29sb3I6b3JhbmdlO2NvbG9yOmRhcmtibHVlO2ZvbnQtZmFtaWx5OkFyaWFsIEJsYWNrO2ZvbnQtc2l6ZToxNS4xMThweCcpIHdvc2FwIGRvbWFpbiAke2RvbWFpbn1cblx0XHRcdHVsLm5hdi5uYXZiYXItbmF2Lm5hdmJhci1yaWdodCAje3VpZH1cblx0XHRcdFx0bGlcblx0XHRcdFx0XHQubmF2YmFyLWJ0biNidG4tbG9nb3V0LmJ0bi5idG4tZGVmYXVsdChvbmNsaWNrPVwibG9jYXRpb24uaHJlZj0nL2hvbWUnXCIpXG5cdFx0XHRcdFx0XHR8IGJhY2sgdG8gaG9tZVxuXG5cdHAgICZuYnNwO1xuXHRwICZuYnNwO1xuXHRwXG5cblx0ZGl2LndlbGxcblx0XHRoMyBkb21haW4gXCIke2RvbWFpbn1cIlxuXHRcdFx0c3Bhbi5wdWxsLXJpZ2h0ICR7Y2F0UmVzdWx0Lm5yVG90YWxSZWNvcmRzSW5Eb21haW59IHJlY29yZHNcblx0XHRwXG5cdFx0c3BhbiAke2RvbWFpbkRlc2NyfVxuXG5cdFx0dGFibGUudGFibGUudGFibGUtY29uZGVuc2VkLnRhYmxlLXN0cmlwZWRcblx0XHRcdHRoZWFkXG5cdFx0XHRcdHRyXG5cdFx0XHRcdFx0dGggY2F0ZWdvcnlcblx0XHRcdFx0XHR0aChzdHlsZT1cIndpZHRoOjEwJVwiKSBjb3VudFxuXHRcdFx0XHRcdHRoXG5cdFx0XHRcdFx0XHR0YWJsZVxuXHRcdFx0XHRcdFx0XHR0clxuXHRcdFx0XHRcdFx0XHRcdHRkIHN5bm9ueW1zXG5cdFx0XHRcdFx0XHRcdHRyXG5cdFx0XHRcdFx0XHRcdFx0dGQgZGVzY3JpcHRpb25cblx0XHRcdFx0XHRcdFx0dHJcblx0XHRcdFx0XHRcdFx0XHR0ZCBleGFtcGxlIHZhbHVlc1xuXHRcdFx0dGJvZHlcbmA7XG5cbiAgdmFyIGNhdGVnb3J5UmVzdWx0cyA9IHt9O1xuICB2YXIgb3RoZXJkb21haW5zID0gW107XG4gIHZhciBjYXRlZ29yeU1hcCA9IG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzIHx8IHt9O1xuICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdCwgZG9tYWluLCBtKTtcbiAgICAvL2NvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNhdGRlc2MpKTtcbiAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdCwgZG9tYWluKTtcbiAgICBjYXRlZ29yeVJlc3VsdHNbY2F0XSA9IGNhdFJlc3VsdDtcbiAgICBvdGhlcmRvbWFpbnMgPSBfLnVuaW9uKG90aGVyZG9tYWlucywgY2F0ZWdvcnlSZXN1bHRzW2NhdF0ub3RoZXJEb21haW5zKTtcbiAgICAvKlxuICAgICAgICByZXMgKz0gYFwiJHtjYXR9XCIgW2xhYmVsPVwieyAke2NhdH0gfCAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IFZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gYDtcbiAgICAgICAgaWYoY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWluICE9PSBjYXRSZXN1bHQubnJSZWNvcmRzKSB7XG4gICAgICAgICAgcmVzICs9ICBgfCAgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlcyAtIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IG90aGVyIHZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHMgLSBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IG90aGVyIHJlY29yZHNgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcyArPSBgIGA7XG4gICAgICAgIH1cbiAgICAgICAgcmVzICs9IGB9XCJdXFxuYDtcbiAgICAqL1xuICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkobS5mdWxsLmRvbWFpbltkb21haW5dKSk7XG4gICAgaWYgKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzW2NhdF0pIHtcblxuICAgICAgdmFyIHN5bm9ueW1zU3RyaW5nID0gVXRpbC5saXN0VG9Db21tYUFuZChjYXRkZXNjLmNhdGVnb3J5RGVzYyAmJiBjYXRkZXNjLmNhdGVnb3J5RGVzYy5zeW5vbnltcyAmJiBjYXRkZXNjLmNhdGVnb3J5RGVzYy5zeW5vbnltcyB8fCBbXSkgfHwgXCImbmJzcDtcIjtcblxuICAgICAgcmVzICs9IGBcblx0XHRcdHRyXG5cdFx0XHRcdFx0dGQuY2F0X2NvdW50ICR7Y2F0fVxuXFx0XFx0XFx0XFx0XFx0dGQgJHtjYXRkZXNjLnByZXNlbnRSZWNvcmRzfSBkaXN0aW5jdCB2YWx1ZXMgaW4gJHtjYXRkZXNjLnBlcmNQcmVzZW50fSUgb2YgcmVjb3Jkc1xuXFx0XFx0XFx0XFx0XFx0dGRcblxcdFxcdFxcdFxcdFxcdFxcdHRhYmxlXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfc3lub255bXNcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkICR7c3lub255bXNTdHJpbmd9XG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfZGVzY3JpcHRpb25cblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkICR7cmVwbGFjZUJyKGNhdGRlc2MuY2F0ZWdvcnlEZXNjICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLmRlc2NyaXB0aW9uIHx8IFwiXCIpfVxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X3NhbXBsZXZhbHVlc1xuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgJHtyZXBsYWNlQnIoY2F0ZGVzYy5zYW1wbGVWYWx1ZXMpfVxuICAgICAgYDtcbiAgICB9XG5cbiAgfSk7XG5cbiAgdmFyIG90aGVyY2F0cyA9IGNhdHMubGVuZ3RoIC0gT2JqZWN0LmtleXMobS5mdWxsLmRvbWFpbltkb21haW5dLmNhdGVnb3JpZXMpLmxlbmd0aDtcbiAgdmFyIHJlbWFpbmluZ0NhdGVnb3JpZXMgPSBfLmRpZmZlcmVuY2UoY2F0cywgT2JqZWN0LmtleXMobS5mdWxsLmRvbWFpbltkb21haW5dLmNhdGVnb3JpZXMpKTtcbiAgaWYgKChvdGhlcmNhdHMpID4gMCkge1xuICAgIHJlcyArPSBgXG5cXHRcXHRwICAgYW5kICR7b3RoZXJjYXRzfSBvdGhlciBjYXRlZ29yaWVzXG5cXHRcXHR8ICR7VXRpbC5saXN0VG9Db21tYUFuZChyZW1haW5pbmdDYXRlZ29yaWVzKX1cbiAgICAgICBgXG5cbiAgfVxuICAvKlxuICAgIC8vIGNhbGN1bGF0ZSBvdGhlciBkb21haW5zLlxuICAgIC8vIGRyYXcgXCJvdGhlciBjYXRlZ29yaWVzXCJcbiAgICByZXMgKz0gYG5vZGUgW2NvbG9yPXB1cnBsZSwgc3R5bGU9ZmlsbGVkXTsgXFxuYFxuICAgIG90aGVyZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKG90aGVyZG9tYWluKSB7XG4gICAgICByZXMgKz0gYFwiJHtvdGhlcmRvbWFpbn1cIiBcXG5gO1xuICAgIH0pO1xuICAgIC8vIGNvdW50IHJlY29yZHMgaW4gZG9tYWluIDpcbiAgICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbihwcmV2LGVudHJ5KSB7XG4gICAgcmV0dXJuIHByZXYgKyAoKGVudHJ5Ll9kb21haW4gPT09IGRvbWFpbikgPyAxIDogMCk7XG4gICAgfSwwKTtcbiAgICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZF07IFxcbmBcbiAgICByZXMgKz0gYCBcInJlY29yZFwiIFtsYWJlbD1cIns8ZjA+ICR7ZG9tYWlufSB8ICR7bnJSZWNvcmRzfX1cIl0gXFxuYDtcblxuICAgIHJlcyArPSBgIFwicl9vdGhlclwiIFtsYWJlbD1cIns8ZjA+IG90aGVyIHwgJHtuclJlY29yZHN9fVwiXSBcXG4gYDtcblxuICAgIHJlcyArPSBgIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gZG9tYWluXFxuYDtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XG4gICAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwiJHtkb21haW59XCIgXFxuYDtcbiAgICB9KVxuXG5cbiAgICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIHJlY29yZHNcXG5gO1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcbiAgICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCJyZWNvcmRcIiBcXG5gO1xuICAgIH0pXG5cblxuICAgIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuXG5cbiAgICB9KVxuICAqL1xuICAvKlxuICBjYXRzIGZvXG4gICAgZGlncmFwaCBzZHN1IHtcblx0c2l6ZT1cIjM2LDM2XCI7XG5cdG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcblx0RkxQRCBGTFAgXCJCT00gRWRpdG9yXCIsIFwiV0lLSVVSTFwiIFwiVUk1IERvY3VtZW50YXRpb25cIiwgXCJVSTUgRXhhbXBsZVwiLCBcIlNUQVJUVEFcIlxuXHRCQ1Bcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0bm9kZSBbZm9udG5hbWU9XCJWZXJkYW5hXCIsIHNpemU9XCIzMCwzMFwiXTtcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0Z3JhcGggWyBmb250bmFtZSA9IFwiQXJpYWxcIixcbiAgKi9cbiAgcmVzICs9IGBcblx0XHRoMyBWZXJzaW9uXG5cdFx0XHRhLnNtYWxsKGhyZWY9XCIvd2hhdHNuZXdcIilcblxuXG5ibG9jayBzY3JpcHRzXG5cdHNjcmlwdChzcmM9Jy92ZW5kb3IvanF1ZXJ5LTIuMi4zLm1pbi5qcycpXG5cdHNjcmlwdChzcmM9Jy92ZW5kb3IvYm9vdHN0cmFwLm1pbi5qcycpXG5cdHNjcmlwdChzcmM9Jy9qcy92aWV3cy9zZXR0aW5ncy5qcycpXG5gO1xuICByZXR1cm4gcmVzO1xufVxuXG5cblxuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuXG5cbmZ1bmN0aW9uIGV4ZWNDbWQoY21kOiBzdHJpbmcpIHtcbiAgZXhlYyhjbWQsIGZ1bmN0aW9uIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYGV4ZWMgZXJyb3I6ICR7ZXJyb3J9YClcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgc3Rkb3V0OiAke3N0ZG91dH1gKVxuICAgIGNvbnNvbGUubG9nKGBzdGRlcnI6ICR7c3RkZXJyfWApXG4gIH0pXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdmlzTW9kZWxzKG06IElNYXRjaC5JTW9kZWxzLCBmb2xkZXJPdXQ6IHN0cmluZykge1xuICBtLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoc0RvbWFpbikge1xuICAgIHZhciBzID0gZ3JhcGhEb21haW4oc0RvbWFpbiwgbSk7XG4gICAgdmFyIGZuR3JhcGggPSBmb2xkZXJPdXQgKyBcIi9cIiArIHNEb21haW4ucmVwbGFjZSgvIC9nLCAnXycpICsgXCIuZ3ZcIjtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICAgIGlmIChwcm9jZXNzLmVudi5HUkFQSFZJWikge1xuICAgICAgY29uc29sZS5sb2coXCJoZXJlIHRoZSBmaWxlIFwiICsgZm5HcmFwaCk7XG4gICAgICBleGVjQ21kKHByb2Nlc3MuZW52LkdSQVBIVklaICsgXCIgLVRqcGVnIC1PIFwiICsgZm5HcmFwaCk7XG4gICAgfVxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRhYk1vZGVscyhtOiBJTWF0Y2guSU1vZGVscywgZm9sZGVyT3V0OiBzdHJpbmcpIHtcbiAgbS5kb21haW5zLmZvckVhY2goZnVuY3Rpb24gKHNEb21haW4pIHtcbiAgICB2YXIgcyA9IHRhYkRvbWFpbihzRG9tYWluLCBtKTtcbiAgICB2YXIgZm5HcmFwaCA9IGZvbGRlck91dCArIFwiL1wiICsgc0RvbWFpbi5yZXBsYWNlKC8gL2csICdfJykgKyBcIi5qYWRlXCI7XG4gICAgZGVidWdsb2coXCJoZXJlIHRoZSBmaWxlIFwiICsgZm5HcmFwaCk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhmbkdyYXBoLCBzKTtcbiAgfSk7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
