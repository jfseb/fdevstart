"use strict";
/**
 * Functionality to execute a certain response on the server,
 * interpreting a general model context
 *
 *
 * via a) commandline (e.g. browser startup)
 * @file
 * @copyright (c) 2016 Gerd Forstmann
 */

Object.defineProperty(exports, "__esModule", { value: true });
var debug = require("debug");
var debuglog = debug('execserver');
var Toolmatch = require("../match/toolmatch");
var Exectemplate = require("./exectemplate");
function noStar(a, b) {
    if (b === '*') {
        return a;
    }
    if (a === '*') {
        return b;
    }
    if (a !== b) {
        throw new Error('Illegal Argument no match ' + a + " " + b);
    }
    return b;
}
exports.noStar = noStar;
function makeGenericText(match, setId, record) {
    var res = "start " + match.tool.name;
    var set = match.tool.sets[setId];
    var context = Toolmatch.makeMatchSet(match, set);
    set.set.forEach(function (category, index) {
        var value = noStar(context[category], record[category]);
        var prefix = "";
        if (index === 0) {
            prefix += ' using ';
        } else if (index === set.set.length - 1) {
            prefix += ' and ';
        } else {
            prefix = '; ';
        }
        if (category === "category") {
            res = res + prefix + '"' + value + '"';
        }
        res = res + prefix + category + ' "' + value + '"';
    });
    return res;
}
exports.makeGenericText = makeGenericText;
function execTool(match, records, bExplain) {
    //
    debuglog("records for match " + JSON.stringify(match));
    var matchSetRecord = Toolmatch.findFirstSetRecord(match, records);
    if (!matchSetRecord) {
        return {
            text: "cannot start",
            action: {}
        };
    }
    ;
    var set = match.tool.sets[matchSetRecord.setId];
    var pattern = matchSetRecord.record[set.response];
    var context = Toolmatch.makeMatchSet(match, set);
    var url = Exectemplate.expandTemplate(context, pattern);
    var text = "";
    debuglog("record " + JSON.stringify("matchSetRecord "));
    var patternText = matchSetRecord.record["_text" + set.response];
    if (patternText) {
        text = Exectemplate.expandTemplate(context, patternText);
    } else {
        text = makeGenericText(match, matchSetRecord.setId, matchSetRecord.record);
    }
    return {
        text: text,
        action: { url: url }
    };
}
exports.execTool = execTool;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4ZWMvZXhlY3NlcnZlci5qcyIsIi4uL3NyYy9leGVjL2V4ZWNzZXJ2ZXIudHMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWJ1ZyIsInJlcXVpcmUiLCJkZWJ1Z2xvZyIsIlRvb2xtYXRjaCIsIkV4ZWN0ZW1wbGF0ZSIsIm5vU3RhciIsImEiLCJiIiwiRXJyb3IiLCJtYWtlR2VuZXJpY1RleHQiLCJtYXRjaCIsInNldElkIiwicmVjb3JkIiwicmVzIiwidG9vbCIsIm5hbWUiLCJzZXQiLCJzZXRzIiwiY29udGV4dCIsIm1ha2VNYXRjaFNldCIsImZvckVhY2giLCJjYXRlZ29yeSIsImluZGV4IiwicHJlZml4IiwibGVuZ3RoIiwiZXhlY1Rvb2wiLCJyZWNvcmRzIiwiYkV4cGxhaW4iLCJKU09OIiwic3RyaW5naWZ5IiwibWF0Y2hTZXRSZWNvcmQiLCJmaW5kRmlyc3RTZXRSZWNvcmQiLCJ0ZXh0IiwiYWN0aW9uIiwicGF0dGVybiIsInJlc3BvbnNlIiwidXJsIiwiZXhwYW5kVGVtcGxhdGUiLCJwYXR0ZXJuVGV4dCJdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTs7Ozs7Ozs7OztBRFVBQSxPQUFPQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QyxFQUFFQyxPQUFPLElBQVQsRUFBN0M7QUNFQSxJQUFBQyxRQUFBQyxRQUFBLE9BQUEsQ0FBQTtBQUlBLElBQU1DLFdBQVdGLE1BQU0sWUFBTixDQUFqQjtBQVdBLElBQUFHLFlBQUFGLFFBQUEsb0JBQUEsQ0FBQTtBQUVBLElBQUFHLGVBQUFILFFBQUEsZ0JBQUEsQ0FBQTtBQUVBLFNBQUFJLE1BQUEsQ0FBdUJDLENBQXZCLEVBQWtDQyxDQUFsQyxFQUEyQztBQUN6QyxRQUFJQSxNQUFNLEdBQVYsRUFBZTtBQUNiLGVBQU9ELENBQVA7QUFDRDtBQUNELFFBQUlBLE1BQU0sR0FBVixFQUFlO0FBQ2IsZUFBT0MsQ0FBUDtBQUNEO0FBQ0Qs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LEtBQVA7QUFJRDtBQTlCRHRDLFFBQUEyQixRQUFBLEdBQUFBLFFBQUEiLCJmaWxlIjoiZXhlYy9leGVjc2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vKipcbiAqIEZ1bmN0aW9uYWxpdHkgdG8gZXhlY3V0ZSBhIGNlcnRhaW4gcmVzcG9uc2Ugb24gdGhlIHNlcnZlcixcbiAqIGludGVycHJldGluZyBhIGdlbmVyYWwgbW9kZWwgY29udGV4dFxuICpcbiAqXG4gKiB2aWEgYSkgY29tbWFuZGxpbmUgKGUuZy4gYnJvd3NlciBzdGFydHVwKVxuICogQGZpbGVcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgZGVidWcgPSByZXF1aXJlKFwiZGVidWdcIik7XG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdleGVjc2VydmVyJyk7XG5jb25zdCBUb29sbWF0Y2ggPSByZXF1aXJlKFwiLi4vbWF0Y2gvdG9vbG1hdGNoXCIpO1xuY29uc3QgRXhlY3RlbXBsYXRlID0gcmVxdWlyZShcIi4vZXhlY3RlbXBsYXRlXCIpO1xuZnVuY3Rpb24gbm9TdGFyKGEsIGIpIHtcbiAgICBpZiAoYiA9PT0gJyonKSB7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH1cbiAgICBpZiAoYSA9PT0gJyonKSB7XG4gICAgICAgIHJldHVybiBiO1xuICAgIH1cbiAgICBpZiAoYSAhPT0gYikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lsbGVnYWwgQXJndW1lbnQgbm8gbWF0Y2ggJyArIGEgKyBcIiBcIiArIGIpO1xuICAgIH1cbiAgICByZXR1cm4gYjtcbn1cbmV4cG9ydHMubm9TdGFyID0gbm9TdGFyO1xuZnVuY3Rpb24gbWFrZUdlbmVyaWNUZXh0KG1hdGNoLCBzZXRJZCwgcmVjb3JkKSB7XG4gICAgdmFyIHJlcyA9IFwic3RhcnQgXCIgKyBtYXRjaC50b29sLm5hbWU7XG4gICAgdmFyIHNldCA9IG1hdGNoLnRvb2wuc2V0c1tzZXRJZF07XG4gICAgdmFyIGNvbnRleHQgPSBUb29sbWF0Y2gubWFrZU1hdGNoU2V0KG1hdGNoLCBzZXQpO1xuICAgIHNldC5zZXQuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnksIGluZGV4KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IG5vU3Rhcihjb250ZXh0W2NhdGVnb3J5XSwgcmVjb3JkW2NhdGVnb3J5XSk7XG4gICAgICAgIHZhciBwcmVmaXggPSBcIlwiO1xuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIHByZWZpeCArPSAnIHVzaW5nICc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5kZXggPT09IHNldC5zZXQubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgcHJlZml4ICs9ICcgYW5kICc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwcmVmaXggPSAnOyAnO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJjYXRlZ29yeVwiKSB7XG4gICAgICAgICAgICByZXMgPSByZXMgKyBwcmVmaXggKyAnXCInICsgdmFsdWUgKyAnXCInO1xuICAgICAgICB9XG4gICAgICAgIHJlcyA9IHJlcyArIHByZWZpeCArIGNhdGVnb3J5ICsgJyBcIicgKyB2YWx1ZSArICdcIic7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMubWFrZUdlbmVyaWNUZXh0ID0gbWFrZUdlbmVyaWNUZXh0O1xuZnVuY3Rpb24gZXhlY1Rvb2wobWF0Y2gsIHJlY29yZHMsIGJFeHBsYWluKSB7XG4gICAgLy9cbiAgICBkZWJ1Z2xvZyhcInJlY29yZHMgZm9yIG1hdGNoIFwiICsgSlNPTi5zdHJpbmdpZnkobWF0Y2gpKTtcbiAgICB2YXIgbWF0Y2hTZXRSZWNvcmQgPSBUb29sbWF0Y2guZmluZEZpcnN0U2V0UmVjb3JkKG1hdGNoLCByZWNvcmRzKTtcbiAgICBpZiAoIW1hdGNoU2V0UmVjb3JkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZXh0OiBcImNhbm5vdCBzdGFydFwiLFxuICAgICAgICAgICAgYWN0aW9uOiB7fVxuICAgICAgICB9O1xuICAgIH1cbiAgICA7XG4gICAgdmFyIHNldCA9IG1hdGNoLnRvb2wuc2V0c1ttYXRjaFNldFJlY29yZC5zZXRJZF07XG4gICAgdmFyIHBhdHRlcm4gPSBtYXRjaFNldFJlY29yZC5yZWNvcmRbc2V0LnJlc3BvbnNlXTtcbiAgICB2YXIgY29udGV4dCA9IFRvb2xtYXRjaC5tYWtlTWF0Y2hTZXQobWF0Y2gsIHNldCk7XG4gICAgdmFyIHVybCA9IEV4ZWN0ZW1wbGF0ZS5leHBhbmRUZW1wbGF0ZShjb250ZXh0LCBwYXR0ZXJuKTtcbiAgICB2YXIgdGV4dCA9IFwiXCI7XG4gICAgZGVidWdsb2coXCJyZWNvcmQgXCIgKyBKU09OLnN0cmluZ2lmeShcIm1hdGNoU2V0UmVjb3JkIFwiKSk7XG4gICAgdmFyIHBhdHRlcm5UZXh0ID0gbWF0Y2hTZXRSZWNvcmQucmVjb3JkW1wiX3RleHRcIiArIHNldC5yZXNwb25zZV07XG4gICAgaWYgKHBhdHRlcm5UZXh0KSB7XG4gICAgICAgIHRleHQgPSBFeGVjdGVtcGxhdGUuZXhwYW5kVGVtcGxhdGUoY29udGV4dCwgcGF0dGVyblRleHQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGV4dCA9IG1ha2VHZW5lcmljVGV4dChtYXRjaCwgbWF0Y2hTZXRSZWNvcmQuc2V0SWQsIG1hdGNoU2V0UmVjb3JkLnJlY29yZCk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgIGFjdGlvbjogeyB1cmw6IHVybCB9XG4gICAgfTtcbn1cbmV4cG9ydHMuZXhlY1Rvb2wgPSBleGVjVG9vbDtcbiIsIi8qKlxyXG4gKiBGdW5jdGlvbmFsaXR5IHRvIGV4ZWN1dGUgYSBjZXJ0YWluIHJlc3BvbnNlIG9uIHRoZSBzZXJ2ZXIsXHJcbiAqIGludGVycHJldGluZyBhIGdlbmVyYWwgbW9kZWwgY29udGV4dFxyXG4gKlxyXG4gKlxyXG4gKiB2aWEgYSkgY29tbWFuZGxpbmUgKGUuZy4gYnJvd3NlciBzdGFydHVwKVxyXG4gKiBAZmlsZVxyXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgaW50ZiBmcm9tICdjb25zdGFudHMnO1xyXG5cclxuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xyXG5cclxuaW1wb3J0ICogIGFzIElGTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvaWZtYXRjaCc7XHJcblxyXG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdleGVjc2VydmVyJylcclxuXHJcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcclxuXHJcbmltcG9ydCAqIGFzIElNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcclxuaW1wb3J0ICogYXMgTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvbWF0Y2gnO1xyXG5cclxuXHJcbmltcG9ydCAqIGFzIGlucHV0RmlsdGVyUnVsZXMgZnJvbSAnLi4vbWF0Y2gvaW5wdXRGaWx0ZXJSdWxlcyc7XHJcblxyXG5cclxuaW1wb3J0ICogYXMgVG9vbG1hdGNoIGZyb20gJy4uL21hdGNoL3Rvb2xtYXRjaCc7XHJcblxyXG5pbXBvcnQgKiBhcyBFeGVjdGVtcGxhdGUgZnJvbSAnLi9leGVjdGVtcGxhdGUnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG5vU3RhcihhOiBzdHJpbmcsIGI6IHN0cmluZykge1xyXG4gIGlmIChiID09PSAnKicpIHtcclxuICAgIHJldHVybiBhO1xyXG4gIH1cclxuICBpZiAoYSA9PT0gJyonKSB7XHJcbiAgICByZXR1cm4gYjtcclxuICB9XHJcbiAgaWYgKGEgIT09IGIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignSWxsZWdhbCBBcmd1bWVudCBubyBtYXRjaCAnICsgYSArIFwiIFwiICsgYik7XHJcbiAgfVxyXG4gIHJldHVybiBiO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWFrZUdlbmVyaWNUZXh0KG1hdGNoOiBJTWF0Y2guSVRvb2xNYXRjaCwgc2V0SWQ6IHN0cmluZywgcmVjb3JkOiBJTWF0Y2guSVJlY29yZCk6IHN0cmluZyB7XHJcbiAgdmFyIHJlcyA9IFwic3RhcnQgXCIgKyBtYXRjaC50b29sLm5hbWU7XHJcbiAgdmFyIHNldCA9IG1hdGNoLnRvb2wuc2V0c1tzZXRJZF07XHJcbiAgdmFyIGNvbnRleHQgPSBUb29sbWF0Y2gubWFrZU1hdGNoU2V0KG1hdGNoLCBzZXQpO1xyXG4gIHNldC5zZXQuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnksIGluZGV4KSB7XHJcbiAgICB2YXIgdmFsdWUgPSBub1N0YXIoY29udGV4dFtjYXRlZ29yeV0sIHJlY29yZFtjYXRlZ29yeV0pO1xyXG4gICAgdmFyIHByZWZpeCA9IFwiXCI7XHJcbiAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgcHJlZml4ICs9ICcgdXNpbmcgJztcclxuICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IHNldC5zZXQubGVuZ3RoIC0gMSkge1xyXG4gICAgICBwcmVmaXggKz0gJyBhbmQgJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHByZWZpeCA9ICc7ICc7XHJcbiAgICB9XHJcbiAgICBpZiAoY2F0ZWdvcnkgPT09IFwiY2F0ZWdvcnlcIikge1xyXG4gICAgICByZXMgPSByZXMgKyBwcmVmaXggKydcIicgKyB2YWx1ZSArICdcIic7XHJcbiAgICB9XHJcbiAgICByZXMgPSByZXMgKyBwcmVmaXggKyBjYXRlZ29yeSArICcgXCInICsgdmFsdWUgICsgJ1wiJztcclxuICB9KTtcclxuICByZXR1cm4gcmVzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXhlY1Rvb2wobWF0Y2g6IElNYXRjaC5JVG9vbE1hdGNoLCByZWNvcmRzOiBJTWF0Y2guSVJlY29yZFtdLCBiRXhwbGFpbj86IGJvb2xlYW4gKToge1xyXG4gIHRleHQ6IHN0cmluZyxcclxuICBhY3Rpb246IGFueVxyXG59IHtcclxuICAvL1xyXG4gIGRlYnVnbG9nKFwicmVjb3JkcyBmb3IgbWF0Y2ggXCIgKyBKU09OLnN0cmluZ2lmeShtYXRjaCkpO1xyXG4gIHZhciBtYXRjaFNldFJlY29yZCA9IFRvb2xtYXRjaC5maW5kRmlyc3RTZXRSZWNvcmQobWF0Y2gsIHJlY29yZHMpO1xyXG4gIGlmKCFtYXRjaFNldFJlY29yZCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGV4dCA6IFwiY2Fubm90IHN0YXJ0XCIsXHJcbiAgICAgIGFjdGlvbjoge31cclxuICAgIH1cclxuICB9O1xyXG4gIHZhciBzZXQgPSBtYXRjaC50b29sLnNldHNbbWF0Y2hTZXRSZWNvcmQuc2V0SWRdO1xyXG4gIHZhciBwYXR0ZXJuID0gbWF0Y2hTZXRSZWNvcmQucmVjb3JkW3NldC5yZXNwb25zZV07XHJcblxyXG4gIHZhciBjb250ZXh0ID0gVG9vbG1hdGNoLm1ha2VNYXRjaFNldChtYXRjaCwgc2V0KTtcclxuICB2YXIgdXJsID0gRXhlY3RlbXBsYXRlLmV4cGFuZFRlbXBsYXRlKGNvbnRleHQsIHBhdHRlcm4pO1xyXG4gIHZhciB0ZXh0ID0gXCJcIjtcclxuICBkZWJ1Z2xvZyhcInJlY29yZCBcIiArSlNPTi5zdHJpbmdpZnkoXCJtYXRjaFNldFJlY29yZCBcIikpO1xyXG4gIHZhciBwYXR0ZXJuVGV4dCA9IG1hdGNoU2V0UmVjb3JkLnJlY29yZFtcIl90ZXh0XCIgKyBzZXQucmVzcG9uc2VdO1xyXG4gIGlmIChwYXR0ZXJuVGV4dCkge1xyXG4gICAgdGV4dCA9IEV4ZWN0ZW1wbGF0ZS5leHBhbmRUZW1wbGF0ZShjb250ZXh0LCBwYXR0ZXJuVGV4dCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHRleHQgPSBtYWtlR2VuZXJpY1RleHQobWF0Y2gsIG1hdGNoU2V0UmVjb3JkLnNldElkLCBtYXRjaFNldFJlY29yZC5yZWNvcmQpXHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgYWN0aW9uOiB7IHVybDogdXJsIH1cclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
