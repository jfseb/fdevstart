"use strict";
/**
 * The bot implementation
 *
 * Instantiate apssing a connector via
 * makeBot
 *
 */
/**
 * @file
 * @module jfseb.fdevstart.smartdialog
 * @copyright (c) 2016 Gerd Forstmann
 */
//declare module 'elizabot' { };
//declare module 'winston-pg' { };
//delcare module 'winston' {};

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

Object.defineProperty(exports, "__esModule", { value: true });
var builder = require("botbuilder");
var debug = require("debug");
var Match = require("../match/match");
var Analyze = require("../match/analyze");
var fdevsta_monmove_1 = require("fdevsta_monmove");
var WhatIs = require("../match/whatis");
var ListAll = require("../match/listall");
var Describe = require("../match/describe");
var MakeTable = require("../exec/makeqbetable");
var Utils = require("abot_utils");
var abot_erbase_1 = require("abot_erbase");
var _ = require("lodash");
var DialogLogger = require("../utils/dialoglogger");
var process = require("process");
var dburl = process.env.DATABASE_URL || "";
var pglocalurl = "postgres://joe:abcdef@localhost:5432/abot";
var dburl = process.env.DATABASE_URL || pglocalurl;
var pg = require("pg");
var o = pg;
if (!process.env.ABOT_DBNOSSL) {
    o.defaults.ssl = true; // Only used internally !
}
var dialogLogger = DialogLogger.logger("smartbot", dburl, pg);
function send(o) {
    return o;
}
;
function dialoglog(intent, session, response) {
    var sResponse;
    var sAction;
    if (typeof response === "string") {
        sAction = "";
        sResponse = response;
    } else {
        var aMessage = response;
        var iMessage = aMessage.toMessage();
        sResponse = iMessage.text;
        sAction = iMessage.entities && iMessage.entities[0] ? JSON.stringify(iMessage.entities && iMessage.entities[0]) : "";
    }
    dialogLogger({
        intent: intent,
        session: session,
        response: sResponse,
        action: sAction
    });
    session.send(response);
}
//const pgLogger = new PgLogger({
//  name: 'test-logger',
//  level: 'debug',
//  connString: 'postgres://ubuntu@localhost:5432/circle_test',
//  tableName: 'winston_logs',
//});
//winston.add(winston.transports.File, { filename: 'winston_out.log', timestamp : true });
//  winston.remove(winston.transports.Console);
//winston.add(pgLogger);
/*
const logger = new winston.Logger({
  transports: [
    new winston.transports.Console({
      color: true,
      timestamp: true,
    }),
    pgLogger,
  ]
});
*/
//pgLogger.initTable(done);
var elizabot = require('../extern/elizabot/elizabot.js');
//import * as elizabot from 'elizabot';
var debuglog = debug('smartdialog');
var PlainRecognizer = require("./plainrecognizer");
//var builder = require('botbuilder');
function getConversationId(session) {
    return session.message && session.message.address && session.message.address.conversation.id;
}
var elizabots = {};
function getElizaBot(id) {
    if (!elizabots[id]) {
        elizabots[id] = {
            access: new Date(),
            elizabot: new elizabot()
        };
    }
    elizabots[id].access = new Date();
    return elizabots[id].elizabot;
}
var newFlow = true;
var fdevsta_monmove_2 = require("fdevsta_monmove");
var ExecServer = require("../exec/execserver");
//const theDefaultModel = Model.loadModels();
var models = {};
function loadModel(modelPath) {
    modelPath = modelPath || "";
    if (!models[modelPath]) {
        models[modelPath] = fdevsta_monmove_2.Model.loadModels(modelPath);
    }
    return models[modelPath];
}
if (newFlow) {} else {
    //const tools = Tools.getTools();
    //const InputFilterRules = require('../match/inputFilterRules.js');
    //const mRules = InputFilterRules.getMRulesSample();
}
function isAnonymous(userid) {
    return userid.indexOf("ano:") === 0;
}
function restrictData(arr) {
    if (arr.length < 6) {
        return arr;
    }
    var len = arr.length;
    var res = arr.slice(0, Math.min(Math.max(Math.floor(arr.length / 3), 7), arr.length));
    if (typeof arr[0] === "string") {
        var delta = len - res.length;
        res.push("... and " + delta + " more entries for registered users");
    }
    return res;
}
exports.restrictData = restrictData;
function restrictLoggedOn(session, arr) {
    var userid = session.message.address && session.message.address.user && session.message.address.user.id || "";
    if (process.env.ABOT_EMAIL_USER && isAnonymous(userid)) {
        return restrictData(arr);
    }
    return arr;
}
/*
export class SimpleRecognizer implements builder.IIntentRecognizer {
  constructor() {

  }

  recognize(context: builder.IRecognizeContext, callback: (err: Error, result: builder.IIntentRecognizerResult) => void): void {
    var u = {} as builder.IIntentRecognizerResult;

    debuglog("recognizing " + context.message.text);
    if (context.message.text.indexOf("start") >= 0) {
      u.intent = "ShowEntity";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "start ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }

    if (context.message.text.indexOf("train") >= 0) {
      u.intent = "train";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("learn") >= 0) {
      u.intent = "learn";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.type = "trainFact";
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("help") >= 0) {
      u.intent = "help";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("exit") >= 0) {
      u.intent = "exit";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("wrong") >= 0) {
      u.intent = "wrong";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    debuglog('recognizing nothing');
    u.intent = "None";
    u.score = 0.1;
    var e1 = {} as builder.IEntity;
    e1.startIndex = "exit ".length;
    e1.endIndex = context.message.text.length;
    e1.score = 0.1;
    u.entities = [];
    callback(undefined, u);
  }
}
*/
var aTrainReplies = ["Thank you for sharing this suggestion with us", "Thank for for this valuable information.", "Thank for for this interesting fact!", "Thats a plethoria of information.", "That's a nugget of information.", "Lovely, I may consider you input.", "Well done, anything more to let me know?", "I do appreciate your teaching and my learning experience, or was it the other way round?", "Your helpful input has been stored in some dusty corner of the World wide web!", "Thank you for my learning experience!", "I have incorporated your valuable suggestion in the wisdom of the internet"];
var aTrainDialog = aTrainReplies;
var aTrainExitHint = ["\ntype \"done\" when you are done training me.", "", "", "", "\nremember, you are stuck here instructing me, type \"done\" to return.", ""];
var aEnterTrain = ['So you think this is wrong? You can offer your advise here.\n Type "done" if you are done with instructing me', 'Feel free to offer me your better solution here.\nType "done" if you are done with instructing me', 'Some say "The secret to happiness is to lower your expectations to the point they are already met.", \nt if you could help me to become better, instruct me.\n Type "done" if you are done with teaching me', 'Feel free to offer me your better solution here.\n Type "done" if you are done with instructing me', 'Feel free to offer me your better solution here.\n Type "done" if you are done with instructing me'];
var aBackFromTraining = ['Puuh, back from training! Now for the easy part ...\n ask me a new question.', 'Live and don\'t learn, that\'s us. Naah, we\'ll see.\nAsk me another question.', 'The secret to happiness is to lower your expectations to the point they are already met.\n Ask me a question.', 'Thanks for having this lecture session, now i am back to our usual self.\n Ask me a question.'];
var aTrainNoKlingon = ["He who masters the dark arts of SAP must not dwell in the earthly realms of Start Trek.", "SAP is a cloud company, not a space company.", "The depth of R/3 are deeper than Deep Space 42.", "My brainpower is fully absorbed with mastering other realms.", "For the wosap, the sky is the limit. Feel free to check out nasa.gov .", "The future is SAP or IBM blue, not space black.", "That's left to some musky future."];
exports.aResponsesOnTooLong = ["Your input should be eloquent in it's brevity. This one was too long.", "my wisdom is severly bound by my limited input processing capabilities. Could you formulate a shorter input? Thank you.", "The length of you input indicates you probably know more about the topic than me? Can i humbly ask you to formulate a shorter question?", '\"What ever you want to teach, be brief\" (Horace). While this does not always applies to my answers, it is require for your questions. Please try again with a refined questions.', 'I understand more than 4-letter words, but not more than 20 word sentences. Please try to shorten your input.', 'the sky is the limit? Air force member or not, you can ask longer questions than \"the sky\", but not this long', 'My answers may be exhaustive, but I understand more than 4-letter words, but not more than 20 word sentences. Sorry.', 'Our conversation must be highly assymmetric: my answers may be verbose and exhaustive and fuzzy, questions and input must be brief. Try to reformulate it'];
exports.metawordsDescriptions = {
    "category": "an attribute of a record in a model, example: a Planet has a \"name\" attribute",
    "domain": "a group of facts which are typically unrelated",
    "key": "an attribute value (of a category) which  is unique for the record",
    "tool": "is potentialy command to execute",
    "record": "a specific set of \"fact\"s of a domain, a \"record\" has a set of attributes values (\"fact\"s) of the categories, often a record has a \"key\"",
    "fact": "a specific category value of a record in a domain, may be a \"key\" value"
};
function getRandomResult(arr) {
    return arr[Math.floor(Math.random() * arr.length) % arr.length];
}

var SimpleUpDownRecognizer = function () {
    function SimpleUpDownRecognizer() {
        _classCallCheck(this, SimpleUpDownRecognizer);
    }

    _createClass(SimpleUpDownRecognizer, [{
        key: "recognize",
        value: function recognize(context, callback) {
            var u = {};
            debuglog("recognizing " + context.message.text);
            if (context.message.text.indexOf("down") >= 0) {
                u.intent = "intent.down";
                u.score = 0.9;
                var e1 = {};
                e1.startIndex = "start ".length;
                e1.endIndex = context.message.text.length;
                e1.score = 0.3;
                u.entities = [e1];
                callback(undefined, u);
                return;
            }
            if (context.message.text.indexOf("up") >= 0) {
                u.intent = "intent.up";
                u.score = 0.9;
                var e1 = {};
                e1.startIndex = "up".length;
                e1.endIndex = context.message.text.length;
                e1.score = 0.3;
                u.entities = [e1];
                callback(undefined, u);
                return;
            }
            if (context.message.text.indexOf("done") >= 0) {
                u.intent = "intent.up";
                u.score = 0.9;
                var e1 = {};
                e1.startIndex = "up".length;
                e1.endIndex = context.message.text.length;
                e1.score = 0.3;
                u.entities = [e1];
                callback(undefined, u);
                return;
            }
            if (context.message.text.indexOf("exit") >= 0) {
                u.intent = "intent.up";
                u.score = 0.9;
                var e1 = {};
                e1.startIndex = "up".length;
                e1.endIndex = context.message.text.length;
                e1.score = 0.3;
                u.entities = [e1];
                callback(undefined, u);
                return;
            }
            if (context.message.text.indexOf("quit") >= 0) {
                u.intent = "intent.up";
                u.score = 0.9;
                var e1 = {};
                e1.startIndex = "up".length;
                e1.endIndex = context.message.text.length;
                e1.score = 0.3;
                u.entities = [e1];
                callback(undefined, u);
                return;
            }
            debuglog('recognizing nothing');
            u.intent = "None";
            u.score = 0.1;
            var e1 = {};
            e1.startIndex = "exit ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.1;
            u.entities = [];
            callback(undefined, u);
        }
    }]);

    return SimpleUpDownRecognizer;
}();

exports.SimpleUpDownRecognizer = SimpleUpDownRecognizer;
var AnyObject = Object;
// globalTunnel.initialize({
//  host: 'proxy.exxxample.com',
//  port: 8080
// })
// Create bot and bind to console
// var connector = new htmlconnector.HTMLConnector()
// connector.setAnswerHook(function (sAnswer) {
//  console.log('Got answer : ' + sAnswer + '\n')
// })
var bot;
// setTimeout(function () {
//   connector.processMessage('start unit test ABC ')
// }, 5000)
var fs = require("fs");
var oJSON = JSON.parse('' + fs.readFileSync('./resources/model/intents.json'));
var oRules = PlainRecognizer.parseRules(oJSON);
// var Recognizer = new (recognizer.RegExpRecognizer)(oRules);
function logQuery(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && Match.ToolMatch.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIs(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIsTupel(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNiceTupel(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
var gwords = {};
/**
 * Construct a bot
 * @param connector {Connector} the connector to use
 * HTMLConnector
 * or connector = new builder.ConsoleConnector().listen()
 */
function makeBot(connector, modelPath, options) {
    var t = Date.now();
    var theModel = loadModel(modelPath);
    var t = Date.now() - t;
    if (options && options.showModelLoadTime) {
        console.log("model load time " + t);
    }
    bot = new builder.UniversalBot(connector);
    // Create LUIS recognizer that points at our model and add it as the root '/' dialog for our Cortana Bot.
    // var model = sensitive.modelurl;
    // var model = 'https://api.projectoxford.ai/luis/v2.0/apps/c413b2ef-382c-45bd-8ff0-f76d60e2a821?subscription-key=c21398b5980a4ce09f474bbfee93b892&q='
    var recognizer = new PlainRecognizer.RegExpRecognizer(oRules);
    var dialog = new builder.IntentDialog({ recognizers: [recognizer] });
    // dialog.onBegin(function(session,args) {
    // console.log("beginning ...")
    // session.dialogData.retryPrompt = args && args.retryPrompt || "I am sorry"
    // session.send("What do you want?")
    //
    // })
    var dialogUpDown = new builder.IntentDialog({ recognizers: [new SimpleUpDownRecognizer()] });
    bot.dialog('/updown', dialogUpDown);
    dialogUpDown.onBegin(function (session) {
        dialoglog("TrainMe", session, send(getRandomResult(aEnterTrain)));
        //session.send("Hi there, updown is waiting for you");
    });
    dialogUpDown.matches('intent.up', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to exit training? type \"done\" again.');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
        next();
    }, function (session, results) {
        session.endDialogWithResult({ response: session.dialogData.abc });
    }]);
    dialogUpDown.matches('intent.down', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to go down!');
    }, function (session, results, next) {
        session.dialogData.abc = -1; // results.reponse;
        next();
    }, function (session, results) {
        session.send("still going down?");
    }]);
    dialogUpDown.onDefault(function (session) {
        logQuery(session, "onDefault");
        var res = getRandomResult(aTrainDialog) + getRandomResult(aTrainExitHint);
        dialoglog("TrainMe", session, send(res));
    });
    /*
      bot.dialog('/train', [
        function (session, args, next) {
          session.dialgoData.abc = args || {};
          builder.Prompts.text(session, 'Do you want to train me');
        },
        function (session, results, next) {
          session.dialogData.abc = results.reponse;
        },
        function (session, results) {
          session.endDialogWithResult({ response: session.DialogData.abc });
        }
      ]);
    */
    bot.dialog('/', dialog);
    dialog.matches('ShowMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        debuglog("Show Entity");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var result = Analyze.analyzeAll(a1.entity, theModel.rules, theModel.tools, gwords);
        logQuery(session, 'ShowMe', result);
        // test.expect(3)
        //  test.deepEqual(result.weight, 120, 'correct weight');
        if (!result || result.length === 0) {
            next();
        }
        // debuglog('result : ' + JSON.stringify(result, undefined, 2));
        debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
        debuglog('top : ' + Match.ToolMatch.dumpWeightsTop(result, { top: 3 }));
        if (Analyze.isComplete(result[0])) {
            session.dialogData.result = result[0];
            //    session.send('Showing entity ...');
            next();
        } else if (Analyze.getPrompt(result[0])) {
            var prompt = Analyze.getPrompt(result[0]);
            session.dialogData.result = result[0];
            session.dialogData.prompt = prompt;
            dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            builder.Prompts.text(session, prompt.text);
        } else {
            var best = result.length ? Match.ToolMatch.dumpNice(result[0]) : "<nothing>";
            dialoglog("ShowMe", session, send('I did not understand this' + best));
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (!result || result.length === 0) {
            next();
        }
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            next();
        } else if (Analyze.getPrompt(session.dialogData.result)) {
            var prompt = Analyze.getPrompt(session.dialogData.result);
            session.dialogData.prompt = prompt;
            builder.Prompts.text(session, prompt.text);
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            var exec = ExecServer.execTool(session.dialogData.result, theModel.records);
            var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
            // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
            dialoglog("ShowMe", session, send(reply));
        } else {
            if (session.dialogData.result) {
                dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            } else {
                dialoglog("ShowMe", session, send("I did not get what you want"));
            }
        }
    }]);
    dialog.matches('WhatIs', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("WhatIs Entities");
        debuglog(debuglog.enabled ? 'raw: ' + JSON.stringify(args.entities, undefined, 2) : '-');
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var category = categoryEntity.entity;
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var cats = [];
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(category, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + (e ? '(' + e.toString() + ')' : "")));
                // next();
                return;
            }
        }
        var cat = undefined;
        // we have some cats, (or at least one)
        if (cats.length === 1) {
            cat = cats[0];
            if (!cat) {
                session.send('I don\'t know anything about "' + category + '"');
                // next();
                return;
            }
        }
        if (cats.length === 1) {
            debuglog('WI category identified:' + cat);
            var result = WhatIs.resolveCategory(cat, a1.entity, theModel.rules, theModel.records);
            debuglog(debuglog.enabled ? 'whatis result:' + JSON.stringify(result) : '-');
            logQueryWhatIs(session, 'WhatIs', result.answers);
            var indis = WhatIs.isIndiscriminateResult(result.answers);
            if (indis) {
                session.send(indis);
                // next();
                return;
            }
            if (!result || result.answers.length === 0) {
                var explain = '';
                if (result.errors.length) {
                    explain = abot_erbase_1.ErError.explainError(result.errors);
                }
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + cat + " (" + category + ')\" in relation to "' + a1.entity + ("\"." + explain)));
                // next();
                return;
            } else {
                // debuglog('result : ' + JSON.stringify(result, undefined, 2));
                debuglog(debuglog.enabled ? 'best result : ' + JSON.stringify(result.answers[0] || {}, undefined, 2) : '-');
                debuglog(debuglog.enabled ? 'top : ' + WhatIs.dumpWeightsTop(result.answers, { top: 3 }) : '-');
                // TODO cleansed sentence
                dialoglog("WhatIs", session, send('The ' + category + ' of ' + a1.entity + ' is ' + result.answers[0].result + "\n")); //  + JSON.stringify(result[0]));
            }
        } // single category
        else {
                debuglog('WI categories identified:' + cats.join(","));
                try {
                    var domainCategoryFilter = fdevsta_monmove_2.Model.getDomainCategoryFilterForTargetCategories(theModel, cats, true);
                } catch (e) {
                    var explain = "";
                    dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + "\" (" + Utils.listToQuotedCommaAnd(cats) + ')\" in relation to "' + a1.entity + ("\"" + explain)));
                    return;
                }
                var resultArr = WhatIs.resolveCategories(cats, a1.entity, theModel, domainCategoryFilter);
                debuglog(debuglog.enabled ? 'mulst whatis result:' + JSON.stringify(resultArr) : '-');
                logQueryWhatIsTupel(session, 'WhatIs', resultArr.tupelanswers);
                var indis = WhatIs.isIndiscriminateResultTupel(resultArr.tupelanswers);
                if (indis) {
                    session.send(indis);
                    // next();
                    return;
                }
                if (!resultArr || !resultArr.tupelanswers || resultArr.tupelanswers.length === 0) {
                    var explain = '';
                    if (resultArr.errors.length) {
                        explain = abot_erbase_1.ErError.explainError(resultArr.errors);
                    }
                    dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + "\" (" + Utils.listToQuotedCommaAnd(cats) + ')\" in relation to "' + a1.entity + ("\"" + explain)));
                    // next();
                    return;
                } else {
                    // debuglog('result : ' + JSON.stringify(result, undefined, 2));
                    debuglog(debuglog.enabled ? 'best result : ' + JSON.stringify(resultArr.tupelanswers[0] || {}, undefined, 2) : '-');
                    //debuglog('top : ' + WhatIs.dumpWeightsTop(resultArr, { top: 3 }));
                    // TODO cleansed sentence
                    dialoglog("WhatIs", session, send('The ' + Utils.listToQuotedCommaAnd(cats) + ' of ' + a1.entity + ' are ' + Utils.listToQuotedCommaAnd(resultArr.tupelanswers[0].result) + '\n')); //  + JSON.stringify(result[0]));
                }
            } //endif multiple categories
    }]);
    dialog.matches('ListAll', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAll");
        debuglog(debuglog.enabled ? 'raw: ' + JSON.stringify(args.entities, undefined, 2) : '-');
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        var category = categoryEntity.entity;
        var inSthEntity = builder.EntityRecognizer.findEntity(args.entities, 'insth');
        var inSomething = inSthEntity && inSthEntity.entity;
        // some metaqueries:
        if (category === "categories") {
            // do we have a filter ?
            var domain = undefined;
            if (inSomething) {
                domain = ListAll.inferDomain(theModel, inSomething);
            }
            if (!domain) {
                var res = restrictLoggedOn(session, theModel.category).join(";\n");
                if (inSomething) {
                    dialoglog("ListAll", session, send("I did not infer a domain restriction from \"" + Utils.stripQuotes(inSomething) + "\", all my categories are ...\n" + res));
                } else {
                    dialoglog("ListAll", session, send("my categories are ...\n" + res));
                }
                return;
            } else {
                var aRes = fdevsta_monmove_2.Model.getCategoriesForDomain(theModel, domain);
                var res = restrictLoggedOn(session, aRes).join(";\n");
                dialoglog("ListAll", session, send("my categories in domain \"" + domain + "\" are ...\n" + res));
                return;
            }
        }
        if (category === "domains") {
            var res = restrictLoggedOn(session, theModel.domains).join(";\n");
            dialoglog("ListAll", session, send("my domains are ...\n" + res));
            return;
        }
        if (category === "tools") {
            var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {
                return oTool.name;
            }).join(";\n");
            dialoglog("ListAll", session, send("my tools are ...\n" + res));
            return;
        }
        var cats = [];
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(category, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + '"(' + e.toString() + ')'));
                // next();
                return;
            }
        }
        if (!cats || cats.length === 0) {
            dialoglog("ListAll", session, send('I don\'t know anything about "' + category + '"'));
            // next();
            return;
        }
        var cat = "";
        if (cats.length === 1) {
            cat = cats[0];
        }
        if (cats.length === 1) {
            debuglog('single category identified:' + cat);
            if (inSomething) {
                debuglog('got filter:' + inSomething);
                var categorySet = fdevsta_monmove_2.Model.getDomainCategoryFilterForTargetCategory(theModel, cat, true);
                var result1 = ListAll.listAllWithContext(cat, inSomething, theModel.rules, theModel.records, categorySet);
                debuglog(debuglog ? 'listall result >:' + JSON.stringify(result1) : '-');
                var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1.answers));
                logQueryWhatIs(session, 'ListAll', result1.answers);
                debuglog(debuglog ? 'listall result2 >:' + JSON.stringify(result1) : '-');
                if (joinresults.length) {
                    dialoglog("ListAll", session, send("the " + category + " for " + inSomething + " are ...\n" + joinresults.join(";\n")));
                } else {
                    var errprefix = "";
                    if (result1.errors.length) {
                        errprefix = abot_erbase_1.ErError.explainError(result1.errors);
                    }
                    dialoglog("ListAll", session, send("i did not find any " + category + " for " + inSomething + ".\n" + joinresults.join(";\n") + "" + errprefix));
                }
                return;
            } else {
                // no filter entity, e.g. list all countries
                //
                var categorySetFull = fdevsta_monmove_2.Model.getDomainCategoryFilterForTargetCategory(theModel, cat, false);
                var result = ListAll.listAllWithContext(cat, cat, theModel.rules, theModel.records, categorySetFull);
                logQueryWhatIs(session, 'ListAll', result.answers);
                if (result.answers.length) {
                    debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(result) : '-');
                    var joinresults = [];
                    debuglog("here is cat>" + cat);
                    if (cat !== "example question") {
                        joinresults = restrictLoggedOn(session, ListAll.joinResults(result.answers));
                    } else {
                        joinresults = ListAll.joinResults(result.answers);
                    }
                    var response = "the " + category + " are ...\n" + joinresults.join(";\n");
                    dialoglog("ListAll", session, send(response));
                    return;
                } else {
                    var response = "Found no data having \"" + cat + "\"";
                    dialoglog("ListAll", session, send(response));
                    return;
                }
            }
        } else {
            // multiple categories
            debuglog('categories identified:' + cats.join(","));
            if (inSomething) {
                debuglog('got filter:' + inSomething);
                try {
                    var domainCategoryFilter = fdevsta_monmove_2.Model.getDomainCategoryFilterForTargetCategories(theModel, cats, true);
                } catch (e) {
                    debuglog("here exception" + e);
                    dialoglog("WhatIs", session, send('I cannot combine "' + category + '(' + e.toString() + ')'));
                    return;
                }
                var result1T = ListAll.listAllTupelWithContext(cats, inSomething, theModel.rules, theModel.records, domainCategoryFilter);
                debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(result1T) : '-');
                var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1T.tupelanswers));
                logQueryWhatIsTupel(session, 'ListAll', result1T.tupelanswers);
                if (joinresults.length) {
                    dialoglog("ListAll", session, send("the " + category + " for " + inSomething + " are ...\n" + joinresults.join(";\n")));
                } else {
                    if (result1T.errors.length) {
                        errprefix = abot_erbase_1.ErError.explainError(result1T.errors);
                    }
                    dialoglog("ListAll", session, send("i did not find any " + category + " for " + inSomething + ".\n" + joinresults.join(";\n") + errprefix));
                }
                return;
            } else {
                // no entity, e.g. list all countries
                //
                var categorySetFull = {}; //{ [key: string]: boolean };
                try {
                    categorySetFull = fdevsta_monmove_2.Model.getDomainCategoryFilterForTargetCategories(theModel, cats, false);
                } catch (e) {
                    debuglog("here exception" + e);
                    dialoglog("WhatIs", session, send('I cannot combine "' + category + '(' + e.toString() + ')'));
                    // next();
                    return;
                }
                var resultT = ListAll.listAllTupelWithContext(cats, "\"" + cats.join("\" \"") + "\"", theModel.rules, theModel.records, categorySetFull);
                logQueryWhatIsTupel(session, 'ListAll', resultT.tupelanswers);
                if (resultT.tupelanswers.length) {
                    debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(resultT) : '-');
                    var joinresults = [];
                    debuglog("here is cat>" + cats.join(", "));
                    if (cat !== "example question") {
                        joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultT.tupelanswers));
                    } else {
                        joinresults = ListAll.joinResultsTupel(resultT.tupelanswers);
                    }
                    var response = "the " + category + " are ...\n" + joinresults.join(";\n");
                    dialoglog("ListAll", session, send(response));
                    return;
                } else {
                    var response = "Found no data having \"" + cat + "\"";
                    dialoglog("ListAll", session, send(response));
                    return;
                }
            }
        }
    }]);
    dialog.matches('buildtable', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : buildtable");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categories = builder.EntityRecognizer.findEntity(args.entities, 'categories').entity;
        debuglog("factOrCat is" + categories);
        var cats;
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(categories, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + categories + '"(' + e.toString() + ')'));
                // next();
                return;
            }
        }
        if (!cats || cats.length === 0) {
            dialoglog("ListAll", session, send('I did not find a category in "' + categories + '"'));
            // next();
            return;
        }
        var exec = MakeTable.makeTable(cats, theModel);
        //      const exec = ExecServer.execTool(session.dialogData.result as IMatch.IToolMatch, theModel.records);
        var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
        // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
        dialoglog("ShowMe", session, send(reply));
    }]);
    dialog.matches('Describe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : Describe");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var factEntity = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var factOrCat = factEntity && factEntity.entity;
        var domainEntity = builder.EntityRecognizer.findEntity(args.entities, 'D');
        var domainS = domainEntity && domainEntity.entity;
        var filterDomain = undefined;
        if (domainS) {
            filterDomain = ListAll.inferDomain(theModel, domainS);
            debuglog("got domain" + filterDomain);
            if (!filterDomain) {
                dialoglog("Describe", session, send("I did not infer a domain restriction from \"" + domainS + "\". Specify an existing domain. (List all domains) to get exact names.\n"));
                return;
            }
        }
        debuglog("factOrCat is" + factOrCat);
        if (exports.metawordsDescriptions[factOrCat.toLowerCase()]) {
            // do we have a filter ?
            var prefix = "";
            if (filterDomain) {
                prefix = '"in domain "' + filterDomain + '" make no sense when matching a metaword.\n';
            }
            debuglog("showing meta result");
            dialoglog("Describe", session, send(prefix + '"' + factOrCat + '" is ' + exports.metawordsDescriptions[factOrCat.toLowerCase()] + ""));
            return;
        }
        var categories = [];
        if (WhatIs.splitAtCommaAnd(factOrCat).length > 1) {
            dialoglog("Describe", session, send("Whoa, i can only explain one thing at a time, not \"" + factOrCat + "\". Please ask one at a time."));
            return;
            // getDomainsForCategory
        }
        var category = WhatIs.analyzeCategory(factOrCat, theModel.rules, message);
        var catResults = [];
        if (category) {
            //TODO
            catResults = Describe.describeCategory(category, filterDomain, theModel, message);
        }
        var resFact = Describe.describeFactInDomain(factOrCat, filterDomain, theModel);
        if (catResults) {
            var prefixed = catResults.map(function (res) {
                return Describe.sloppyOrExact(category, factOrCat, theModel) + "  " + res;
            });
        }
        if (catResults.length) {
            resFact = prefixed.join("\n");
            +"\n" + resFact;
        }
        dialoglog("Describe", session, send(resFact));
        /*
            var aRes = Model.getCategoriesForDomain(theModel, domain);
             var res = restrictLoggedOn(session, aRes).join(";\n");
            dialoglog("ListAll",session,send("my categories in domain \"" + domain + "\" are ...\n" + res));
            return;
          }
        }
        if (category === "domains") {
          var res = restrictLoggedOn(session, theModel.domains).join(";\n");
          dialoglog("ListAll",session, send("my domains are ...\n" + res));
          return;
        }
        if (category === "tools") {
          var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {
            return oTool.name;
          }).join(";\n");
          dialoglog("ListAll", session,send("my tools are ...\n" + res));
          return;
        }
        */
        /*
        var cats = [];
          try {
          cats = WhatIs.analyzeCategoryMult2(category, theModel.rules, message);
          debuglog("here cats" + cats.join(","));
        } catch (e) {
            if(e) {
              debuglog("here exception" + e);
              dialoglog("WhatIs",session,send('I don\'t know anything about "' + category + '"(' + e.toString() + ')'));
              // next();
              return;
            }
        }
        if (!cats || (cats.length === 0)) {
          dialoglog("ListAll",session,send('I don\'t know anything about "' + category + '"'));
          // next();
          return;
        }
        var cat = "";
        if( cats.length === 1) {
          cat = cats[0];
        }
        if( cats.length === 1) {
          debuglog('category identified:' + cat);
          if (a1 && a1.entity) {
            debuglog('got filter:' + a1.entity);
            var categorySet = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, true);
            var result1 = ListAll.listAllWithContext(cat, a1.entity,
              theModel.rules, theModel.records, categorySet);
            // TODO classifying the string twice is a terrible waste
            if (!result1.length) {
              debuglog('going for having');
              var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
              result1 = ListAll.listAllHavingContext(cat, a1.entity, theModel.rules,
                theModel.records, categorySetFull);
            }
            debuglog('listall result:' + JSON.stringify(result1));
            var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1));
            logQueryWhatIs(session, 'ListAll', result1);
            if(joinresults.length ){
              dialoglog("ListAll",session,send("the " + category + " for " + a1.entity + " are ...\n" + joinresults.join(";\n")));
            } else {
              dialoglog("ListAll",session,send("i did not find any " + category + " for " + a1.entity + ".\n" + joinresults.join(";\n")));
            }
            return;
          } else {
            // no entity, e.g. list all countries
            //
            var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
            var result = ListAll.listAllHavingContext(cat, cat, theModel.rules, theModel.records, categorySetFull);
            logQueryWhatIs(session, 'ListAll', result);
            if (result.length) {
              debuglog('listall result:' + JSON.stringify(result));
              var joinresults = [];
              debuglog("here is cat>" + cat);
              if(cat !== "example question") {
                joinresults = restrictLoggedOn(session, ListAll.joinResults(result));
              } else {
                joinresults = ListAll.joinResults(result);
              }
              var response = "the " + category + " are ...\n" + joinresults.join(";\n");
              dialoglog("ListAll",session,send(response));
              return;
            } else {
              var response = "Found no data having \"" + cat + "\""
              dialoglog("ListAll",session,send(response));
              return;
            }
          }
        } else {
          // multiple categories
          debuglog('categories identified:' + cats.join(","));
          if (a1 && a1.entity) {
            debuglog('got filter:' + a1.entity);
            try {
            var categorySet = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, true);
            } catch(e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs",session,send('I cannot combine "' + category + '(' + e.toString() + ')'));
                return;
            }
            var result1T = ListAll.listAllTupelWithContext(cats, a1.entity,
              theModel.rules, theModel.records, categorySet);
            // TODO classifying the string twice is a terrible waste
            if (!result1T.length) {
              debuglog('going for having');
              var categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
              result1T = ListAll.listAllTupelHavingContext(cats, a1.entity, theModel.rules,
                theModel.records, categorySetFull);
            }
            debuglog('listall result:' + JSON.stringify(result1T));
            var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1T));
            logQueryWhatIsTupel(session, 'ListAll', result1T);
            if(joinresults.length ){
              dialoglog("ListAll",session,send("the " + category + " for " + a1.entity + " are ...\n" + joinresults.join(";\n")));
            } else {
              dialoglog("ListAll",session,send("i did not find any " + category + " for " + a1.entity + ".\n" + joinresults.join(";\n")));
            }
            return;
          } else {
            // no entity, e.g. list all countries
            //
            var categorySetFull = {} as { [key : string] : boolean};
            try {
              categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
            } catch(e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs",session,send('I cannot combine "' + category + '(' + e.toString() + ')'));
            // next();
                return;
            }
            var resultT = ListAll.listAllTupelHavingContext(cats, "\"" + cats.join("\" \"") + "\"", theModel.rules, theModel.records, categorySetFull);
            logQueryWhatIsTupel(session, 'ListAll', resultT);
            if (resultT.length) {
              debuglog('listall result:' + JSON.stringify(resultT));
              var joinresults = [];
              debuglog("here is cat>" + cats.join(", "));
              if(cat !== "example question") {
                joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultT));
              } else {
                joinresults = ListAll.joinResultsTupel(resultT);
              }
              var response = "the " + category + " are ...\n" + joinresults.join(";\n");
              dialoglog("ListAll",session,send(response));
              return;
            } else {
              var response = "Found no data having \"" + cat + "\""
              dialoglog("ListAll",session,send(response));
              return;
            }
          }
        }
          */
    }]);
    dialog.matches('ListAllBinOp', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAllBinOp");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var categoryWord = categoryEntity.entity;
        var opEntity = builder.EntityRecognizer.findEntity(args.entities, 'operator');
        var operatorWord = opEntity && opEntity.entity;
        // categorize as operator ?
        var filterDomainEntity = builder.EntityRecognizer.findEntity(args.entities, 'domain');
        var filterDomainS = filterDomainEntity && filterDomainEntity.entity;
        var operator = WhatIs.analyzeOperator(operatorWord, theModel.rules, message);
        var category = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
        var operatorArgs = fdevsta_monmove_2.Model.getOperator(theModel, operator);
        var a2 = builder.EntityRecognizer.findEntity(args.entities, 'A2');
        if (!operator) {
            var s = "Unknown operator " + operatorWord + ", this is a model bug, check operators.json and intents.json";
            dialoglog("ListAllBinOp", session, send("ouch, this was in internal error. Recovering from a weird operator \"" + operatorWord + "\"\n"));
            return;
            // TODO        throw new Error(s);
        }
        var filterDomain = undefined;
        if (filterDomainS) {
            debuglog("found a domainString" + filterDomainS);
            filterDomain = ListAll.inferDomain(theModel, filterDomainS);
            debuglog("got domain" + filterDomain);
            if (!filterDomain) {
                dialoglog("Describe", session, send("I did not infer a domain restriction from \"" + filterDomainS + "\". Specify an existing domain. (List all domains) to get exact names.\n"));
                return;
            }
        }
        var fragment = a2 && a2.entity;
        fragment = fdevsta_monmove_1.BreakDown.trimQuoted(fdevsta_monmove_1.BreakDown.trimQuotedSpaced(fragment));
        debuglog("fragment after trimming \"" + fragment + "\"");
        if (categoryWord === "categories") {
            // do we have a filter?
            var aFilteredCategories = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.category);
            if (filterDomain) {
                var catsForDomain = fdevsta_monmove_2.Model.getCategoriesForDomain(theModel, filterDomain);
                aFilteredCategories = _.intersection(aFilteredCategories, catsForDomain);
            }
            res = restrictLoggedOn(session, aFilteredCategories).join(";\n");
            if (res.length) {
                if (filterDomain) {
                    dialoglog("ListAllBinOp", session, send("my categories " + operator + " \"" + fragment + "\" in domain \"" + filterDomain + "\" are ...\n" + res));
                } else {
                    dialoglog("ListAllBinOp", session, send("my categories " + operator + " \"" + fragment + "\" are ...\n" + res));
                }
            } else {
                dialoglog("ListAllBinOp", session, send('I have no categories ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "domains") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.domains);
            res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my domains " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send('I have no domains ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "tools") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.tools.map(function (oTool) {
                return oTool.name;
            }));
            var res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my tools " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send("I have no tools " + operator + ' "' + fragment + '"'));
            }
            return;
        } else {
            var cat = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
            if (!cat) {
                dialoglog("ListAllBinOp", session, send('I don\'t know anything about "' + categoryWord + '"'));
                // next();
                return;
            }
            debuglog('category identified:' + cat);
            var aRes = ListAll.getCategoryOpFilterAsDistinctStrings(operatorArgs, fragment, category, theModel.records, filterDomain);
            var res = restrictLoggedOn(session, aRes).join(";\n");
            var infixExplain = '';
            if (!ListAll.likelyPluralDiff(category, categoryWord)) {
                infixExplain = '("' + category + '")';
            }
            if (res.length) {
                if (filterDomain) {
                    dialoglog("ListAllBinOp", session, send("my " + categoryWord + infixExplain + " " + operator + " \"" + fragment + "\" in domain \"" + filterDomain + "\" are ...\n" + res));
                } else {
                    dialoglog("ListAllBinOp", session, send("my " + categoryWord + infixExplain + " " + operator + " \"" + fragment + "\" are ...\n" + res));
                }
            } else {
                dialoglog("ListAllBinOp", session, send('I have no ' + categoryWord + infixExplain + ' ' + operator + ' "' + fragment + '"'));
            }
            return;
        }
    }]);
    dialog.matches('TrainMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : Train");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        if (message.toLowerCase().indexOf("kronos") >= 0 || message.toLowerCase().indexOf("klingon") >= 0) {
            dialoglog("TrainMe", session, send(getRandomResult(aTrainNoKlingon)));
            return;
        }
        var res = getRandomResult(aTrainReplies);
        dialoglog("TrainMe", session, send(res));
    }]);
    dialog.matches('TooLong', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : TooLong");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        dialoglog("TooLong", session, send(getRandomResult(exports.aResponsesOnTooLong)));
    }]);
    dialog.matches('Wrong', [function (session, args, next) {
        /*
        dialogLogger({
          session: session,
          intent: "Wrong",
          response: '<begin updown>'
        }); */
        session.beginDialog('/updown', session.userData.count);
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        next();
    }, function (session, results) {
        session.send(getRandomResult(aBackFromTraining)); //  + JSON.stringify(results));
        //session.send('end of wrong');
    }]);
    dialog.matches('Exit', [function (session, args, next) {
        debuglog('exit :');
        debuglog('exit' + JSON.stringify(args.entities));
        dialogLogger({
            session: session,
            intent: "Exit",
            response: 'you are in a logic loop'
        });
        session.send("you are in a logic loop ");
    }]);
    dialog.matches('Help', [function (session, args, next) {
        debuglog('help :');
        debuglog('help');
        session.send("I know about .... <categories>>");
    }]);
    /*
      // Add intent handlers
      dialog.matches('train', [
        function (session, args, next) {
          debuglog('train');
          // Resolve and store any entities passed from LUIS.
          var title = builder.EntityRecognizer.findEntity(args.entities, 'builtin.alarm.title');
          var time = builder.EntityRecognizer.resolveTime(args.entities);
          var alarm = session.dialogData.alarm = {
            title: title ? title.entity : null,
            timestamp: time ? time.getTime() : null
          };
          // Prompt for title
          if (!alarm.title) {
            dialogLogger({
              session: session,
              intent: "train",
              response: 'What fact would you like to train?'
            });
            builder.Prompts.text(session, 'What fact would you like to train?');
          } else {
            next();
          }
        },
        function (session, results, next) {
          var alarm = session.dialogData.alarm;
          if (results.response) {
            alarm.title = results.response;
          }
    
          // Prompt for time (title will be blank if the user said cancel)
          if (alarm.title && !alarm.timestamp) {
    
    
            builder.Prompts.time(session, 'What time would you like to set the alarm for?');
          } else {
            next();
          }
        },
        function (session, results) {
          var alarm = session.dialogData.alarm;
          if (results.response) {
            var time = builder.EntityRecognizer.resolveTime([results.response]);
            alarm.timestamp = time ? time.getTime() : null;
          }
          // Set the alarm (if title or timestamp is blank the user said cancel)
          if (alarm.title && alarm.timestamp) {
            // Save address of who to notify and write to scheduler.
            alarm.address = session.message.address;
            //alarms[alarm.title] = alarm;
    
            // Send confirmation to user
            var date = new Date(alarm.timestamp);
            var isAM = date.getHours() < 12;
            session.send('Creating alarm named "%s" for %d/%d/%d %d:%02d%s',
              alarm.title,
              date.getMonth() + 1, date.getDate(), date.getFullYear(),
              isAM ? date.getHours() : date.getHours() - 12, date.getMinutes(), isAM ? 'am' : 'pm');
          } else {
            session.send('Ok... no problem.');
          }
        }
      ]);
    */
    dialog.onDefault(function (session) {
        logQuery(session, "onDefault");
        var eliza = getElizaBot(getConversationId(session));
        var reply = eliza.transform(session.message.text);
        dialoglog("eliza", session, send(reply));
        //new Eilzabot
        //session.send("I do not understand this at all");
        //builder.DialogAction.send('I\'m sorry I didn\'t understand. I can only show start and ring');
    });
    /*
    // Very simple alarm scheduler
    var alarms = {};
    setInterval(function () {
      var now = new Date().getTime();
      for (var key in alarms) {
        var alarm = alarms[key];
        if (now >= alarm.timestamp) {
          var msg = new builder.Message()
            .address(alarm.address)
            .text('Here\'s your \'%s\' alarm.', alarm.title);
          bot.send(msg);
          delete alarms[key];
        }
      }
    }, 15000);
    */
}
if (module) {
    module.exports = {
        aTrainNoKlingon: aTrainNoKlingon,
        aTrainReplies: aTrainReplies,
        restrictData: restrictData,
        isAnonymous: isAnonymous,
        SimpleUpDownRecognizer: SimpleUpDownRecognizer,
        aResponsesOnTooLong: exports.aResponsesOnTooLong,
        metawordsDescriptions: exports.metawordsDescriptions,
        makeBot: makeBot
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvdC9zbWFydGRpYWxvZy5qcyIsIi4uL3NyYy9ib3Qvc21hcnRkaWFsb2cudHMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJidWlsZGVyIiwicmVxdWlyZSIsImRlYnVnIiwiTWF0Y2giLCJBbmFseXplIiwiZmRldnN0YV9tb25tb3ZlXzEiLCJXaGF0SXMiLCJMaXN0QWxsIiwiRGVzY3JpYmUiLCJNYWtlVGFibGUiLCJVdGlscyIsImFib3RfZXJiYXNlXzEiLCJfIiwiRGlhbG9nTG9nZ2VyIiwicHJvY2VzcyIsImRidXJsIiwiZW52IiwiREFUQUJBU0VfVVJMIiwicGdsb2NhbHVybCIsInBnIiwibyIsIkFCT1RfREJOT1NTTCIsImRlZmF1bHRzIiwic3NsIiwiZGlhbG9nTG9nZ2VyIiwibG9nZ2VyIiwic2VuZCIsImRpYWxvZ2xvZyIsImludGVudCIsInNlc3Npb24iLCJyZXNwb25zZSIsInNSZXNwb25zZSIsInNBY3Rpb24iLCJhTWVzc2FnZSIsImlNZXNzYWdlIiwidG9NZXNzYWdlIiwidGV4dCIsImVudGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsImFjdGlvbiIsImVsaXphYm90IiwiZGVidWdsb2ciLCJQbGFpblJlY29nbml6ZXIiLCJnZXRDb252ZXJzYXRpb25JZCIsIm1lc3NhZ2UiLCJhZGRyZXNzIiwiY29udmVyc2F0aW9uIiwiaWQiLCJlbGl6YWJvdHMiLCJnZXRFbGl6YUJvdCIsImFjY2VzcyIsIkRhdGUiLCJuZXdGbG93IiwiZmRldnN0YV9tb25tb3ZlXzIiLCJFeGVjU2VydmVyIiwibW9kZWxzIiwibG9hZE1vZGVsIiwibW9kZWxQYXRoIiwiTW9kZWwiLCJsb2FkTW9kZWxzIiwiaXNBbm9ueW1vdXMiLCJ1c2VyaWQiLCJpbmRleE9mIiwicmVzdHJpY3REYXRhIiwiYXJyIiwibGVuZ3RoIiwibGVuIiwicmVzIiwic2xpY2UiLCJNYXRoIiwibWluIiwibWF4IiwiZmxvb3IiLCJkZWx0YSIsInB1c2giLCJyZXN0cmljdExvZ2dlZE9uIiwidXNlciIsIkFCT1RfRU1BSUxfVVNFUiIsImFUcmFpblJlcGxpZXMiLCJhVHJhaW5EaWFsb2ciLCJhVHJhaW5FeGl0SGludCIsImFFbnRlclRyYWluIiwiYUJhY2tGcm9tVHJhaW5pbmciLCJhVHJhaW5Ob0tsaW5nb24iLCJhUmVzcG9uc2VzT25Ub29Mb25nIiwibWV0YXdvcmRzRGVzY3JpcHRpb25zIiwiZ2V0UmFuZG9tUmVzdWx0IiwicmFuZG9tIiwiU2ltcGxlVXBEb3duUmVjb2duaXplciIsImNvbnRleHQiLCJjYWxsYmFjayIsInUiLCJzY29yZSIsImUxIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwidW5kZWZpbmVkIiwiQW55T2JqZWN0IiwiYm90IiwiZnMiLCJvSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwib1J1bGVzIiwicGFyc2VSdWxlcyIsImxvZ1F1ZXJ5IiwicmVzdWx0IiwiYXBwZW5kRmlsZSIsInRpbWVzdGFtcCIsIlRvb2xNYXRjaCIsImR1bXBOaWNlIiwiY29udmVyc2F0aW9uSWQiLCJlcnIiLCJsb2dRdWVyeVdoYXRJcyIsImxvZ1F1ZXJ5V2hhdElzVHVwZWwiLCJkdW1wTmljZVR1cGVsIiwiZ3dvcmRzIiwibWFrZUJvdCIsImNvbm5lY3RvciIsIm9wdGlvbnMiLCJ0Iiwibm93IiwidGhlTW9kZWwiLCJzaG93TW9kZWxMb2FkVGltZSIsImNvbnNvbGUiLCJsb2ciLCJVbml2ZXJzYWxCb3QiLCJyZWNvZ25pemVyIiwiUmVnRXhwUmVjb2duaXplciIsImRpYWxvZyIsIkludGVudERpYWxvZyIsInJlY29nbml6ZXJzIiwiZGlhbG9nVXBEb3duIiwib25CZWdpbiIsIm1hdGNoZXMiLCJhcmdzIiwibmV4dCIsImRpYWxvZ0RhdGEiLCJhYmMiLCJQcm9tcHRzIiwicmVzdWx0cyIsInJlcG9uc2UiLCJlbmREaWFsb2dXaXRoUmVzdWx0Iiwib25EZWZhdWx0IiwiaXNDb21iaW5lZEluZGV4Iiwib05ld0VudGl0eSIsImExIiwiRW50aXR5UmVjb2duaXplciIsImZpbmRFbnRpdHkiLCJhbmFseXplQWxsIiwiZW50aXR5IiwicnVsZXMiLCJ0b29scyIsImR1bXBXZWlnaHRzVG9wIiwidG9wIiwiaXNDb21wbGV0ZSIsImdldFByb21wdCIsInByb21wdCIsImJlc3QiLCJzZXRQcm9tcHQiLCJleGVjIiwiZXhlY1Rvb2wiLCJyZWNvcmRzIiwicmVwbHkiLCJNZXNzYWdlIiwiYWRkRW50aXR5IiwiZW5hYmxlZCIsImNhdGVnb3J5RW50aXR5IiwiY2F0ZWdvcnkiLCJjYXRzIiwiYW5hbHl6ZUNhdGVnb3J5TXVsdE9ubHlBbmRDb21tYSIsImpvaW4iLCJlIiwidG9TdHJpbmciLCJjYXQiLCJyZXNvbHZlQ2F0ZWdvcnkiLCJhbnN3ZXJzIiwiaW5kaXMiLCJpc0luZGlzY3JpbWluYXRlUmVzdWx0IiwiZXhwbGFpbiIsImVycm9ycyIsIkVyRXJyb3IiLCJleHBsYWluRXJyb3IiLCJkb21haW5DYXRlZ29yeUZpbHRlciIsImdldERvbWFpbkNhdGVnb3J5RmlsdGVyRm9yVGFyZ2V0Q2F0ZWdvcmllcyIsImxpc3RUb1F1b3RlZENvbW1hQW5kIiwicmVzdWx0QXJyIiwicmVzb2x2ZUNhdGVnb3JpZXMiLCJ0dXBlbGFuc3dlcnMiLCJpc0luZGlzY3JpbWluYXRlUmVzdWx0VHVwZWwiLCJpblN0aEVudGl0eSIsImluU29tZXRoaW5nIiwiZG9tYWluIiwiaW5mZXJEb21haW4iLCJzdHJpcFF1b3RlcyIsImFSZXMiLCJnZXRDYXRlZ29yaWVzRm9yRG9tYWluIiwiZG9tYWlucyIsIm1hcCIsIm9Ub29sIiwibmFtZSIsImNhdGVnb3J5U2V0IiwiZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yeSIsInJlc3VsdDEiLCJsaXN0QWxsV2l0aENvbnRleHQiLCJqb2lucmVzdWx0cyIsImpvaW5SZXN1bHRzIiwiZXJycHJlZml4IiwiY2F0ZWdvcnlTZXRGdWxsIiwicmVzdWx0MVQiLCJsaXN0QWxsVHVwZWxXaXRoQ29udGV4dCIsImpvaW5SZXN1bHRzVHVwZWwiLCJyZXN1bHRUIiwiY2F0ZWdvcmllcyIsIm1ha2VUYWJsZSIsImZhY3RFbnRpdHkiLCJmYWN0T3JDYXQiLCJkb21haW5FbnRpdHkiLCJkb21haW5TIiwiZmlsdGVyRG9tYWluIiwidG9Mb3dlckNhc2UiLCJwcmVmaXgiLCJzcGxpdEF0Q29tbWFBbmQiLCJhbmFseXplQ2F0ZWdvcnkiLCJjYXRSZXN1bHRzIiwiZGVzY3JpYmVDYXRlZ29yeSIsInJlc0ZhY3QiLCJkZXNjcmliZUZhY3RJbkRvbWFpbiIsInByZWZpeGVkIiwic2xvcHB5T3JFeGFjdCIsImNhdGVnb3J5V29yZCIsIm9wRW50aXR5Iiwib3BlcmF0b3JXb3JkIiwiZmlsdGVyRG9tYWluRW50aXR5IiwiZmlsdGVyRG9tYWluUyIsIm9wZXJhdG9yIiwiYW5hbHl6ZU9wZXJhdG9yIiwib3BlcmF0b3JBcmdzIiwiZ2V0T3BlcmF0b3IiLCJhMiIsInMiLCJmcmFnbWVudCIsIkJyZWFrRG93biIsInRyaW1RdW90ZWQiLCJ0cmltUXVvdGVkU3BhY2VkIiwiYUZpbHRlcmVkQ2F0ZWdvcmllcyIsImZpbHRlclN0cmluZ0xpc3RCeU9wIiwiY2F0c0ZvckRvbWFpbiIsImludGVyc2VjdGlvbiIsImdldENhdGVnb3J5T3BGaWx0ZXJBc0Rpc3RpbmN0U3RyaW5ncyIsImluZml4RXhwbGFpbiIsImxpa2VseVBsdXJhbERpZmYiLCJiZWdpbkRpYWxvZyIsInVzZXJEYXRhIiwiY291bnQiLCJhbGFybSIsImVsaXphIiwidHJhbnNmb3JtIiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBOzs7Ozs7O0FBT0E7Ozs7O0FBS0E7QUFDQTtBQUNBOzs7Ozs7QURFQUEsT0FBT0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkMsRUFBRUMsT0FBTyxJQUFULEVBQTdDO0FDQUEsSUFBQUMsVUFBQUMsUUFBQSxZQUFBLENBQUE7QUFDQSxJQUFBQyxRQUFBRCxRQUFBLE9BQUEsQ0FBQTtBQUdBLElBQUFFLFFBQUFGLFFBQUEsZ0JB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YUFGRDtBQUdmZixzQkFBZUEsWUFIQTtBQUlmSCxxQkFBY0EsV0FKQztBQUtmNEIsZ0NBQXdCQSxzQkFMVDtBQU1mSiw2QkFBcUJ2RixRQUFBdUYsbUJBTk47QUFPZkMsK0JBQXdCeEYsUUFBQXdGLHFCQVBUO0FBUWZnQyxpQkFBU0E7QUFSTSxLQUFqQjtBQVVEIiwiZmlsZSI6ImJvdC9zbWFydGRpYWxvZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiBUaGUgYm90IGltcGxlbWVudGF0aW9uXG4gKlxuICogSW5zdGFudGlhdGUgYXBzc2luZyBhIGNvbm5lY3RvciB2aWFcbiAqIG1ha2VCb3RcbiAqXG4gKi9cbi8qKlxuICogQGZpbGVcbiAqIEBtb2R1bGUgamZzZWIuZmRldnN0YXJ0LnNtYXJ0ZGlhbG9nXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXG4gKi9cbi8vZGVjbGFyZSBtb2R1bGUgJ2VsaXphYm90JyB7IH07XG4vL2RlY2xhcmUgbW9kdWxlICd3aW5zdG9uLXBnJyB7IH07XG4vL2RlbGNhcmUgbW9kdWxlICd3aW5zdG9uJyB7fTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGJ1aWxkZXIgPSByZXF1aXJlKFwiYm90YnVpbGRlclwiKTtcbmNvbnN0IGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xuY29uc3QgTWF0Y2ggPSByZXF1aXJlKFwiLi4vbWF0Y2gvbWF0Y2hcIik7XG5jb25zdCBBbmFseXplID0gcmVxdWlyZShcIi4uL21hdGNoL2FuYWx5emVcIik7XG5jb25zdCBmZGV2c3RhX21vbm1vdmVfMSA9IHJlcXVpcmUoXCJmZGV2c3RhX21vbm1vdmVcIik7XG5jb25zdCBXaGF0SXMgPSByZXF1aXJlKFwiLi4vbWF0Y2gvd2hhdGlzXCIpO1xuY29uc3QgTGlzdEFsbCA9IHJlcXVpcmUoXCIuLi9tYXRjaC9saXN0YWxsXCIpO1xuY29uc3QgRGVzY3JpYmUgPSByZXF1aXJlKFwiLi4vbWF0Y2gvZGVzY3JpYmVcIik7XG5jb25zdCBNYWtlVGFibGUgPSByZXF1aXJlKFwiLi4vZXhlYy9tYWtlcWJldGFibGVcIik7XG5jb25zdCBVdGlscyA9IHJlcXVpcmUoXCJhYm90X3V0aWxzXCIpO1xuY29uc3QgYWJvdF9lcmJhc2VfMSA9IHJlcXVpcmUoXCJhYm90X2VyYmFzZVwiKTtcbmNvbnN0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xuY29uc3QgRGlhbG9nTG9nZ2VyID0gcmVxdWlyZShcIi4uL3V0aWxzL2RpYWxvZ2xvZ2dlclwiKTtcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKFwicHJvY2Vzc1wiKTtcbnZhciBkYnVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCBcIlwiO1xudmFyIHBnbG9jYWx1cmwgPSBcInBvc3RncmVzOi8vam9lOmFiY2RlZkBsb2NhbGhvc3Q6NTQzMi9hYm90XCI7XG52YXIgZGJ1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgfHwgcGdsb2NhbHVybDtcbmNvbnN0IHBnID0gcmVxdWlyZShcInBnXCIpO1xudmFyIG8gPSBwZztcbmlmICghKHByb2Nlc3MuZW52LkFCT1RfREJOT1NTTCkpIHtcbiAgICBvLmRlZmF1bHRzLnNzbCA9IHRydWU7IC8vIE9ubHkgdXNlZCBpbnRlcm5hbGx5ICFcbn1cbnZhciBkaWFsb2dMb2dnZXIgPSBEaWFsb2dMb2dnZXIubG9nZ2VyKFwic21hcnRib3RcIiwgZGJ1cmwsIHBnKTtcbmZ1bmN0aW9uIHNlbmQobykgeyByZXR1cm4gbzsgfVxuO1xuZnVuY3Rpb24gZGlhbG9nbG9nKGludGVudCwgc2Vzc2lvbiwgcmVzcG9uc2UpIHtcbiAgICB2YXIgc1Jlc3BvbnNlO1xuICAgIHZhciBzQWN0aW9uO1xuICAgIGlmICh0eXBlb2YgcmVzcG9uc2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgc0FjdGlvbiA9IFwiXCI7XG4gICAgICAgIHNSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIGFNZXNzYWdlID0gcmVzcG9uc2U7XG4gICAgICAgIHZhciBpTWVzc2FnZSA9IGFNZXNzYWdlLnRvTWVzc2FnZSgpO1xuICAgICAgICBzUmVzcG9uc2UgPSBpTWVzc2FnZS50ZXh0O1xuICAgICAgICBzQWN0aW9uID0gKGlNZXNzYWdlLmVudGl0aWVzICYmIGlNZXNzYWdlLmVudGl0aWVzWzBdKSA/IChKU09OLnN0cmluZ2lmeShpTWVzc2FnZS5lbnRpdGllcyAmJiBpTWVzc2FnZS5lbnRpdGllc1swXSkpIDogXCJcIjtcbiAgICB9XG4gICAgZGlhbG9nTG9nZ2VyKHtcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgIHJlc3BvbnNlOiBzUmVzcG9uc2UsXG4gICAgICAgIGFjdGlvbjogc0FjdGlvblxuICAgIH0pO1xuICAgIHNlc3Npb24uc2VuZChyZXNwb25zZSk7XG59XG4vL2NvbnN0IHBnTG9nZ2VyID0gbmV3IFBnTG9nZ2VyKHtcbi8vICBuYW1lOiAndGVzdC1sb2dnZXInLFxuLy8gIGxldmVsOiAnZGVidWcnLFxuLy8gIGNvbm5TdHJpbmc6ICdwb3N0Z3JlczovL3VidW50dUBsb2NhbGhvc3Q6NTQzMi9jaXJjbGVfdGVzdCcsXG4vLyAgdGFibGVOYW1lOiAnd2luc3Rvbl9sb2dzJyxcbi8vfSk7XG4vL3dpbnN0b24uYWRkKHdpbnN0b24udHJhbnNwb3J0cy5GaWxlLCB7IGZpbGVuYW1lOiAnd2luc3Rvbl9vdXQubG9nJywgdGltZXN0YW1wIDogdHJ1ZSB9KTtcbi8vICB3aW5zdG9uLnJlbW92ZSh3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSk7XG4vL3dpbnN0b24uYWRkKHBnTG9nZ2VyKTtcbi8qXG5jb25zdCBsb2dnZXIgPSBuZXcgd2luc3Rvbi5Mb2dnZXIoe1xuICB0cmFuc3BvcnRzOiBbXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgIGNvbG9yOiB0cnVlLFxuICAgICAgdGltZXN0YW1wOiB0cnVlLFxuICAgIH0pLFxuICAgIHBnTG9nZ2VyLFxuICBdXG59KTtcbiovXG4vL3BnTG9nZ2VyLmluaXRUYWJsZShkb25lKTtcbnZhciBlbGl6YWJvdCA9IHJlcXVpcmUoJy4uL2V4dGVybi9lbGl6YWJvdC9lbGl6YWJvdC5qcycpO1xuLy9pbXBvcnQgKiBhcyBlbGl6YWJvdCBmcm9tICdlbGl6YWJvdCc7XG5sZXQgZGVidWdsb2cgPSBkZWJ1Zygnc21hcnRkaWFsb2cnKTtcbmNvbnN0IFBsYWluUmVjb2duaXplciA9IHJlcXVpcmUoXCIuL3BsYWlucmVjb2duaXplclwiKTtcbi8vdmFyIGJ1aWxkZXIgPSByZXF1aXJlKCdib3RidWlsZGVyJyk7XG5mdW5jdGlvbiBnZXRDb252ZXJzYXRpb25JZChzZXNzaW9uKSB7XG4gICAgcmV0dXJuIHNlc3Npb24ubWVzc2FnZSAmJlxuICAgICAgICBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcyAmJlxuICAgICAgICBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQ7XG59XG52YXIgZWxpemFib3RzID0ge307XG5mdW5jdGlvbiBnZXRFbGl6YUJvdChpZCkge1xuICAgIGlmICghZWxpemFib3RzW2lkXSkge1xuICAgICAgICBlbGl6YWJvdHNbaWRdID0ge1xuICAgICAgICAgICAgYWNjZXNzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgZWxpemFib3Q6IG5ldyBlbGl6YWJvdCgpXG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsaXphYm90c1tpZF0uYWNjZXNzID0gbmV3IERhdGUoKTtcbiAgICByZXR1cm4gZWxpemFib3RzW2lkXS5lbGl6YWJvdDtcbn1cbnZhciBuZXdGbG93ID0gdHJ1ZTtcbmNvbnN0IGZkZXZzdGFfbW9ubW92ZV8yID0gcmVxdWlyZShcImZkZXZzdGFfbW9ubW92ZVwiKTtcbmNvbnN0IEV4ZWNTZXJ2ZXIgPSByZXF1aXJlKFwiLi4vZXhlYy9leGVjc2VydmVyXCIpO1xuLy9jb25zdCB0aGVEZWZhdWx0TW9kZWwgPSBNb2RlbC5sb2FkTW9kZWxzKCk7XG52YXIgbW9kZWxzID0ge307XG5mdW5jdGlvbiBsb2FkTW9kZWwobW9kZWxQYXRoKSB7XG4gICAgbW9kZWxQYXRoID0gbW9kZWxQYXRoIHx8IFwiXCI7XG4gICAgaWYgKCFtb2RlbHNbbW9kZWxQYXRoXSkge1xuICAgICAgICBtb2RlbHNbbW9kZWxQYXRoXSA9IGZkZXZzdGFfbW9ubW92ZV8yLk1vZGVsLmxvYWRNb2RlbHMobW9kZWxQYXRoKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vZGVsc1ttb2RlbFBhdGhdO1xufVxuaWYgKG5ld0Zsb3cpIHtcbn1cbmVsc2Uge1xuICAgIC8vY29uc3QgdG9vbHMgPSBUb29scy5nZXRUb29scygpO1xuICAgIC8vY29uc3QgSW5wdXRGaWx0ZXJSdWxlcyA9IHJlcXVpcmUoJy4uL21hdGNoL2lucHV0RmlsdGVyUnVsZXMuanMnKTtcbiAgICAvL2NvbnN0IG1SdWxlcyA9IElucHV0RmlsdGVyUnVsZXMuZ2V0TVJ1bGVzU2FtcGxlKCk7XG59XG5mdW5jdGlvbiBpc0Fub255bW91cyh1c2VyaWQpIHtcbiAgICByZXR1cm4gdXNlcmlkLmluZGV4T2YoXCJhbm86XCIpID09PSAwO1xufVxuZnVuY3Rpb24gcmVzdHJpY3REYXRhKGFycikge1xuICAgIGlmIChhcnIubGVuZ3RoIDwgNikge1xuICAgICAgICByZXR1cm4gYXJyO1xuICAgIH1cbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcbiAgICB2YXIgcmVzID0gYXJyLnNsaWNlKDAsIE1hdGgubWluKE1hdGgubWF4KE1hdGguZmxvb3IoYXJyLmxlbmd0aCAvIDMpLCA3KSwgYXJyLmxlbmd0aCkpO1xuICAgIGlmICh0eXBlb2YgYXJyWzBdID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHZhciBkZWx0YSA9IGxlbiAtIHJlcy5sZW5ndGg7XG4gICAgICAgIHJlcy5wdXNoKFwiLi4uIGFuZCBcIiArIGRlbHRhICsgXCIgbW9yZSBlbnRyaWVzIGZvciByZWdpc3RlcmVkIHVzZXJzXCIpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5yZXN0cmljdERhdGEgPSByZXN0cmljdERhdGE7XG5mdW5jdGlvbiByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFycikge1xuICAgIHZhciB1c2VyaWQgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIjtcbiAgICBpZiAocHJvY2Vzcy5lbnYuQUJPVF9FTUFJTF9VU0VSICYmIGlzQW5vbnltb3VzKHVzZXJpZCkpIHtcbiAgICAgICAgcmV0dXJuIHJlc3RyaWN0RGF0YShhcnIpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xufVxuLypcbmV4cG9ydCBjbGFzcyBTaW1wbGVSZWNvZ25pemVyIGltcGxlbWVudHMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuXHJcbiAgfVxuXHJcbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXHJcbiAgICBkZWJ1Z2xvZyhcInJlY29nbml6aW5nIFwiICsgY29udGV4dC5tZXNzYWdlLnRleHQpO1xuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwic3RhcnRcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcIlNob3dFbnRpdHlcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJzdGFydCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxyXG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ0cmFpblwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwidHJhaW5cIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImxlYXJuXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJsZWFyblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnR5cGUgPSBcInRyYWluRmFjdFwiO1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJoZWxwXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJoZWxwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJleGl0XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcIndyb25nXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ3cm9uZ1wiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgIGUxLnNjb3JlID0gMC4xO1xuICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICB9XG59XG4qL1xuY29uc3QgYVRyYWluUmVwbGllcyA9IFtcIlRoYW5rIHlvdSBmb3Igc2hhcmluZyB0aGlzIHN1Z2dlc3Rpb24gd2l0aCB1c1wiLFxuICAgIFwiVGhhbmsgZm9yIGZvciB0aGlzIHZhbHVhYmxlIGluZm9ybWF0aW9uLlwiLFxuICAgIFwiVGhhbmsgZm9yIGZvciB0aGlzIGludGVyZXN0aW5nIGZhY3QhXCIsXG4gICAgXCJUaGF0cyBhIHBsZXRob3JpYSBvZiBpbmZvcm1hdGlvbi5cIixcbiAgICBcIlRoYXQncyBhIG51Z2dldCBvZiBpbmZvcm1hdGlvbi5cIixcbiAgICBcIkxvdmVseSwgSSBtYXkgY29uc2lkZXIgeW91IGlucHV0LlwiLFxuICAgIFwiV2VsbCBkb25lLCBhbnl0aGluZyBtb3JlIHRvIGxldCBtZSBrbm93P1wiLFxuICAgIFwiSSBkbyBhcHByZWNpYXRlIHlvdXIgdGVhY2hpbmcgYW5kIG15IGxlYXJuaW5nIGV4cGVyaWVuY2UsIG9yIHdhcyBpdCB0aGUgb3RoZXIgd2F5IHJvdW5kP1wiLFxuICAgIFwiWW91ciBoZWxwZnVsIGlucHV0IGhhcyBiZWVuIHN0b3JlZCBpbiBzb21lIGR1c3R5IGNvcm5lciBvZiB0aGUgV29ybGQgd2lkZSB3ZWIhXCIsXG4gICAgXCJUaGFuayB5b3UgZm9yIG15IGxlYXJuaW5nIGV4cGVyaWVuY2UhXCIsXG4gICAgXCJJIGhhdmUgaW5jb3Jwb3JhdGVkIHlvdXIgdmFsdWFibGUgc3VnZ2VzdGlvbiBpbiB0aGUgd2lzZG9tIG9mIHRoZSBpbnRlcm5ldFwiXG5dO1xudmFyIGFUcmFpbkRpYWxvZyA9IGFUcmFpblJlcGxpZXM7XG52YXIgYVRyYWluRXhpdEhpbnQgPSBbXG4gICAgXCJcXG50eXBlIFxcXCJkb25lXFxcIiB3aGVuIHlvdSBhcmUgZG9uZSB0cmFpbmluZyBtZS5cIixcbiAgICBcIlwiLFxuICAgIFwiXCIsXG4gICAgXCJcIixcbiAgICBcIlxcbnJlbWVtYmVyLCB5b3UgYXJlIHN0dWNrIGhlcmUgaW5zdHJ1Y3RpbmcgbWUsIHR5cGUgXFxcImRvbmVcXFwiIHRvIHJldHVybi5cIixcbiAgICBcIlwiXG5dO1xuY29uc3QgYUVudGVyVHJhaW4gPSBbJ1NvIHlvdSB0aGluayB0aGlzIGlzIHdyb25nPyBZb3UgY2FuIG9mZmVyIHlvdXIgYWR2aXNlIGhlcmUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuICAgICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG5UeXBlIFwiZG9uZVwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lJyxcbiAgICAnU29tZSBzYXkgXCJUaGUgc2VjcmV0IHRvIGhhcHBpbmVzcyBpcyB0byBsb3dlciB5b3VyIGV4cGVjdGF0aW9ucyB0byB0aGUgcG9pbnQgdGhleSBhcmUgYWxyZWFkeSBtZXQuXCIsIFxcbnQgaWYgeW91IGNvdWxkIGhlbHAgbWUgdG8gYmVjb21lIGJldHRlciwgaW5zdHJ1Y3QgbWUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggdGVhY2hpbmcgbWUnLFxuICAgICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZScsXG4gICAgJ0ZlZWwgZnJlZSB0byBvZmZlciBtZSB5b3VyIGJldHRlciBzb2x1dGlvbiBoZXJlLlxcbiBUeXBlIFwiZG9uZVwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lJyxcbl07XG5jb25zdCBhQmFja0Zyb21UcmFpbmluZyA9IFtcbiAgICAnUHV1aCwgYmFjayBmcm9tIHRyYWluaW5nISBOb3cgZm9yIHRoZSBlYXN5IHBhcnQgLi4uXFxuIGFzayBtZSBhIG5ldyBxdWVzdGlvbi4nLFxuICAgICdMaXZlIGFuZCBkb25cXCd0IGxlYXJuLCB0aGF0XFwncyB1cy4gTmFhaCwgd2VcXCdsbCBzZWUuXFxuQXNrIG1lIGFub3RoZXIgcXVlc3Rpb24uJyxcbiAgICAnVGhlIHNlY3JldCB0byBoYXBwaW5lc3MgaXMgdG8gbG93ZXIgeW91ciBleHBlY3RhdGlvbnMgdG8gdGhlIHBvaW50IHRoZXkgYXJlIGFscmVhZHkgbWV0LlxcbiBBc2sgbWUgYSBxdWVzdGlvbi4nLFxuICAgICdUaGFua3MgZm9yIGhhdmluZyB0aGlzIGxlY3R1cmUgc2Vzc2lvbiwgbm93IGkgYW0gYmFjayB0byBvdXIgdXN1YWwgc2VsZi5cXG4gQXNrIG1lIGEgcXVlc3Rpb24uJ1xuXTtcbmNvbnN0IGFUcmFpbk5vS2xpbmdvbiA9IFtcbiAgICBcIkhlIHdobyBtYXN0ZXJzIHRoZSBkYXJrIGFydHMgb2YgU0FQIG11c3Qgbm90IGR3ZWxsIGluIHRoZSBlYXJ0aGx5IHJlYWxtcyBvZiBTdGFydCBUcmVrLlwiLFxuICAgIFwiU0FQIGlzIGEgY2xvdWQgY29tcGFueSwgbm90IGEgc3BhY2UgY29tcGFueS5cIixcbiAgICBcIlRoZSBkZXB0aCBvZiBSLzMgYXJlIGRlZXBlciB0aGFuIERlZXAgU3BhY2UgNDIuXCIsXG4gICAgXCJNeSBicmFpbnBvd2VyIGlzIGZ1bGx5IGFic29yYmVkIHdpdGggbWFzdGVyaW5nIG90aGVyIHJlYWxtcy5cIixcbiAgICBcIkZvciB0aGUgd29zYXAsIHRoZSBza3kgaXMgdGhlIGxpbWl0LiBGZWVsIGZyZWUgdG8gY2hlY2sgb3V0IG5hc2EuZ292IC5cIixcbiAgICBcIlRoZSBmdXR1cmUgaXMgU0FQIG9yIElCTSBibHVlLCBub3Qgc3BhY2UgYmxhY2suXCIsXG4gICAgXCJUaGF0J3MgbGVmdCB0byBzb21lIG11c2t5IGZ1dHVyZS5cIlxuXTtcbmV4cG9ydHMuYVJlc3BvbnNlc09uVG9vTG9uZyA9IFtcbiAgICBcIllvdXIgaW5wdXQgc2hvdWxkIGJlIGVsb3F1ZW50IGluIGl0J3MgYnJldml0eS4gVGhpcyBvbmUgd2FzIHRvbyBsb25nLlwiLFxuICAgIFwibXkgd2lzZG9tIGlzIHNldmVybHkgYm91bmQgYnkgbXkgbGltaXRlZCBpbnB1dCBwcm9jZXNzaW5nIGNhcGFiaWxpdGllcy4gQ291bGQgeW91IGZvcm11bGF0ZSBhIHNob3J0ZXIgaW5wdXQ/IFRoYW5rIHlvdS5cIixcbiAgICBcIlRoZSBsZW5ndGggb2YgeW91IGlucHV0IGluZGljYXRlcyB5b3UgcHJvYmFibHkga25vdyBtb3JlIGFib3V0IHRoZSB0b3BpYyB0aGFuIG1lPyBDYW4gaSBodW1ibHkgYXNrIHlvdSB0byBmb3JtdWxhdGUgYSBzaG9ydGVyIHF1ZXN0aW9uP1wiLFxuICAgICdcXFwiV2hhdCBldmVyIHlvdSB3YW50IHRvIHRlYWNoLCBiZSBicmllZlxcXCIgKEhvcmFjZSkuIFdoaWxlIHRoaXMgZG9lcyBub3QgYWx3YXlzIGFwcGxpZXMgdG8gbXkgYW5zd2VycywgaXQgaXMgcmVxdWlyZSBmb3IgeW91ciBxdWVzdGlvbnMuIFBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIHJlZmluZWQgcXVlc3Rpb25zLicsXG4gICAgJ0kgdW5kZXJzdGFuZCBtb3JlIHRoYW4gNC1sZXR0ZXIgd29yZHMsIGJ1dCBub3QgbW9yZSB0aGFuIDIwIHdvcmQgc2VudGVuY2VzLiBQbGVhc2UgdHJ5IHRvIHNob3J0ZW4geW91ciBpbnB1dC4nLFxuICAgICd0aGUgc2t5IGlzIHRoZSBsaW1pdD8gQWlyIGZvcmNlIG1lbWJlciBvciBub3QsIHlvdSBjYW4gYXNrIGxvbmdlciBxdWVzdGlvbnMgdGhhbiBcXFwidGhlIHNreVxcXCIsIGJ1dCBub3QgdGhpcyBsb25nJyxcbiAgICAnTXkgYW5zd2VycyBtYXkgYmUgZXhoYXVzdGl2ZSwgYnV0IEkgdW5kZXJzdGFuZCBtb3JlIHRoYW4gNC1sZXR0ZXIgd29yZHMsIGJ1dCBub3QgbW9yZSB0aGFuIDIwIHdvcmQgc2VudGVuY2VzLiBTb3JyeS4nLFxuICAgICdPdXIgY29udmVyc2F0aW9uIG11c3QgYmUgaGlnaGx5IGFzc3ltbWV0cmljOiBteSBhbnN3ZXJzIG1heSBiZSB2ZXJib3NlIGFuZCBleGhhdXN0aXZlIGFuZCBmdXp6eSwgcXVlc3Rpb25zIGFuZCBpbnB1dCBtdXN0IGJlIGJyaWVmLiBUcnkgdG8gcmVmb3JtdWxhdGUgaXQnLFxuXTtcbmV4cG9ydHMubWV0YXdvcmRzRGVzY3JpcHRpb25zID0ge1xuICAgIFwiY2F0ZWdvcnlcIjogXCJhbiBhdHRyaWJ1dGUgb2YgYSByZWNvcmQgaW4gYSBtb2RlbCwgZXhhbXBsZTogYSBQbGFuZXQgaGFzIGEgXFxcIm5hbWVcXFwiIGF0dHJpYnV0ZVwiLFxuICAgIFwiZG9tYWluXCI6IFwiYSBncm91cCBvZiBmYWN0cyB3aGljaCBhcmUgdHlwaWNhbGx5IHVucmVsYXRlZFwiLFxuICAgIFwia2V5XCI6IFwiYW4gYXR0cmlidXRlIHZhbHVlIChvZiBhIGNhdGVnb3J5KSB3aGljaCAgaXMgdW5pcXVlIGZvciB0aGUgcmVjb3JkXCIsXG4gICAgXCJ0b29sXCI6IFwiaXMgcG90ZW50aWFseSBjb21tYW5kIHRvIGV4ZWN1dGVcIixcbiAgICBcInJlY29yZFwiOiBcImEgc3BlY2lmaWMgc2V0IG9mIFxcXCJmYWN0XFxcInMgb2YgYSBkb21haW4sIGEgXFxcInJlY29yZFxcXCIgaGFzIGEgc2V0IG9mIGF0dHJpYnV0ZXMgdmFsdWVzIChcXFwiZmFjdFxcXCJzKSBvZiB0aGUgY2F0ZWdvcmllcywgb2Z0ZW4gYSByZWNvcmQgaGFzIGEgXFxcImtleVxcXCJcIixcbiAgICBcImZhY3RcIjogXCJhIHNwZWNpZmljIGNhdGVnb3J5IHZhbHVlIG9mIGEgcmVjb3JkIGluIGEgZG9tYWluLCBtYXkgYmUgYSBcXFwia2V5XFxcIiB2YWx1ZVwiLFxufTtcbmZ1bmN0aW9uIGdldFJhbmRvbVJlc3VsdChhcnIpIHtcbiAgICByZXR1cm4gYXJyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFyci5sZW5ndGgpICUgYXJyLmxlbmd0aF07XG59XG5jbGFzcyBTaW1wbGVVcERvd25SZWNvZ25pemVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG4gICAgcmVjb2duaXplKGNvbnRleHQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB1ID0ge307XG4gICAgICAgIGRlYnVnbG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiZG93blwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LmRvd25cIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ1cFwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJkb25lXCIpID49IDApIHtcbiAgICAgICAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgICAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImV4aXRcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwicXVpdFwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICAgICAgdS5pbnRlbnQgPSBcIk5vbmVcIjtcbiAgICAgICAgdS5zY29yZSA9IDAuMTtcbiAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICB9XG59XG5leHBvcnRzLlNpbXBsZVVwRG93blJlY29nbml6ZXIgPSBTaW1wbGVVcERvd25SZWNvZ25pemVyO1xuY29uc3QgQW55T2JqZWN0ID0gT2JqZWN0O1xuLy8gZ2xvYmFsVHVubmVsLmluaXRpYWxpemUoe1xuLy8gIGhvc3Q6ICdwcm94eS5leHh4YW1wbGUuY29tJyxcbi8vICBwb3J0OiA4MDgwXG4vLyB9KVxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG4vLyBjb25uZWN0b3Iuc2V0QW5zd2VySG9vayhmdW5jdGlvbiAoc0Fuc3dlcikge1xuLy8gIGNvbnNvbGUubG9nKCdHb3QgYW5zd2VyIDogJyArIHNBbnN3ZXIgKyAnXFxuJylcbi8vIH0pXG52YXIgYm90O1xuLy8gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4vLyAgIGNvbm5lY3Rvci5wcm9jZXNzTWVzc2FnZSgnc3RhcnQgdW5pdCB0ZXN0IEFCQyAnKVxuLy8gfSwgNTAwMClcbmNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xudmFyIG9KU09OID0gSlNPTi5wYXJzZSgnJyArIGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvaW50ZW50cy5qc29uJykpO1xudmFyIG9SdWxlcyA9IFBsYWluUmVjb2duaXplci5wYXJzZVJ1bGVzKG9KU09OKTtcbi8vIHZhciBSZWNvZ25pemVyID0gbmV3IChyZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIpKG9SdWxlcyk7XG5mdW5jdGlvbiBsb2dRdWVyeShzZXNzaW9uLCBpbnRlbnQsIHJlc3VsdCkge1xuICAgIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHRleHQ6IHNlc3Npb24ubWVzc2FnZS50ZXh0LFxuICAgICAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgICAgIGludGVudDogaW50ZW50LFxuICAgICAgICByZXM6IHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoICYmIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShyZXN1bHRbMF0pIHx8IFwiMFwiLFxuICAgICAgICBjb252ZXJzYXRpb25JZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvblxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgICAgIHVzZXJpZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIlxuICAgIH0pLCBmdW5jdGlvbiAoZXJyLCByZXMpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgZGVidWdsb2coXCJsb2dnaW5nIGZhaWxlZCBcIiArIGVycik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sIGludGVudCwgcmVzdWx0KSB7XG4gICAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgV2hhdElzLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICAgICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gICAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9nUXVlcnlXaGF0SXNUdXBlbChzZXNzaW9uLCBpbnRlbnQsIHJlc3VsdCkge1xuICAgIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHRleHQ6IHNlc3Npb24ubWVzc2FnZS50ZXh0LFxuICAgICAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgICAgIGludGVudDogaW50ZW50LFxuICAgICAgICByZXM6IHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoICYmIFdoYXRJcy5kdW1wTmljZVR1cGVsKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICAgICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gICAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxudmFyIGd3b3JkcyA9IHt9O1xuLyoqXG4gKiBDb25zdHJ1Y3QgYSBib3RcbiAqIEBwYXJhbSBjb25uZWN0b3Ige0Nvbm5lY3Rvcn0gdGhlIGNvbm5lY3RvciB0byB1c2VcbiAqIEhUTUxDb25uZWN0b3JcbiAqIG9yIGNvbm5lY3RvciA9IG5ldyBidWlsZGVyLkNvbnNvbGVDb25uZWN0b3IoKS5saXN0ZW4oKVxuICovXG5mdW5jdGlvbiBtYWtlQm90KGNvbm5lY3RvciwgbW9kZWxQYXRoLCBvcHRpb25zKSB7XG4gICAgdmFyIHQgPSBEYXRlLm5vdygpO1xuICAgIHZhciB0aGVNb2RlbCA9IGxvYWRNb2RlbChtb2RlbFBhdGgpO1xuICAgIHZhciB0ID0gRGF0ZS5ub3coKSAtIHQ7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zaG93TW9kZWxMb2FkVGltZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhgbW9kZWwgbG9hZCB0aW1lICR7KHQpfWApO1xuICAgIH1cbiAgICBib3QgPSBuZXcgYnVpbGRlci5Vbml2ZXJzYWxCb3QoY29ubmVjdG9yKTtcbiAgICAvLyBDcmVhdGUgTFVJUyByZWNvZ25pemVyIHRoYXQgcG9pbnRzIGF0IG91ciBtb2RlbCBhbmQgYWRkIGl0IGFzIHRoZSByb290ICcvJyBkaWFsb2cgZm9yIG91ciBDb3J0YW5hIEJvdC5cbiAgICAvLyB2YXIgbW9kZWwgPSBzZW5zaXRpdmUubW9kZWx1cmw7XG4gICAgLy8gdmFyIG1vZGVsID0gJ2h0dHBzOi8vYXBpLnByb2plY3RveGZvcmQuYWkvbHVpcy92Mi4wL2FwcHMvYzQxM2IyZWYtMzgyYy00NWJkLThmZjAtZjc2ZDYwZTJhODIxP3N1YnNjcmlwdGlvbi1rZXk9YzIxMzk4YjU5ODBhNGNlMDlmNDc0YmJmZWU5M2I4OTImcT0nXG4gICAgdmFyIHJlY29nbml6ZXIgPSBuZXcgUGxhaW5SZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIob1J1bGVzKTtcbiAgICB2YXIgZGlhbG9nID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtyZWNvZ25pemVyXSB9KTtcbiAgICAvLyBkaWFsb2cub25CZWdpbihmdW5jdGlvbihzZXNzaW9uLGFyZ3MpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcImJlZ2lubmluZyAuLi5cIilcbiAgICAvLyBzZXNzaW9uLmRpYWxvZ0RhdGEucmV0cnlQcm9tcHQgPSBhcmdzICYmIGFyZ3MucmV0cnlQcm9tcHQgfHwgXCJJIGFtIHNvcnJ5XCJcbiAgICAvLyBzZXNzaW9uLnNlbmQoXCJXaGF0IGRvIHlvdSB3YW50P1wiKVxuICAgIC8vXG4gICAgLy8gfSlcbiAgICB2YXIgZGlhbG9nVXBEb3duID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtuZXcgU2ltcGxlVXBEb3duUmVjb2duaXplcigpXSB9KTtcbiAgICBib3QuZGlhbG9nKCcvdXBkb3duJywgZGlhbG9nVXBEb3duKTtcbiAgICBkaWFsb2dVcERvd24ub25CZWdpbihmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGFFbnRlclRyYWluKSkpO1xuICAgICAgICAvL3Nlc3Npb24uc2VuZChcIkhpIHRoZXJlLCB1cGRvd24gaXMgd2FpdGluZyBmb3IgeW91XCIpO1xuICAgIH0pO1xuICAgIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQudXAnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBleGl0IHRyYWluaW5nPyB0eXBlIFxcXCJkb25lXFxcIiBhZ2Fpbi4nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSByZXN1bHRzLnJlcG9uc2U7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyB9KTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQuZG93bicsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIGRvd24hJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gLTE7IC8vIHJlc3VsdHMucmVwb25zZTtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcInN0aWxsIGdvaW5nIGRvd24/XCIpO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nVXBEb3duLm9uRGVmYXVsdChmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgICAgICBsb2dRdWVyeShzZXNzaW9uLCBcIm9uRGVmYXVsdFwiKTtcbiAgICAgICAgdmFyIHJlcyA9IGdldFJhbmRvbVJlc3VsdChhVHJhaW5EaWFsb2cpICsgZ2V0UmFuZG9tUmVzdWx0KGFUcmFpbkV4aXRIaW50KTtcbiAgICAgICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKHJlcykpO1xuICAgIH0pO1xuICAgIC8qXG4gICAgICBib3QuZGlhbG9nKCcvdHJhaW4nLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgc2Vzc2lvbi5kaWFsZ29EYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ0RvIHlvdSB3YW50IHRvIHRyYWluIG1lJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IHJlc3VsdHMucmVwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5EaWFsb2dEYXRhLmFiYyB9KTtcbiAgICAgICAgfVxuICAgICAgXSk7XG4gICAgKi9cbiAgICBib3QuZGlhbG9nKCcvJywgZGlhbG9nKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnU2hvd01lJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIlNob3cgRW50aXR5XCIpO1xuICAgICAgICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBBbmFseXplLmFuYWx5emVBbGwoYTEuZW50aXR5LCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwudG9vbHMsIGd3b3Jkcyk7XG4gICAgICAgICAgICBsb2dRdWVyeShzZXNzaW9uLCAnU2hvd01lJywgcmVzdWx0KTtcbiAgICAgICAgICAgIC8vIHRlc3QuZXhwZWN0KDMpXG4gICAgICAgICAgICAvLyAgdGVzdC5kZWVwRXF1YWwocmVzdWx0LndlaWdodCwgMTIwLCAnY29ycmVjdCB3ZWlnaHQnKTtcbiAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICBkZWJ1Z2xvZygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCd0b3AgOiAnICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBXZWlnaHRzVG9wKHJlc3VsdCwgeyB0b3A6IDMgfSkpO1xuICAgICAgICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShyZXN1bHRbMF0pKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgICAgICAgICAvLyAgICBzZXNzaW9uLnNlbmQoJ1Nob3dpbmcgZW50aXR5IC4uLicpO1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbXB0ID0gQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0ID0gcmVzdWx0WzBdO1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQgPSBwcm9tcHQ7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkpO1xuICAgICAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sIHByb21wdC50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBiZXN0ID0gcmVzdWx0Lmxlbmd0aCA/IE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShyZXN1bHRbMF0pIDogXCI8bm90aGluZz5cIjtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkaWQgbm90IHVuZGVyc3RhbmQgdGhpcycgKyBiZXN0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdDtcbiAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHNvbWUgcHJvbXB0aW5nXG4gICAgICAgICAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbXB0ID0gQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCA9IHByb21wdDtcbiAgICAgICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdDtcbiAgICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0LCByZXN1bHRzLnJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGV4ZWMudGV4dClcbiAgICAgICAgICAgICAgICAgICAgLmFkZEVudGl0eShleGVjLmFjdGlvbik7XG4gICAgICAgICAgICAgICAgLy8gLmFkZEF0dGFjaG1lbnQoeyBmYWxsYmFja1RleHQ6IFwiSSBkb24ndCBrbm93XCIsIGNvbnRlbnRUeXBlOiAnaW1hZ2UvanBlZycsIGNvbnRlbnRVcmw6IFwid3d3LndvbWJhdC5vcmdcIiB9KTtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgZ2V0IHdoYXQgeW91IHdhbnRcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnV2hhdElzJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXRpZXNcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzLCB1bmRlZmluZWQsIDIpKSA6ICctJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcnknKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IGNhdGVnb3J5RW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBhMSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuICAgICAgICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIChlID8gJygnICsgZS50b1N0cmluZygpICsgJyknIDogXCJcIikpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIHdlIGhhdmUgc29tZSBjYXRzLCAob3IgYXQgbGVhc3Qgb25lKVxuICAgICAgICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgICAgICAgICAgICBpZiAoIWNhdCkge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdXSSBjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcnkoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCd3aGF0aXMgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ1doYXRJcycsIHJlc3VsdC5hbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdChyZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGlzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQuYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGxhaW4gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBsYWluID0gYWJvdF9lcmJhc2VfMS5FckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHQuZXJyb3JzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ICsgXCIgKFwiICsgY2F0ZWdvcnkgKyAnKVxcXCIgaW4gcmVsYXRpb24gdG8gXCInICsgYTEuZW50aXR5ICsgYFwiLiR7ZXhwbGFpbn1gKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQuYW5zd2Vyc1swXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSkgOiAnLScpO1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCd0b3AgOiAnICsgV2hhdElzLmR1bXBXZWlnaHRzVG9wKHJlc3VsdC5hbnN3ZXJzLCB7IHRvcDogMyB9KSkgOiAnLScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIGNsZWFuc2VkIHNlbnRlbmNlXG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdUaGUgJyArIGNhdGVnb3J5ICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBpcyAnICsgcmVzdWx0LmFuc3dlcnNbMF0ucmVzdWx0ICsgXCJcXG5cIikpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vIHNpbmdsZSBjYXRlZ29yeVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ1dJIGNhdGVnb3JpZXMgaWRlbnRpZmllZDonICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvbWFpbkNhdGVnb3J5RmlsdGVyID0gZmRldnN0YV9tb25tb3ZlXzIuTW9kZWwuZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGxhaW4gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyBcIlxcXCIgKFwiICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQoY2F0cykgKyAnKVxcXCIgaW4gcmVsYXRpb24gdG8gXCInICsgYTEuZW50aXR5ICsgYFwiJHtleHBsYWlufWApKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRBcnIgPSBXaGF0SXMucmVzb2x2ZUNhdGVnb3JpZXMoY2F0cywgYTEuZW50aXR5LCB0aGVNb2RlbCwgZG9tYWluQ2F0ZWdvcnlGaWx0ZXIpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ211bHN0IHdoYXRpcyByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdEFycikpIDogJy0nKTtcbiAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdXaGF0SXMnLCByZXN1bHRBcnIudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdFR1cGVsKHJlc3VsdEFyci50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoaW5kaXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRBcnIgfHwgIXJlc3VsdEFyci50dXBlbGFuc3dlcnMgfHwgcmVzdWx0QXJyLnR1cGVsYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGxhaW4gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdEFyci5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBsYWluID0gYWJvdF9lcmJhc2VfMS5FckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHRBcnIuZXJyb3JzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyBcIlxcXCIgKFwiICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQoY2F0cykgKyAnKVxcXCIgaW4gcmVsYXRpb24gdG8gXCInICsgYTEuZW50aXR5ICsgYFwiJHtleHBsYWlufWApKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdEFyci50dXBlbGFuc3dlcnNbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpIDogJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgLy9kZWJ1Z2xvZygndG9wIDogJyArIFdoYXRJcy5kdW1wV2VpZ2h0c1RvcChyZXN1bHRBcnIsIHsgdG9wOiAzIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnVGhlICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRzKSArICcgb2YgJyArIGExLmVudGl0eSArICcgYXJlICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChyZXN1bHRBcnIudHVwZWxhbnN3ZXJzWzBdLnJlc3VsdCkgKyAnXFxuJykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vZW5kaWYgbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGwnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICAgICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgICAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIkludGVudCA6IExpc3RBbGxcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzLCB1bmRlZmluZWQsIDIpKSA6ICctJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcmllcycpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgdmFyIGluU3RoRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2luc3RoJyk7XG4gICAgICAgICAgICB2YXIgaW5Tb21ldGhpbmcgPSBpblN0aEVudGl0eSAmJiBpblN0aEVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICAvLyBzb21lIG1ldGFxdWVyaWVzOlxuICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSBcImNhdGVnb3JpZXNcIikge1xuICAgICAgICAgICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXIgP1xuICAgICAgICAgICAgICAgIHZhciBkb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGluU29tZXRoaW5nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFkb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuY2F0ZWdvcnkpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5Tb21ldGhpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBpbmZlciBhIGRvbWFpbiByZXN0cmljdGlvbiBmcm9tIFxcXCJcIiArIFV0aWxzLnN0cmlwUXVvdGVzKGluU29tZXRoaW5nKSArIFwiXFxcIiwgYWxsIG15IGNhdGVnb3JpZXMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhUmVzID0gZmRldnN0YV9tb25tb3ZlXzIuTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IGNhdGVnb3JpZXMgaW4gZG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCB0aGVNb2RlbC5kb21haW5zKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSBkb21haW5zIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwudG9vbHMpLm1hcChmdW5jdGlvbiAob1Rvb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9Ub29sLm5hbWU7XG4gICAgICAgICAgICAgICAgfSkuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgdG9vbHMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjYXRzIHx8IChjYXRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY2F0ID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNhdCA9IGNhdHNbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnc2luZ2xlIGNhdGVnb3J5IGlkZW50aWZpZWQ6JyArIGNhdCk7XG4gICAgICAgICAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBpblNvbWV0aGluZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IGZkZXZzdGFfbW9ubW92ZV8yLk1vZGVsLmdldERvbWFpbkNhdGVnb3J5RmlsdGVyRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsV2l0aENvbnRleHQoY2F0LCBpblNvbWV0aGluZywgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cgPyAoJ2xpc3RhbGwgcmVzdWx0ID46JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0cyhyZXN1bHQxLmFuc3dlcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQxLmFuc3dlcnMpO1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZyA/ICgnbGlzdGFsbCByZXN1bHQyID46JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2lucmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgaW5Tb21ldGhpbmcgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycnByZWZpeCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0MS5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycHJlZml4ID0gYWJvdF9lcmJhc2VfMS5FckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHQxLmVycm9ycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGluU29tZXRoaW5nICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSArIFwiXCIgKyBlcnJwcmVmaXgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBubyBmaWx0ZXIgZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gZmRldnN0YV9tb25tb3ZlXzIuTW9kZWwuZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBMaXN0QWxsLmxpc3RBbGxXaXRoQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmFuc3dlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSkgOiAnLScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0LmFuc3dlcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0cyhyZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG11bHRpcGxlIGNhdGVnb3JpZXNcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5Tb21ldGhpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGluU29tZXRoaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb21haW5DYXRlZ29yeUZpbHRlciA9IGZkZXZzdGFfbW9ubW92ZV8yLk1vZGVsLmdldERvbWFpbkNhdGVnb3J5RmlsdGVyRm9yVGFyZ2V0Q2F0ZWdvcmllcyh0aGVNb2RlbCwgY2F0cywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgY2Fubm90IGNvbWJpbmUgXCInICsgY2F0ZWdvcnkgKyAnKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0MVQgPSBMaXN0QWxsLmxpc3RBbGxUdXBlbFdpdGhDb250ZXh0KGNhdHMsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgZG9tYWluQ2F0ZWdvcnlGaWx0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MVQpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdDFULnR1cGVsYW5zd2VycykpO1xuICAgICAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MVQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0MVQuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnByZWZpeCA9IGFib3RfZXJiYXNlXzEuRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0MVQuZXJyb3JzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcImkgZGlkIG5vdCBmaW5kIGFueSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgaW5Tb21ldGhpbmcgKyBcIi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpICsgZXJycHJlZml4KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0ge307IC8veyBba2V5OiBzdHJpbmddOiBib29sZWFuIH07XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeVNldEZ1bGwgPSBmZGV2c3RhX21vbm1vdmVfMi5Nb2RlbC5nZXREb21haW5DYXRlZ29yeUZpbHRlckZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxXaXRoQ29udGV4dChjYXRzLCBcIlxcXCJcIiArIGNhdHMuam9pbihcIlxcXCIgXFxcIlwiKSArIFwiXFxcIlwiLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nUXVlcnlXaGF0SXNUdXBlbChzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdFQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFQudHVwZWxhbnN3ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFQpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBpcyBjYXQ+XCIgKyBjYXRzLmpvaW4oXCIsIFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2F0ICE9PSBcImV4YW1wbGUgcXVlc3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0VC50dXBlbGFuc3dlcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ2J1aWxkdGFibGUnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICAgICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgICAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIkludGVudCA6IGJ1aWxkdGFibGVcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcmllcyA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJykuZW50aXR5O1xuICAgICAgICAgICAgZGVidWdsb2coXCJmYWN0T3JDYXQgaXNcIiArIGNhdGVnb3JpZXMpO1xuICAgICAgICAgICAgdmFyIGNhdHM7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdE9ubHlBbmRDb21tYShjYXRlZ29yaWVzLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3JpZXMgKyAnXCIoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNhdHMgfHwgKGNhdHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkaWQgbm90IGZpbmQgYSBjYXRlZ29yeSBpbiBcIicgKyBjYXRlZ29yaWVzICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZXhlYyA9IE1ha2VUYWJsZS5tYWtlVGFibGUoY2F0cywgdGhlTW9kZWwpO1xuICAgICAgICAgICAgLy8gICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0IGFzIElNYXRjaC5JVG9vbE1hdGNoLCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgIHZhciByZXBseSA9IG5ldyBidWlsZGVyLk1lc3NhZ2Uoc2Vzc2lvbilcbiAgICAgICAgICAgICAgICAudGV4dChleGVjLnRleHQpXG4gICAgICAgICAgICAgICAgLmFkZEVudGl0eShleGVjLmFjdGlvbik7XG4gICAgICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQocmVwbHkpKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdEZXNjcmliZScsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogRGVzY3JpYmVcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICAgICAgICB2YXIgZmFjdEVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuICAgICAgICAgICAgdmFyIGZhY3RPckNhdCA9IGZhY3RFbnRpdHkgJiYgZmFjdEVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICB2YXIgZG9tYWluRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0QnKTtcbiAgICAgICAgICAgIHZhciBkb21haW5TID0gZG9tYWluRW50aXR5ICYmIGRvbWFpbkVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICB2YXIgZmlsdGVyRG9tYWluID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKGRvbWFpblMpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJEb21haW4gPSBMaXN0QWxsLmluZmVyRG9tYWluKHRoZU1vZGVsLCBkb21haW5TKTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImdvdCBkb21haW5cIiArIGZpbHRlckRvbWFpbik7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBpbmZlciBhIGRvbWFpbiByZXN0cmljdGlvbiBmcm9tIFxcXCJcIiArIGRvbWFpblMgKyBcIlxcXCIuIFNwZWNpZnkgYW4gZXhpc3RpbmcgZG9tYWluLiAoTGlzdCBhbGwgZG9tYWlucykgdG8gZ2V0IGV4YWN0IG5hbWVzLlxcblwiKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImZhY3RPckNhdCBpc1wiICsgZmFjdE9yQ2F0KTtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLm1ldGF3b3Jkc0Rlc2NyaXB0aW9uc1tmYWN0T3JDYXQudG9Mb3dlckNhc2UoKV0pIHtcbiAgICAgICAgICAgICAgICAvLyBkbyB3ZSBoYXZlIGEgZmlsdGVyID9cbiAgICAgICAgICAgICAgICB2YXIgcHJlZml4ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeCA9ICdcImluIGRvbWFpbiBcIicgKyBmaWx0ZXJEb21haW4gKyAnXCIgbWFrZSBubyBzZW5zZSB3aGVuIG1hdGNoaW5nIGEgbWV0YXdvcmQuXFxuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJzaG93aW5nIG1ldGEgcmVzdWx0XCIpO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQocHJlZml4ICsgJ1wiJyArIGZhY3RPckNhdCArICdcIiBpcyAnICsgZXhwb3J0cy5tZXRhd29yZHNEZXNjcmlwdGlvbnNbZmFjdE9yQ2F0LnRvTG93ZXJDYXNlKCldICsgXCJcIikpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjYXRlZ29yaWVzID0gW107XG4gICAgICAgICAgICBpZiAoV2hhdElzLnNwbGl0QXRDb21tYUFuZChmYWN0T3JDYXQpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKFwiV2hvYSwgaSBjYW4gb25seSBleHBsYWluIG9uZSB0aGluZyBhdCBhIHRpbWUsIG5vdCBcXFwiXCIgKyBmYWN0T3JDYXQgKyBcIlxcXCIuIFBsZWFzZSBhc2sgb25lIGF0IGEgdGltZS5cIikpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBnZXREb21haW5zRm9yQ2F0ZWdvcnlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnkoZmFjdE9yQ2F0LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICB2YXIgY2F0UmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgaWYgKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgLy9UT0RPXG4gICAgICAgICAgICAgICAgY2F0UmVzdWx0cyA9IERlc2NyaWJlLmRlc2NyaWJlQ2F0ZWdvcnkoY2F0ZWdvcnksIGZpbHRlckRvbWFpbiwgdGhlTW9kZWwsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc0ZhY3QgPSBEZXNjcmliZS5kZXNjcmliZUZhY3RJbkRvbWFpbihmYWN0T3JDYXQsIGZpbHRlckRvbWFpbiwgdGhlTW9kZWwpO1xuICAgICAgICAgICAgaWYgKGNhdFJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJlZml4ZWQgPSBjYXRSZXN1bHRzLm1hcChyZXMgPT4gYCR7RGVzY3JpYmUuc2xvcHB5T3JFeGFjdChjYXRlZ29yeSwgZmFjdE9yQ2F0LCB0aGVNb2RlbCl9ICAke3Jlc31gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJlc0ZhY3QgPSBwcmVmaXhlZC5qb2luKFwiXFxuXCIpO1xuICAgICAgICAgICAgICAgICtcIlxcblwiICsgcmVzRmFjdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQocmVzRmFjdCkpO1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG4gICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQoXCJteSBjYXRlZ29yaWVzIGluIGRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiZG9tYWluc1wiKSB7XG4gICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLmRvbWFpbnMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbiwgc2VuZChcIm15IGRvbWFpbnMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLnRvb2xzKS5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9Ub29sLm5hbWU7XG4gICAgICAgICAgICAgIH0pLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sc2VuZChcIm15IHRvb2xzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgIHZhciBjYXRzID0gW107XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdDIoY2F0ZWdvcnksIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmKGUpIHtcbiAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIignICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjYXRzIHx8IChjYXRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyAnXCInKSk7XG4gICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdCA9IFwiXCI7XG4gICAgICAgICAgICBpZiggY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCBjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcnkgaWRlbnRpZmllZDonICsgY2F0KTtcbiAgICAgICAgICAgICAgaWYgKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBhMS5lbnRpdHkpO1xuICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbFdpdGhDb250ZXh0KGNhdCwgYTEuZW50aXR5LFxuICAgICAgICAgICAgICAgICAgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0MS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdDEgPSBMaXN0QWxsLmxpc3RBbGxIYXZpbmdDb250ZXh0KGNhdCwgYTEuZW50aXR5LCB0aGVNb2RlbC5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ2xpc3RhbGwgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQxKSk7XG4gICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdDEpKTtcbiAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDEpO1xuICAgICAgICAgICAgICAgIGlmKGpvaW5yZXN1bHRzLmxlbmd0aCApe1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcImkgZGlkIG5vdCBmaW5kIGFueSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBjYXQsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgZGVidWdsb2coJ2xpc3RhbGwgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdCk7XG4gICAgICAgICAgICAgICAgICBpZihjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCJcbiAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIG11bHRpcGxlIGNhdGVnb3JpZXNcbiAgICAgICAgICAgICAgZGVidWdsb2coJ2NhdGVnb3JpZXMgaWRlbnRpZmllZDonICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICAgIGlmIChhMSAmJiBhMS5lbnRpdHkpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnZ290IGZpbHRlcjonICsgYTEuZW50aXR5KTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLHNlc3Npb24sc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQxVCA9IExpc3RBbGwubGlzdEFsbFR1cGVsV2l0aENvbnRleHQoY2F0cywgYTEuZW50aXR5LFxuICAgICAgICAgICAgICAgICAgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0MVQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnZ29pbmcgZm9yIGhhdmluZycpO1xuICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICByZXN1bHQxVCA9IExpc3RBbGwubGlzdEFsbFR1cGVsSGF2aW5nQ29udGV4dChjYXRzLCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLFxuICAgICAgICAgICAgICAgICAgICB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDFUKSk7XG4gICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0MVQpKTtcbiAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MVQpO1xuICAgICAgICAgICAgICAgIGlmKGpvaW5yZXN1bHRzLmxlbmd0aCApe1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcImkgZGlkIG5vdCBmaW5kIGFueSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IHt9IGFzIHsgW2tleSA6IHN0cmluZ10gOiBib29sZWFufTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLHNlc3Npb24sc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0VCA9IExpc3RBbGwubGlzdEFsbFR1cGVsSGF2aW5nQ29udGV4dChjYXRzLCBcIlxcXCJcIiArIGNhdHMuam9pbihcIlxcXCIgXFxcIlwiKSArIFwiXFxcIlwiLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0VCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFQpKTtcbiAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdHMuam9pbihcIiwgXCIpKTtcbiAgICAgICAgICAgICAgICAgIGlmKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRUKSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRUKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIlxuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAqL1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGxCaW5PcCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbEJpbk9wXCIpO1xuICAgICAgICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlXb3JkID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgdmFyIG9wRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ29wZXJhdG9yJyk7XG4gICAgICAgICAgICB2YXIgb3BlcmF0b3JXb3JkID0gb3BFbnRpdHkgJiYgb3BFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgLy8gY2F0ZWdvcml6ZSBhcyBvcGVyYXRvciA/XG4gICAgICAgICAgICB2YXIgZmlsdGVyRG9tYWluRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2RvbWFpbicpO1xuICAgICAgICAgICAgdmFyIGZpbHRlckRvbWFpblMgPSBmaWx0ZXJEb21haW5FbnRpdHkgJiYgZmlsdGVyRG9tYWluRW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBvcGVyYXRvciA9IFdoYXRJcy5hbmFseXplT3BlcmF0b3Iob3BlcmF0b3JXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnkgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5V29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdmFyIG9wZXJhdG9yQXJncyA9IGZkZXZzdGFfbW9ubW92ZV8yLk1vZGVsLmdldE9wZXJhdG9yKHRoZU1vZGVsLCBvcGVyYXRvcik7XG4gICAgICAgICAgICB2YXIgYTIgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTInKTtcbiAgICAgICAgICAgIGlmICghb3BlcmF0b3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IFwiVW5rbm93biBvcGVyYXRvciBcIiArIG9wZXJhdG9yV29yZCArIFwiLCB0aGlzIGlzIGEgbW9kZWwgYnVnLCBjaGVjayBvcGVyYXRvcnMuanNvbiBhbmQgaW50ZW50cy5qc29uXCI7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJvdWNoLCB0aGlzIHdhcyBpbiBpbnRlcm5hbCBlcnJvci4gUmVjb3ZlcmluZyBmcm9tIGEgd2VpcmQgb3BlcmF0b3IgXFxcIlwiXG4gICAgICAgICAgICAgICAgICAgICsgb3BlcmF0b3JXb3JkICsgXCJcXFwiXFxuXCIpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gVE9ETyAgICAgICAgdGhyb3cgbmV3IEVycm9yKHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZpbHRlckRvbWFpbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJEb21haW5TKSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJmb3VuZCBhIGRvbWFpblN0cmluZ1wiICsgZmlsdGVyRG9tYWluUyk7XG4gICAgICAgICAgICAgICAgZmlsdGVyRG9tYWluID0gTGlzdEFsbC5pbmZlckRvbWFpbih0aGVNb2RlbCwgZmlsdGVyRG9tYWluUyk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJnb3QgZG9tYWluXCIgKyBmaWx0ZXJEb21haW4pO1xuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBmaWx0ZXJEb21haW5TICsgXCJcXFwiLiBTcGVjaWZ5IGFuIGV4aXN0aW5nIGRvbWFpbi4gKExpc3QgYWxsIGRvbWFpbnMpIHRvIGdldCBleGFjdCBuYW1lcy5cXG5cIikpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gYTIgJiYgYTIuZW50aXR5O1xuICAgICAgICAgICAgZnJhZ21lbnQgPSBmZGV2c3RhX21vbm1vdmVfMS5CcmVha0Rvd24udHJpbVF1b3RlZChmZGV2c3RhX21vbm1vdmVfMS5CcmVha0Rvd24udHJpbVF1b3RlZFNwYWNlZChmcmFnbWVudCkpO1xuICAgICAgICAgICAgZGVidWdsb2coXCJmcmFnbWVudCBhZnRlciB0cmltbWluZyBcXFwiXCIgKyBmcmFnbWVudCArIFwiXFxcIlwiKTtcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeVdvcmQgPT09IFwiY2F0ZWdvcmllc1wiKSB7XG4gICAgICAgICAgICAgICAgLy8gZG8gd2UgaGF2ZSBhIGZpbHRlcj9cbiAgICAgICAgICAgICAgICB2YXIgYUZpbHRlcmVkQ2F0ZWdvcmllcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwuY2F0ZWdvcnkpO1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhdHNGb3JEb21haW4gPSBmZGV2c3RhX21vbm1vdmVfMi5Nb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBmaWx0ZXJEb21haW4pO1xuICAgICAgICAgICAgICAgICAgICBhRmlsdGVyZWRDYXRlZ29yaWVzID0gXy5pbnRlcnNlY3Rpb24oYUZpbHRlcmVkQ2F0ZWdvcmllcywgY2F0c0ZvckRvbWFpbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYUZpbHRlcmVkQ2F0ZWdvcmllcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRvbWFpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoYG15IGNhdGVnb3JpZXMgJHtvcGVyYXRvcn0gXCIke2ZyYWdtZW50fVwiIGluIGRvbWFpbiBcIiR7ZmlsdGVyRG9tYWlufVwiIGFyZSAuLi5cXG5gICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgY2F0ZWdvcmllcyAke29wZXJhdG9yfSBcIiR7ZnJhZ21lbnR9XCIgYXJlIC4uLlxcbmAgKyByZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgaGF2ZSBubyBjYXRlZ29yaWVzICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNhdGVnb3J5V29yZCA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwuZG9tYWlucyk7XG4gICAgICAgICAgICAgICAgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm15IGRvbWFpbnMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGhhdmUgbm8gZG9tYWlucyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjYXRlZ29yeVdvcmQgPT09IFwidG9vbHNcIikge1xuICAgICAgICAgICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCB0aGVNb2RlbC50b29scy5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7IHJldHVybiBvVG9vbC5uYW1lOyB9KSk7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJteSB0b29scyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIiBhcmUgLi4uXFxuJyArIHJlcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJJIGhhdmUgbm8gdG9vbHMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5V29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGlmICghY2F0KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeVdvcmQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcnkgaWRlbnRpZmllZDonICsgY2F0KTtcbiAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZ2V0Q2F0ZWdvcnlPcEZpbHRlckFzRGlzdGluY3RTdHJpbmdzKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIGNhdGVnb3J5LCB0aGVNb2RlbC5yZWNvcmRzLCBmaWx0ZXJEb21haW4pO1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIHZhciBpbmZpeEV4cGxhaW4gPSAnJztcbiAgICAgICAgICAgICAgICBpZiAoIUxpc3RBbGwubGlrZWx5UGx1cmFsRGlmZihjYXRlZ29yeSwgY2F0ZWdvcnlXb3JkKSkge1xuICAgICAgICAgICAgICAgICAgICBpbmZpeEV4cGxhaW4gPSAnKFwiJyArIGNhdGVnb3J5ICsgJ1wiKSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKGBteSAke2NhdGVnb3J5V29yZH0ke2luZml4RXhwbGFpbn0gJHtvcGVyYXRvcn0gXCIke2ZyYWdtZW50fVwiIGluIGRvbWFpbiBcIiR7ZmlsdGVyRG9tYWlufVwiIGFyZSAuLi5cXG5gICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgJHtjYXRlZ29yeVdvcmR9JHtpbmZpeEV4cGxhaW59ICR7b3BlcmF0b3J9IFwiJHtmcmFnbWVudH1cIiBhcmUgLi4uXFxuYCArIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vICcgKyBjYXRlZ29yeVdvcmQgKyBpbmZpeEV4cGxhaW4gKyAnICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdUcmFpbk1lJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUcmFpblwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICBpZiAobWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrcm9ub3NcIikgPj0gMCB8fCBtZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtsaW5nb25cIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYVRyYWluTm9LbGluZ29uKSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluUmVwbGllcyk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQocmVzKSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnVG9vTG9uZycsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogVG9vTG9uZ1wiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJUb29Mb25nXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGV4cG9ydHMuYVJlc3BvbnNlc09uVG9vTG9uZykpKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdXcm9uZycsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgICAgICBpbnRlbnQ6IFwiV3JvbmdcIixcbiAgICAgICAgICAgICAgcmVzcG9uc2U6ICc8YmVnaW4gdXBkb3duPidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKGdldFJhbmRvbVJlc3VsdChhQmFja0Zyb21UcmFpbmluZykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAgICAgICAvL3Nlc3Npb24uc2VuZCgnZW5kIG9mIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnRXhpdCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0IDonKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0JyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpKTtcbiAgICAgICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgICAgICAgICBpbnRlbnQ6IFwiRXhpdFwiLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiAneW91IGFyZSBpbiBhIGxvZ2ljIGxvb3AnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcInlvdSBhcmUgaW4gYSBsb2dpYyBsb29wIFwiKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdIZWxwJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAgOicpO1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAnKTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcIkkga25vdyBhYm91dCAuLi4uIDxjYXRlZ29yaWVzPj5cIik7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICAvKlxuICAgICAgLy8gQWRkIGludGVudCBoYW5kbGVyc1xuICAgICAgZGlhbG9nLm1hdGNoZXMoJ3RyYWluJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgIGRlYnVnbG9nKCd0cmFpbicpO1xuICAgICAgICAgIC8vIFJlc29sdmUgYW5kIHN0b3JlIGFueSBlbnRpdGllcyBwYXNzZWQgZnJvbSBMVUlTLlxuICAgICAgICAgIHZhciB0aXRsZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdidWlsdGluLmFsYXJtLnRpdGxlJyk7XG4gICAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoYXJncy5lbnRpdGllcyk7XG4gICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtID0ge1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlID8gdGl0bGUuZW50aXR5IDogbnVsbCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbFxuICAgICAgICAgIH07XG4gICAgICAgICAgLy8gUHJvbXB0IGZvciB0aXRsZVxuICAgICAgICAgIGlmICghYWxhcm0udGl0bGUpIHtcbiAgICAgICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgICAgICAgIGludGVudDogXCJ0cmFpblwiLFxuICAgICAgICAgICAgICByZXNwb25zZTogJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdXaGF0IGZhY3Qgd291bGQgeW91IGxpa2UgdG8gdHJhaW4/Jyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICBhbGFybS50aXRsZSA9IHJlc3VsdHMucmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgIFxyXG4gICAgICAgICAgLy8gUHJvbXB0IGZvciB0aW1lICh0aXRsZSB3aWxsIGJlIGJsYW5rIGlmIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgICAgIGlmIChhbGFybS50aXRsZSAmJiAhYWxhcm0udGltZXN0YW1wKSB7XG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRpbWUoc2Vzc2lvbiwgJ1doYXQgdGltZSB3b3VsZCB5b3UgbGlrZSB0byBzZXQgdGhlIGFsYXJtIGZvcj8nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciB0aW1lID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLnJlc29sdmVUaW1lKFtyZXN1bHRzLnJlc3BvbnNlXSk7XG4gICAgICAgICAgICBhbGFybS50aW1lc3RhbXAgPSB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTZXQgdGhlIGFsYXJtIChpZiB0aXRsZSBvciB0aW1lc3RhbXAgaXMgYmxhbmsgdGhlIHVzZXIgc2FpZCBjYW5jZWwpXG4gICAgICAgICAgaWYgKGFsYXJtLnRpdGxlICYmIGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgLy8gU2F2ZSBhZGRyZXNzIG9mIHdobyB0byBub3RpZnkgYW5kIHdyaXRlIHRvIHNjaGVkdWxlci5cbiAgICAgICAgICAgIGFsYXJtLmFkZHJlc3MgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcztcbiAgICAgICAgICAgIC8vYWxhcm1zW2FsYXJtLnRpdGxlXSA9IGFsYXJtO1xuICAgIFxyXG4gICAgICAgICAgICAvLyBTZW5kIGNvbmZpcm1hdGlvbiB0byB1c2VyXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGFsYXJtLnRpbWVzdGFtcCk7XG4gICAgICAgICAgICB2YXIgaXNBTSA9IGRhdGUuZ2V0SG91cnMoKSA8IDEyO1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKCdDcmVhdGluZyBhbGFybSBuYW1lZCBcIiVzXCIgZm9yICVkLyVkLyVkICVkOiUwMmQlcycsXG4gICAgICAgICAgICAgIGFsYXJtLnRpdGxlLFxuICAgICAgICAgICAgICBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSwgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgICAgICBpc0FNID8gZGF0ZS5nZXRIb3VycygpIDogZGF0ZS5nZXRIb3VycygpIC0gMTIsIGRhdGUuZ2V0TWludXRlcygpLCBpc0FNID8gJ2FtJyA6ICdwbScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ09rLi4uIG5vIHByb2JsZW0uJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdKTtcbiAgICAqL1xuICAgIGRpYWxvZy5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgICAgIHZhciBlbGl6YSA9IGdldEVsaXphQm90KGdldENvbnZlcnNhdGlvbklkKHNlc3Npb24pKTtcbiAgICAgICAgdmFyIHJlcGx5ID0gZWxpemEudHJhbnNmb3JtKHNlc3Npb24ubWVzc2FnZS50ZXh0KTtcbiAgICAgICAgZGlhbG9nbG9nKFwiZWxpemFcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgICAgICAvL25ldyBFaWx6YWJvdFxuICAgICAgICAvL3Nlc3Npb24uc2VuZChcIkkgZG8gbm90IHVuZGVyc3RhbmQgdGhpcyBhdCBhbGxcIik7XG4gICAgICAgIC8vYnVpbGRlci5EaWFsb2dBY3Rpb24uc2VuZCgnSVxcJ20gc29ycnkgSSBkaWRuXFwndCB1bmRlcnN0YW5kLiBJIGNhbiBvbmx5IHNob3cgc3RhcnQgYW5kIHJpbmcnKTtcbiAgICB9KTtcbiAgICAvKlxuICAgIC8vIFZlcnkgc2ltcGxlIGFsYXJtIHNjaGVkdWxlclxuICAgIHZhciBhbGFybXMgPSB7fTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gYWxhcm1zKSB7XG4gICAgICAgIHZhciBhbGFybSA9IGFsYXJtc1trZXldO1xuICAgICAgICBpZiAobm93ID49IGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICAgIHZhciBtc2cgPSBuZXcgYnVpbGRlci5NZXNzYWdlKClcbiAgICAgICAgICAgIC5hZGRyZXNzKGFsYXJtLmFkZHJlc3MpXG4gICAgICAgICAgICAudGV4dCgnSGVyZVxcJ3MgeW91ciBcXCclc1xcJyBhbGFybS4nLCBhbGFybS50aXRsZSk7XG4gICAgICAgICAgYm90LnNlbmQobXNnKTtcbiAgICAgICAgICBkZWxldGUgYWxhcm1zW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCAxNTAwMCk7XG4gICAgKi9cbn1cbmlmIChtb2R1bGUpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAgICAgYVRyYWluTm9LbGluZ29uOiBhVHJhaW5Ob0tsaW5nb24sXG4gICAgICAgIGFUcmFpblJlcGxpZXM6IGFUcmFpblJlcGxpZXMsXG4gICAgICAgIHJlc3RyaWN0RGF0YTogcmVzdHJpY3REYXRhLFxuICAgICAgICBpc0Fub255bW91czogaXNBbm9ueW1vdXMsXG4gICAgICAgIFNpbXBsZVVwRG93blJlY29nbml6ZXI6IFNpbXBsZVVwRG93blJlY29nbml6ZXIsXG4gICAgICAgIGFSZXNwb25zZXNPblRvb0xvbmc6IGV4cG9ydHMuYVJlc3BvbnNlc09uVG9vTG9uZyxcbiAgICAgICAgbWV0YXdvcmRzRGVzY3JpcHRpb25zOiBleHBvcnRzLm1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyxcbiAgICAgICAgbWFrZUJvdDogbWFrZUJvdFxuICAgIH07XG59XG4iLCIvKipcbiAqIFRoZSBib3QgaW1wbGVtZW50YXRpb25cbiAqXG4gKiBJbnN0YW50aWF0ZSBhcHNzaW5nIGEgY29ubmVjdG9yIHZpYVxuICogbWFrZUJvdFxuICpcbiAqL1xuLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuc21hcnRkaWFsb2dcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuLy9kZWNsYXJlIG1vZHVsZSAnZWxpemFib3QnIHsgfTtcbi8vZGVjbGFyZSBtb2R1bGUgJ3dpbnN0b24tcGcnIHsgfTtcbi8vZGVsY2FyZSBtb2R1bGUgJ3dpbnN0b24nIHt9O1xuXG5pbXBvcnQgKiBhcyBidWlsZGVyIGZyb20gJ2JvdGJ1aWxkZXInO1xuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5pbXBvcnQgKiBhcyBFeGVjIGZyb20gJy4uL2V4ZWMvZXhlYyc7XG5pbXBvcnQgKiBhcyBNYXRjaCBmcm9tICcuLi9tYXRjaC9tYXRjaCc7XG5cbmltcG9ydCAqIGFzIEFuYWx5emUgZnJvbSAnLi4vbWF0Y2gvYW5hbHl6ZSc7XG5pbXBvcnQgeyBCcmVha0Rvd24gfSAgZnJvbSAnZmRldnN0YV9tb25tb3ZlJztcblxuaW1wb3J0ICogYXMgV2hhdElzIGZyb20gJy4uL21hdGNoL3doYXRpcyc7XG5pbXBvcnQgKiBhcyBMaXN0QWxsIGZyb20gJy4uL21hdGNoL2xpc3RhbGwnO1xuaW1wb3J0ICogYXMgRGVzY3JpYmUgZnJvbSAnLi4vbWF0Y2gvZGVzY3JpYmUnO1xuaW1wb3J0ICogYXMgTWFrZVRhYmxlIGZyb20gJy4uL2V4ZWMvbWFrZXFiZXRhYmxlJztcblxuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnYWJvdF91dGlscyc7XG5cbmltcG9ydCB7IEVyRXJyb3IgYXMgRXJFcnJvcn0gZnJvbSAnYWJvdF9lcmJhc2UnO1xuXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCAqIGFzIERpYWxvZ0xvZ2dlciBmcm9tICcuLi91dGlscy9kaWFsb2dsb2dnZXInO1xuXG5pbXBvcnQgKiBhcyBwcm9jZXNzIGZyb20gJ3Byb2Nlc3MnO1xuXG52YXIgZGJ1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgfHwgXCJcIjtcblxudmFyIHBnbG9jYWx1cmwgPSBcInBvc3RncmVzOi8vam9lOmFiY2RlZkBsb2NhbGhvc3Q6NTQzMi9hYm90XCI7XG52YXIgZGJ1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgfHwgcGdsb2NhbHVybDtcbmltcG9ydCAqIGFzIHBnIGZyb20gJ3BnJztcbnZhciBvID0gcGcgYXMgYW55O1xuaWYoIShwcm9jZXNzLmVudi5BQk9UX0RCTk9TU0wpKSB7XG4gIG8uZGVmYXVsdHMuc3NsID0gdHJ1ZTsgLy8gT25seSB1c2VkIGludGVybmFsbHkgIVxufVxudmFyIGRpYWxvZ0xvZ2dlciA9IERpYWxvZ0xvZ2dlci5sb2dnZXIoXCJzbWFydGJvdFwiLCBkYnVybCwgcGcpO1xuXG50eXBlIHN0cmluZ09yTWVzc2FnZSA9IHN0cmluZyB8IGJ1aWxkZXIuTWVzc2FnZTtcbmZ1bmN0aW9uIHNlbmQ8VCBleHRlbmRzIHN0cmluZ09yTWVzc2FnZT4obzogVCk6IFQgeyByZXR1cm4gbzsgfTtcbmZ1bmN0aW9uIGRpYWxvZ2xvZyhpbnRlbnQ6IHN0cmluZywgc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uLCByZXNwb25zZTogc3RyaW5nT3JNZXNzYWdlKSB7XG4gIHZhciBzUmVzcG9uc2U6IHN0cmluZztcbiAgdmFyIHNBY3Rpb246IHN0cmluZztcbiAgaWYgKHR5cGVvZiByZXNwb25zZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHNBY3Rpb24gPSBcIlwiO1xuICAgIHNSZXNwb25zZSA9IHJlc3BvbnNlO1xuICB9IGVsc2Uge1xuICAgIHZhciBhTWVzc2FnZTogYnVpbGRlci5NZXNzYWdlID0gcmVzcG9uc2U7XG4gICAgdmFyIGlNZXNzYWdlOiBidWlsZGVyLklNZXNzYWdlID0gYU1lc3NhZ2UudG9NZXNzYWdlKCk7XG4gICAgc1Jlc3BvbnNlID0gaU1lc3NhZ2UudGV4dDtcbiAgICBzQWN0aW9uID0gKGlNZXNzYWdlLmVudGl0aWVzICYmIGlNZXNzYWdlLmVudGl0aWVzWzBdKSA/IChKU09OLnN0cmluZ2lmeShpTWVzc2FnZS5lbnRpdGllcyAmJiBpTWVzc2FnZS5lbnRpdGllc1swXSkpIDogXCJcIjtcbiAgfVxuICBkaWFsb2dMb2dnZXIoe1xuICAgIGludGVudDogaW50ZW50LFxuICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgcmVzcG9uc2U6IHNSZXNwb25zZSxcbiAgICBhY3Rpb246IHNBY3Rpb25cbiAgfSk7XG4gIHNlc3Npb24uc2VuZChyZXNwb25zZSk7XG59XG5cbi8vY29uc3QgcGdMb2dnZXIgPSBuZXcgUGdMb2dnZXIoe1xuLy8gIG5hbWU6ICd0ZXN0LWxvZ2dlcicsXG4vLyAgbGV2ZWw6ICdkZWJ1ZycsXG4vLyAgY29ublN0cmluZzogJ3Bvc3RncmVzOi8vdWJ1bnR1QGxvY2FsaG9zdDo1NDMyL2NpcmNsZV90ZXN0Jyxcbi8vICB0YWJsZU5hbWU6ICd3aW5zdG9uX2xvZ3MnLFxuLy99KTtcblxuXG5cbi8vd2luc3Rvbi5hZGQod2luc3Rvbi50cmFuc3BvcnRzLkZpbGUsIHsgZmlsZW5hbWU6ICd3aW5zdG9uX291dC5sb2cnLCB0aW1lc3RhbXAgOiB0cnVlIH0pO1xuLy8gIHdpbnN0b24ucmVtb3ZlKHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKTtcbi8vd2luc3Rvbi5hZGQocGdMb2dnZXIpO1xuXG4vKlxuY29uc3QgbG9nZ2VyID0gbmV3IHdpbnN0b24uTG9nZ2VyKHtcbiAgdHJhbnNwb3J0czogW1xuICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSh7XG4gICAgICBjb2xvcjogdHJ1ZSxcbiAgICAgIHRpbWVzdGFtcDogdHJ1ZSxcbiAgICB9KSxcbiAgICBwZ0xvZ2dlcixcbiAgXVxufSk7XG4qL1xuLy9wZ0xvZ2dlci5pbml0VGFibGUoZG9uZSk7XG5cblxudmFyIGVsaXphYm90ID0gcmVxdWlyZSgnLi4vZXh0ZXJuL2VsaXphYm90L2VsaXphYm90LmpzJyk7XG4vL2ltcG9ydCAqIGFzIGVsaXphYm90IGZyb20gJ2VsaXphYm90JztcblxubGV0IGRlYnVnbG9nID0gZGVidWcoJ3NtYXJ0ZGlhbG9nJyk7XG5pbXBvcnQgKiBhcyBQbGFpblJlY29nbml6ZXIgZnJvbSAnLi9wbGFpbnJlY29nbml6ZXInO1xuLy92YXIgYnVpbGRlciA9IHJlcXVpcmUoJ2JvdGJ1aWxkZXInKTtcblxuZnVuY3Rpb24gZ2V0Q29udmVyc2F0aW9uSWQoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uKTogc3RyaW5nIHtcbiAgcmV0dXJuIHNlc3Npb24ubWVzc2FnZSAmJlxuICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzICYmXG4gICAgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkO1xufVxuXG52YXIgZWxpemFib3RzID0ge307XG5cbmZ1bmN0aW9uIGdldEVsaXphQm90KGlkOiBzdHJpbmcpIHtcbiAgaWYgKCFlbGl6YWJvdHNbaWRdKSB7XG4gICAgZWxpemFib3RzW2lkXSA9IHtcbiAgICAgIGFjY2VzczogbmV3IERhdGUoKSxcbiAgICAgIGVsaXphYm90OiBuZXcgZWxpemFib3QoKVxuICAgIH07XG4gIH1cbiAgZWxpemFib3RzW2lkXS5hY2Nlc3MgPSBuZXcgRGF0ZSgpO1xuICByZXR1cm4gZWxpemFib3RzW2lkXS5lbGl6YWJvdDtcbn1cblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4uL21hdGNoL2lmbWF0Y2gnO1xuaW1wb3J0ICogYXMgVG9vbHMgZnJvbSAnLi4vbWF0Y2gvdG9vbHMnO1xuXG52YXIgbmV3RmxvdyA9IHRydWU7XG5cbmltcG9ydCB7IE1vZGVsIH0gZnJvbSAnZmRldnN0YV9tb25tb3ZlJztcbmltcG9ydCAqIGFzIEV4ZWNTZXJ2ZXIgZnJvbSAnLi4vZXhlYy9leGVjc2VydmVyJztcblxuLy9jb25zdCB0aGVEZWZhdWx0TW9kZWwgPSBNb2RlbC5sb2FkTW9kZWxzKCk7XG5cbnZhciBtb2RlbHMgPSB7fTtcblxuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aD86IHN0cmluZyk6IElNYXRjaC5JTW9kZWxzIHtcbiAgbW9kZWxQYXRoID0gbW9kZWxQYXRoIHx8IFwiXCI7XG4gIGlmICghbW9kZWxzW21vZGVsUGF0aF0pIHtcbiAgICBtb2RlbHNbbW9kZWxQYXRoXSA9IE1vZGVsLmxvYWRNb2RlbHMobW9kZWxQYXRoKTtcbiAgfVxuICByZXR1cm4gbW9kZWxzW21vZGVsUGF0aF07XG59XG5cbmlmIChuZXdGbG93KSB7XG5cbn0gZWxzZSB7XG5cbiAgLy9jb25zdCB0b29scyA9IFRvb2xzLmdldFRvb2xzKCk7XG4gIC8vY29uc3QgSW5wdXRGaWx0ZXJSdWxlcyA9IHJlcXVpcmUoJy4uL21hdGNoL2lucHV0RmlsdGVyUnVsZXMuanMnKTtcbiAgLy9jb25zdCBtUnVsZXMgPSBJbnB1dEZpbHRlclJ1bGVzLmdldE1SdWxlc1NhbXBsZSgpO1xufVxuXG5mdW5jdGlvbiBpc0Fub255bW91cyh1c2VyaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gdXNlcmlkLmluZGV4T2YoXCJhbm86XCIpID09PSAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzdHJpY3REYXRhKGFycjogYW55W10pIDogYW55W10ge1xuICBpZiAoYXJyLmxlbmd0aCA8IDYpIHtcbiAgICByZXR1cm4gYXJyO1xuICB9XG4gIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuICB2YXIgcmVzID0gYXJyLnNsaWNlKDAsIE1hdGgubWluKE1hdGgubWF4KE1hdGguZmxvb3IoYXJyLmxlbmd0aCAvIDMpLCA3KSwgYXJyLmxlbmd0aCkpO1xuICBpZiAodHlwZW9mIGFyclswXSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHZhciBkZWx0YSA9IGxlbiAtIHJlcy5sZW5ndGg7XG4gICAgcmVzLnB1c2goXCIuLi4gYW5kIFwiICsgZGVsdGEgKyBcIiBtb3JlIGVudHJpZXMgZm9yIHJlZ2lzdGVyZWQgdXNlcnNcIik7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cblxuZnVuY3Rpb24gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uOiBidWlsZGVyLlNlc3Npb24sIGFycjogYW55W10pOiBhbnlbXSB7XG4gIHZhciB1c2VyaWQgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCI7XG4gIGlmIChwcm9jZXNzLmVudi5BQk9UX0VNQUlMX1VTRVIgJiYgaXNBbm9ueW1vdXModXNlcmlkKSkge1xuICAgIHJldHVybiByZXN0cmljdERhdGEoYXJyKTtcbiAgfVxuICByZXR1cm4gYXJyO1xufVxuXG4vKlxuZXhwb3J0IGNsYXNzIFNpbXBsZVJlY29nbml6ZXIgaW1wbGVtZW50cyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG5cbiAgfVxuXG4gIHJlY29nbml6ZShjb250ZXh0OiBidWlsZGVyLklSZWNvZ25pemVDb250ZXh0LCBjYWxsYmFjazogKGVycjogRXJyb3IsIHJlc3VsdDogYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdCkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHZhciB1ID0ge30gYXMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdDtcblxuICAgIGRlYnVnbG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJzdGFydFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiU2hvd0VudGl0eVwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ0cmFpblwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwidHJhaW5cIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImxlYXJuXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJsZWFyblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnR5cGUgPSBcInRyYWluRmFjdFwiO1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJoZWxwXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJoZWxwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJleGl0XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcIndyb25nXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ3cm9uZ1wiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgIGUxLnNjb3JlID0gMC4xO1xuICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICB9XG59XG4qL1xuXG5jb25zdCBhVHJhaW5SZXBsaWVzID0gW1wiVGhhbmsgeW91IGZvciBzaGFyaW5nIHRoaXMgc3VnZ2VzdGlvbiB3aXRoIHVzXCIsXG4gIFwiVGhhbmsgZm9yIGZvciB0aGlzIHZhbHVhYmxlIGluZm9ybWF0aW9uLlwiLFxuICBcIlRoYW5rIGZvciBmb3IgdGhpcyBpbnRlcmVzdGluZyBmYWN0IVwiLFxuICBcIlRoYXRzIGEgcGxldGhvcmlhIG9mIGluZm9ybWF0aW9uLlwiLFxuICBcIlRoYXQncyBhIG51Z2dldCBvZiBpbmZvcm1hdGlvbi5cIixcbiAgXCJMb3ZlbHksIEkgbWF5IGNvbnNpZGVyIHlvdSBpbnB1dC5cIixcbiAgXCJXZWxsIGRvbmUsIGFueXRoaW5nIG1vcmUgdG8gbGV0IG1lIGtub3c/XCIsXG4gIFwiSSBkbyBhcHByZWNpYXRlIHlvdXIgdGVhY2hpbmcgYW5kIG15IGxlYXJuaW5nIGV4cGVyaWVuY2UsIG9yIHdhcyBpdCB0aGUgb3RoZXIgd2F5IHJvdW5kP1wiLFxuICBcIllvdXIgaGVscGZ1bCBpbnB1dCBoYXMgYmVlbiBzdG9yZWQgaW4gc29tZSBkdXN0eSBjb3JuZXIgb2YgdGhlIFdvcmxkIHdpZGUgd2ViIVwiLFxuICBcIlRoYW5rIHlvdSBmb3IgbXkgbGVhcm5pbmcgZXhwZXJpZW5jZSFcIixcbiAgXCJJIGhhdmUgaW5jb3Jwb3JhdGVkIHlvdXIgdmFsdWFibGUgc3VnZ2VzdGlvbiBpbiB0aGUgd2lzZG9tIG9mIHRoZSBpbnRlcm5ldFwiXG5dO1xuXG52YXIgYVRyYWluRGlhbG9nID0gYVRyYWluUmVwbGllcztcblxudmFyIGFUcmFpbkV4aXRIaW50ID0gW1xuICBcIlxcbnR5cGUgXFxcImRvbmVcXFwiIHdoZW4geW91IGFyZSBkb25lIHRyYWluaW5nIG1lLlwiLFxuICBcIlwiLFxuICBcIlwiLFxuICBcIlwiLFxuICBcIlxcbnJlbWVtYmVyLCB5b3UgYXJlIHN0dWNrIGhlcmUgaW5zdHJ1Y3RpbmcgbWUsIHR5cGUgXFxcImRvbmVcXFwiIHRvIHJldHVybi5cIixcbiAgXCJcIl07XG5cbmNvbnN0IGFFbnRlclRyYWluID0gWydTbyB5b3UgdGhpbmsgdGhpcyBpcyB3cm9uZz8gWW91IGNhbiBvZmZlciB5b3VyIGFkdmlzZSBoZXJlLlxcbiBUeXBlIFwiZG9uZVwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lJyxcbiAgJ0ZlZWwgZnJlZSB0byBvZmZlciBtZSB5b3VyIGJldHRlciBzb2x1dGlvbiBoZXJlLlxcblR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuICAnU29tZSBzYXkgXCJUaGUgc2VjcmV0IHRvIGhhcHBpbmVzcyBpcyB0byBsb3dlciB5b3VyIGV4cGVjdGF0aW9ucyB0byB0aGUgcG9pbnQgdGhleSBhcmUgYWxyZWFkeSBtZXQuXCIsIFxcbnQgaWYgeW91IGNvdWxkIGhlbHAgbWUgdG8gYmVjb21lIGJldHRlciwgaW5zdHJ1Y3QgbWUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggdGVhY2hpbmcgbWUnLFxuICAnRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuICAnRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuXTtcbmNvbnN0IGFCYWNrRnJvbVRyYWluaW5nID0gW1xuICAnUHV1aCwgYmFjayBmcm9tIHRyYWluaW5nISBOb3cgZm9yIHRoZSBlYXN5IHBhcnQgLi4uXFxuIGFzayBtZSBhIG5ldyBxdWVzdGlvbi4nLFxuICAnTGl2ZSBhbmQgZG9uXFwndCBsZWFybiwgdGhhdFxcJ3MgdXMuIE5hYWgsIHdlXFwnbGwgc2VlLlxcbkFzayBtZSBhbm90aGVyIHF1ZXN0aW9uLicsXG4gICdUaGUgc2VjcmV0IHRvIGhhcHBpbmVzcyBpcyB0byBsb3dlciB5b3VyIGV4cGVjdGF0aW9ucyB0byB0aGUgcG9pbnQgdGhleSBhcmUgYWxyZWFkeSBtZXQuXFxuIEFzayBtZSBhIHF1ZXN0aW9uLicsXG4gICdUaGFua3MgZm9yIGhhdmluZyB0aGlzIGxlY3R1cmUgc2Vzc2lvbiwgbm93IGkgYW0gYmFjayB0byBvdXIgdXN1YWwgc2VsZi5cXG4gQXNrIG1lIGEgcXVlc3Rpb24uJ1xuXTtcblxuXG5jb25zdCBhVHJhaW5Ob0tsaW5nb24gPSBbXG4gIFwiSGUgd2hvIG1hc3RlcnMgdGhlIGRhcmsgYXJ0cyBvZiBTQVAgbXVzdCBub3QgZHdlbGwgaW4gdGhlIGVhcnRobHkgcmVhbG1zIG9mIFN0YXJ0IFRyZWsuXCIsXG4gIFwiU0FQIGlzIGEgY2xvdWQgY29tcGFueSwgbm90IGEgc3BhY2UgY29tcGFueS5cIixcbiAgXCJUaGUgZGVwdGggb2YgUi8zIGFyZSBkZWVwZXIgdGhhbiBEZWVwIFNwYWNlIDQyLlwiLFxuICBcIk15IGJyYWlucG93ZXIgaXMgZnVsbHkgYWJzb3JiZWQgd2l0aCBtYXN0ZXJpbmcgb3RoZXIgcmVhbG1zLlwiLFxuICBcIkZvciB0aGUgd29zYXAsIHRoZSBza3kgaXMgdGhlIGxpbWl0LiBGZWVsIGZyZWUgdG8gY2hlY2sgb3V0IG5hc2EuZ292IC5cIixcbiAgXCJUaGUgZnV0dXJlIGlzIFNBUCBvciBJQk0gYmx1ZSwgbm90IHNwYWNlIGJsYWNrLlwiLFxuICBcIlRoYXQncyBsZWZ0IHRvIHNvbWUgbXVza3kgZnV0dXJlLlwiXG5dXG5cbmV4cG9ydCBjb25zdCBhUmVzcG9uc2VzT25Ub29Mb25nID0gW1xuICBcIllvdXIgaW5wdXQgc2hvdWxkIGJlIGVsb3F1ZW50IGluIGl0J3MgYnJldml0eS4gVGhpcyBvbmUgd2FzIHRvbyBsb25nLlwiLFxuICBcIm15IHdpc2RvbSBpcyBzZXZlcmx5IGJvdW5kIGJ5IG15IGxpbWl0ZWQgaW5wdXQgcHJvY2Vzc2luZyBjYXBhYmlsaXRpZXMuIENvdWxkIHlvdSBmb3JtdWxhdGUgYSBzaG9ydGVyIGlucHV0PyBUaGFuayB5b3UuXCIsXG4gIFwiVGhlIGxlbmd0aCBvZiB5b3UgaW5wdXQgaW5kaWNhdGVzIHlvdSBwcm9iYWJseSBrbm93IG1vcmUgYWJvdXQgdGhlIHRvcGljIHRoYW4gbWU/IENhbiBpIGh1bWJseSBhc2sgeW91IHRvIGZvcm11bGF0ZSBhIHNob3J0ZXIgcXVlc3Rpb24/XCIsXG4gICdcXFwiV2hhdCBldmVyIHlvdSB3YW50IHRvIHRlYWNoLCBiZSBicmllZlxcXCIgKEhvcmFjZSkuIFdoaWxlIHRoaXMgZG9lcyBub3QgYWx3YXlzIGFwcGxpZXMgdG8gbXkgYW5zd2VycywgaXQgaXMgcmVxdWlyZSBmb3IgeW91ciBxdWVzdGlvbnMuIFBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIHJlZmluZWQgcXVlc3Rpb25zLicsXG4gICdJIHVuZGVyc3RhbmQgbW9yZSB0aGFuIDQtbGV0dGVyIHdvcmRzLCBidXQgbm90IG1vcmUgdGhhbiAyMCB3b3JkIHNlbnRlbmNlcy4gUGxlYXNlIHRyeSB0byBzaG9ydGVuIHlvdXIgaW5wdXQuJyxcbiAgJ3RoZSBza3kgaXMgdGhlIGxpbWl0PyBBaXIgZm9yY2UgbWVtYmVyIG9yIG5vdCwgeW91IGNhbiBhc2sgbG9uZ2VyIHF1ZXN0aW9ucyB0aGFuIFxcXCJ0aGUgc2t5XFxcIiwgYnV0IG5vdCB0aGlzIGxvbmcnLFxuICAnTXkgYW5zd2VycyBtYXkgYmUgZXhoYXVzdGl2ZSwgYnV0IEkgdW5kZXJzdGFuZCBtb3JlIHRoYW4gNC1sZXR0ZXIgd29yZHMsIGJ1dCBub3QgbW9yZSB0aGFuIDIwIHdvcmQgc2VudGVuY2VzLiBTb3JyeS4nLFxuICAnT3VyIGNvbnZlcnNhdGlvbiBtdXN0IGJlIGhpZ2hseSBhc3N5bW1ldHJpYzogbXkgYW5zd2VycyBtYXkgYmUgdmVyYm9zZSBhbmQgZXhoYXVzdGl2ZSBhbmQgZnV6enksIHF1ZXN0aW9ucyBhbmQgaW5wdXQgbXVzdCBiZSBicmllZi4gVHJ5IHRvIHJlZm9ybXVsYXRlIGl0Jyxcbl07XG5cblxuZXhwb3J0IGNvbnN0IG1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyA9IHtcbiAgICAgICAgXCJjYXRlZ29yeVwiOiBcImFuIGF0dHJpYnV0ZSBvZiBhIHJlY29yZCBpbiBhIG1vZGVsLCBleGFtcGxlOiBhIFBsYW5ldCBoYXMgYSBcXFwibmFtZVxcXCIgYXR0cmlidXRlXCIsXG4gICAgICAgIFwiZG9tYWluXCI6IFwiYSBncm91cCBvZiBmYWN0cyB3aGljaCBhcmUgdHlwaWNhbGx5IHVucmVsYXRlZFwiLFxuICAgICAgICBcImtleVwiOiBcImFuIGF0dHJpYnV0ZSB2YWx1ZSAob2YgYSBjYXRlZ29yeSkgd2hpY2ggIGlzIHVuaXF1ZSBmb3IgdGhlIHJlY29yZFwiLFxuICAgICAgICBcInRvb2xcIjogXCJpcyBwb3RlbnRpYWx5IGNvbW1hbmQgdG8gZXhlY3V0ZVwiLFxuICAgICAgICBcInJlY29yZFwiOiBcImEgc3BlY2lmaWMgc2V0IG9mIFxcXCJmYWN0XFxcInMgb2YgYSBkb21haW4sIGEgXFxcInJlY29yZFxcXCIgaGFzIGEgc2V0IG9mIGF0dHJpYnV0ZXMgdmFsdWVzIChcXFwiZmFjdFxcXCJzKSBvZiB0aGUgY2F0ZWdvcmllcywgb2Z0ZW4gYSByZWNvcmQgaGFzIGEgXFxcImtleVxcXCJcIixcbiAgICAgICAgXCJmYWN0XCI6IFwiYSBzcGVjaWZpYyBjYXRlZ29yeSB2YWx1ZSBvZiBhIHJlY29yZCBpbiBhIGRvbWFpbiwgbWF5IGJlIGEgXFxcImtleVxcXCIgdmFsdWVcIixcbiAgICAgIH07XG5cbmZ1bmN0aW9uIGdldFJhbmRvbVJlc3VsdChhcnI6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgcmV0dXJuIGFycltNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnIubGVuZ3RoKSAlIGFyci5sZW5ndGhdO1xufVxuXG5leHBvcnQgY2xhc3MgU2ltcGxlVXBEb3duUmVjb2duaXplciBpbXBsZW1lbnRzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICB9XG5cbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXG4gICAgZGVidWdsb2coXCJyZWNvZ25pemluZyBcIiArIGNvbnRleHQubWVzc2FnZS50ZXh0KTtcbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvd25cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC5kb3duXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwic3RhcnQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ1cFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvbmVcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwicXVpdFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkZWJ1Z2xvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgdS5zY29yZSA9IDAuMTtcbiAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgdS5lbnRpdGllcyA9IFtdO1xuICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gIH1cbn1cblxuY29uc3QgQW55T2JqZWN0ID0gT2JqZWN0IGFzIGFueTtcbi8vIGdsb2JhbFR1bm5lbC5pbml0aWFsaXplKHtcbi8vICBob3N0OiAncHJveHkuZXh4eGFtcGxlLmNvbScsXG4vLyAgcG9ydDogODA4MFxuLy8gfSlcblxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG5cbi8vIGNvbm5lY3Rvci5zZXRBbnN3ZXJIb29rKGZ1bmN0aW9uIChzQW5zd2VyKSB7XG4vLyAgY29uc29sZS5sb2coJ0dvdCBhbnN3ZXIgOiAnICsgc0Fuc3dlciArICdcXG4nKVxuLy8gfSlcblxudmFyIGJvdDtcbi8vIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuLy8gICBjb25uZWN0b3IucHJvY2Vzc01lc3NhZ2UoJ3N0YXJ0IHVuaXQgdGVzdCBBQkMgJylcbi8vIH0sIDUwMDApXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxudmFyIG9KU09OID0gSlNPTi5wYXJzZSgnJyArIGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvaW50ZW50cy5qc29uJykpO1xudmFyIG9SdWxlcyA9IFBsYWluUmVjb2duaXplci5wYXJzZVJ1bGVzKG9KU09OKTtcbi8vIHZhciBSZWNvZ25pemVyID0gbmV3IChyZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIpKG9SdWxlcyk7XG5cblxuZnVuY3Rpb24gbG9nUXVlcnkoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uLCBpbnRlbnQ6IHN0cmluZywgcmVzdWx0PzogQXJyYXk8SU1hdGNoLklUb29sTWF0Y2g+KSB7XG5cbiAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgaW50ZW50OiBpbnRlbnQsXG4gICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICBjb252ZXJzYXRpb25JZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIlxuICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgZGVidWdsb2coXCJsb2dnaW5nIGZhaWxlZCBcIiArIGVycik7XG4gICAgfVxuICB9KTtcbn1cblxuXG5cbmZ1bmN0aW9uIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbiwgaW50ZW50OiBzdHJpbmcsIHJlc3VsdD86IEFycmF5PElNYXRjaC5JV2hhdElzQW5zd2VyPikge1xuXG4gIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgIGludGVudDogaW50ZW50LFxuICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgV2hhdElzLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uLCBpbnRlbnQ6IHN0cmluZywgcmVzdWx0PzogQXJyYXk8SU1hdGNoLklXaGF0SXNUdXBlbEFuc3dlcj4pIHtcblxuICBmcy5hcHBlbmRGaWxlKCcuL2xvZ3Mvc2hvd21lcXVlcmllcy50eHQnLCBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgIHRleHQ6IHNlc3Npb24ubWVzc2FnZS50ZXh0LFxuICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICBpbnRlbnQ6IGludGVudCxcbiAgICByZXM6IHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoICYmIFdoYXRJcy5kdW1wTmljZVR1cGVsKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG59XG5cbnZhciBnd29yZHMgPSB7fTtcbi8qKlxuICogQ29uc3RydWN0IGEgYm90XG4gKiBAcGFyYW0gY29ubmVjdG9yIHtDb25uZWN0b3J9IHRoZSBjb25uZWN0b3IgdG8gdXNlXG4gKiBIVE1MQ29ubmVjdG9yXG4gKiBvciBjb25uZWN0b3IgPSBuZXcgYnVpbGRlci5Db25zb2xlQ29ubmVjdG9yKCkubGlzdGVuKClcbiAqL1xuZnVuY3Rpb24gbWFrZUJvdChjb25uZWN0b3IsIG1vZGVsUGF0aD86IHN0cmluZywgb3B0aW9ucz8gOiBhbnkgKSB7XG4gIHZhciB0ID0gRGF0ZS5ub3coKTtcbiAgdmFyIHRoZU1vZGVsID0gbG9hZE1vZGVsKG1vZGVsUGF0aCk7XG4gIHZhciB0ID0gRGF0ZS5ub3coKSAtIHQ7XG4gIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2hvd01vZGVsTG9hZFRpbWUpIHtcbiAgICBjb25zb2xlLmxvZyhgbW9kZWwgbG9hZCB0aW1lICR7KHQpfWApO1xuICB9XG5cbiAgYm90ID0gbmV3IGJ1aWxkZXIuVW5pdmVyc2FsQm90KGNvbm5lY3Rvcik7XG5cblxuXG4gIC8vIENyZWF0ZSBMVUlTIHJlY29nbml6ZXIgdGhhdCBwb2ludHMgYXQgb3VyIG1vZGVsIGFuZCBhZGQgaXQgYXMgdGhlIHJvb3QgJy8nIGRpYWxvZyBmb3Igb3VyIENvcnRhbmEgQm90LlxuICAvLyB2YXIgbW9kZWwgPSBzZW5zaXRpdmUubW9kZWx1cmw7XG4gIC8vIHZhciBtb2RlbCA9ICdodHRwczovL2FwaS5wcm9qZWN0b3hmb3JkLmFpL2x1aXMvdjIuMC9hcHBzL2M0MTNiMmVmLTM4MmMtNDViZC04ZmYwLWY3NmQ2MGUyYTgyMT9zdWJzY3JpcHRpb24ta2V5PWMyMTM5OGI1OTgwYTRjZTA5ZjQ3NGJiZmVlOTNiODkyJnE9J1xuICB2YXIgcmVjb2duaXplciA9IG5ldyBQbGFpblJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcihvUnVsZXMpO1xuXG4gIHZhciBkaWFsb2cgPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW3JlY29nbml6ZXJdIH0pO1xuICAvLyBkaWFsb2cub25CZWdpbihmdW5jdGlvbihzZXNzaW9uLGFyZ3MpIHtcbiAgLy8gY29uc29sZS5sb2coXCJiZWdpbm5pbmcgLi4uXCIpXG4gIC8vIHNlc3Npb24uZGlhbG9nRGF0YS5yZXRyeVByb21wdCA9IGFyZ3MgJiYgYXJncy5yZXRyeVByb21wdCB8fCBcIkkgYW0gc29ycnlcIlxuICAvLyBzZXNzaW9uLnNlbmQoXCJXaGF0IGRvIHlvdSB3YW50P1wiKVxuICAvL1xuICAvLyB9KVxuXG4gIHZhciBkaWFsb2dVcERvd24gPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW25ldyBTaW1wbGVVcERvd25SZWNvZ25pemVyKCldIH0pO1xuXG4gIGJvdC5kaWFsb2coJy91cGRvd24nLCBkaWFsb2dVcERvd24pO1xuICBkaWFsb2dVcERvd24ub25CZWdpbihmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYUVudGVyVHJhaW4pKSk7XG4gICAgLy9zZXNzaW9uLnNlbmQoXCJIaSB0aGVyZSwgdXBkb3duIGlzIHdhaXRpbmcgZm9yIHlvdVwiKTtcbiAgfSlcblxuICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LnVwJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBleGl0IHRyYWluaW5nPyB0eXBlIFxcXCJkb25lXFxcIiBhZ2Fpbi4nKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHNlc3Npb24uZW5kRGlhbG9nV2l0aFJlc3VsdCh7IHJlc3BvbnNlOiBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjIH0pO1xuICAgIH1cbiAgXVxuICApO1xuXG4gIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQuZG93bicsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAneW91IHdhbnQgdG8gZ28gZG93biEnKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gLTE7IC8vIHJlc3VsdHMucmVwb25zZTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJzdGlsbCBnb2luZyBkb3duP1wiKTtcbiAgICB9XG4gIF1cbiAgKTtcbiAgZGlhbG9nVXBEb3duLm9uRGVmYXVsdChmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIGxvZ1F1ZXJ5KHNlc3Npb24sIFwib25EZWZhdWx0XCIpO1xuICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluRGlhbG9nKSArIGdldFJhbmRvbVJlc3VsdChhVHJhaW5FeGl0SGludCk7XG4gICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKHJlcykpO1xuICB9KTtcblxuLypcbiAgYm90LmRpYWxvZygnL3RyYWluJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxnb0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdEbyB5b3Ugd2FudCB0byB0cmFpbiBtZScpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSByZXN1bHRzLnJlcG9uc2U7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgc2Vzc2lvbi5lbmREaWFsb2dXaXRoUmVzdWx0KHsgcmVzcG9uc2U6IHNlc3Npb24uRGlhbG9nRGF0YS5hYmMgfSk7XG4gICAgfVxuICBdKTtcbiovXG5cbiAgYm90LmRpYWxvZygnLycsIGRpYWxvZyk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1Nob3dNZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICBkZWJ1Z2xvZyhcIlNob3cgRW50aXR5XCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBBbmFseXplLmFuYWx5emVBbGwoYTEuZW50aXR5LFxuICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwudG9vbHMsIGd3b3Jkcyk7XG4gICAgICBsb2dRdWVyeShzZXNzaW9uLCAnU2hvd01lJywgcmVzdWx0KTtcbiAgICAgIC8vIHRlc3QuZXhwZWN0KDMpXG4gICAgICAvLyAgdGVzdC5kZWVwRXF1YWwocmVzdWx0LndlaWdodCwgMTIwLCAnY29ycmVjdCB3ZWlnaHQnKTtcbiAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgZGVidWdsb2coJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICBkZWJ1Z2xvZygndG9wIDogJyArIE1hdGNoLlRvb2xNYXRjaC5kdW1wV2VpZ2h0c1RvcChyZXN1bHQsIHsgdG9wOiAzIH0pKTtcblxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShyZXN1bHRbMF0pKSB7XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgIC8vICAgIHNlc3Npb24uc2VuZCgnU2hvd2luZyBlbnRpdHkgLi4uJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKSkge1xuICAgICAgICB2YXIgcHJvbXB0ID0gQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKTtcbiAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCA9IHByb21wdDtcbiAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShcbiAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0XG4gICAgICAgICkpKTtcbiAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgcHJvbXB0LnRleHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGJlc3QgPSByZXN1bHQubGVuZ3RoID8gTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgOiBcIjxub3RoaW5nPlwiO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkaWQgbm90IHVuZGVyc3RhbmQgdGhpcycgKyBiZXN0KSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpO1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LFxuICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0IGFzIElNYXRjaC5JVG9vbE1hdGNoLCB0aGVNb2RlbC5yZWNvcmRzKTtcblxuICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgIC5hZGRFbnRpdHkoZXhlYy5hY3Rpb24pO1xuICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLFxuICAgICAgICAgICAgc2Vzc2lvbiwgc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKFxuICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0XG4gICAgICAgICAgICApKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgZ2V0IHdoYXQgeW91IHdhbnRcIikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1doYXRJcycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXRpZXNcIik7XG4gICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPyAoJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMsIHVuZGVmaW5lZCwgMikpOiAnLScpO1xuICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgIHZhciBjYXRzID0gW107XG4gICAgICB0cnkge1xuICAgICAgICBjYXRzID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeU11bHRPbmx5QW5kQ29tbWEoY2F0ZWdvcnksIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArXG4gICAgICAgICAgICAoZSA/ICcoJyArIGUudG9TdHJpbmcoKSArICcpJyA6IFwiXCIpKSk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgY2F0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gd2UgaGF2ZSBzb21lIGNhdHMsIChvciBhdCBsZWFzdCBvbmUpXG4gICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGRlYnVnbG9nKCdXSSBjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBXaGF0SXMucmVzb2x2ZUNhdGVnb3J5KGNhdCwgYTEuZW50aXR5LFxuICAgICAgICAgIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCd3aGF0aXMgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTonLScpO1xuICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnV2hhdElzJywgcmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdChyZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQuYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB2YXIgZXhwbGFpbiA9ICcnO1xuICAgICAgICAgIGlmKHJlc3VsdC5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBleHBsYWluID0gRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0LmVycm9ycyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXQgKyBcIiAoXCIgKyBjYXRlZ29yeSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyBgXCIuJHtleHBsYWlufWApKTtcbiAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGRlYnVnbG9nKCdyZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0LmFuc3dlcnNbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpOictJyk7XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCd0b3AgOiAnICsgV2hhdElzLmR1bXBXZWlnaHRzVG9wKHJlc3VsdC5hbnN3ZXJzLCB7IHRvcDogMyB9KSk6ICctJyk7XG4gICAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdUaGUgJyArIGNhdGVnb3J5ICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBpcyAnICsgcmVzdWx0LmFuc3dlcnNbMF0ucmVzdWx0ICsgXCJcXG5cIikpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgICAgfVxuICAgICAgfSAvLyBzaW5nbGUgY2F0ZWdvcnlcbiAgICAgIGVsc2Uge1xuICAgICAgICBkZWJ1Z2xvZygnV0kgY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGRvbWFpbkNhdGVnb3J5RmlsdGVyID0gTW9kZWwuZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCB0cnVlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHZhciBleHBsYWluID0gXCJcIjtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArIFwiXFxcIiAoXCIgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRzKSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyBgXCIke2V4cGxhaW59YCkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3VsdEFyciA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcmllcyhjYXRzLCBhMS5lbnRpdHksXG4gICAgICAgICAgdGhlTW9kZWwsIGRvbWFpbkNhdGVnb3J5RmlsdGVyKTtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnbXVsc3Qgd2hhdGlzIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0QXJyKSk6Jy0nKTtcbiAgICAgICAgbG9nUXVlcnlXaGF0SXNUdXBlbChzZXNzaW9uLCAnV2hhdElzJywgcmVzdWx0QXJyLnR1cGVsYW5zd2Vycyk7XG4gICAgICAgIHZhciBpbmRpcyA9IFdoYXRJcy5pc0luZGlzY3JpbWluYXRlUmVzdWx0VHVwZWwocmVzdWx0QXJyLnR1cGVsYW5zd2Vycyk7XG4gICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdEFyciB8fCAhcmVzdWx0QXJyLnR1cGVsYW5zd2VycyB8fCByZXN1bHRBcnIudHVwZWxhbnN3ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHZhciBleHBsYWluID0gJyc7XG4gICAgICAgICAgaWYocmVzdWx0QXJyLmVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGV4cGxhaW4gPSBFckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHRBcnIuZXJyb3JzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgXCJcXFwiIChcIiArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdHMpICsgJylcXFwiIGluIHJlbGF0aW9uIHRvIFwiJyArIGExLmVudGl0eSArIGBcIiR7ZXhwbGFpbn1gKSk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRBcnIudHVwZWxhbnN3ZXJzWzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKTonLScpO1xuICAgICAgICAgIC8vZGVidWdsb2coJ3RvcCA6ICcgKyBXaGF0SXMuZHVtcFdlaWdodHNUb3AocmVzdWx0QXJyLCB7IHRvcDogMyB9KSk7XG4gICAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdUaGUgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdHMpICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBhcmUgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKHJlc3VsdEFyci50dXBlbGFuc3dlcnNbMF0ucmVzdWx0KSArICdcXG4nKSk7IC8vICArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSkpO1xuICAgICAgICB9XG4gICAgICB9IC8vZW5kaWYgbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgIH1cbiAgXSk7XG5cblxuICBkaWFsb2cubWF0Y2hlcygnTGlzdEFsbCcsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBMaXN0QWxsXCIpO1xuICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzLCB1bmRlZmluZWQsIDIpKSA6Jy0nKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICB2YXIgaW5TdGhFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnaW5zdGgnKVxuICAgICAgdmFyIGluU29tZXRoaW5nID0gaW5TdGhFbnRpdHkgJiYgaW5TdGhFbnRpdHkuZW50aXR5O1xuICAgICAgLy8gc29tZSBtZXRhcXVlcmllczpcbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJjYXRlZ29yaWVzXCIpIHtcbiAgICAgICAgLy8gZG8gd2UgaGF2ZSBhIGZpbHRlciA/XG4gICAgICAgIHZhciBkb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChpblNvbWV0aGluZykge1xuICAgICAgICAgIGRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGluU29tZXRoaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRvbWFpbikge1xuICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLmNhdGVnb3J5KS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICBpZiAoaW5Tb21ldGhpbmcpIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBpbmZlciBhIGRvbWFpbiByZXN0cmljdGlvbiBmcm9tIFxcXCJcIiArIFV0aWxzLnN0cmlwUXVvdGVzKGluU29tZXRoaW5nKSArIFwiXFxcIiwgYWxsIG15IGNhdGVnb3JpZXMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IGNhdGVnb3JpZXMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgYVJlcyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG4gICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgY2F0ZWdvcmllcyBpbiBkb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNhdGVnb3J5ID09PSBcImRvbWFpbnNcIikge1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCB0aGVNb2RlbC5kb21haW5zKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGNhdGVnb3J5ID09PSBcInRvb2xzXCIpIHtcbiAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwudG9vbHMpLm1hcChmdW5jdGlvbiAob1Rvb2wpIHtcbiAgICAgICAgICByZXR1cm4gb1Rvb2wubmFtZTtcbiAgICAgICAgfSkuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IHRvb2xzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgY2F0cyA9IFtdO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgIGRlYnVnbG9nKFwiaGVyZSBjYXRzXCIgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyAnXCIoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghY2F0cyB8fCAoY2F0cy5sZW5ndGggPT09IDApKSB7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyAnXCInKSk7XG4gICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGNhdCA9IFwiXCI7XG4gICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgIH1cbiAgICAgIGlmIChjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBkZWJ1Z2xvZygnc2luZ2xlIGNhdGVnb3J5IGlkZW50aWZpZWQ6JyArIGNhdCk7XG4gICAgICAgIGlmIChpblNvbWV0aGluZykge1xuICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBpblNvbWV0aGluZyk7XG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgICB2YXIgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbFdpdGhDb250ZXh0KGNhdCwgaW5Tb21ldGhpbmcsXG4gICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nPyAoJ2xpc3RhbGwgcmVzdWx0ID46JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKTonLScpO1xuICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0cyhyZXN1bHQxLmFuc3dlcnMpKTtcbiAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDEuYW5zd2Vycyk7XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2c/ICgnbGlzdGFsbCByZXN1bHQyID46JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKTonLScpO1xuICAgICAgICAgIGlmIChqb2lucmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgaW5Tb21ldGhpbmcgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZXJycHJlZml4ID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChyZXN1bHQxLmVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZXJycHJlZml4ID0gRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0MS5lcnJvcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikgKyBcIlwiICsgZXJycHJlZml4KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBubyBmaWx0ZXIgZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgIC8vXG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldERvbWFpbkNhdGVnb3J5RmlsdGVyRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgZmFsc2UpO1xuICAgICAgICAgIHZhciByZXN1bHQgPSBMaXN0QWxsLmxpc3RBbGxXaXRoQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5hbnN3ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpOiAnLScpO1xuICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0KTtcbiAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdC5hbnN3ZXJzKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCJcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGluU29tZXRoaW5nKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGRvbWFpbkNhdGVnb3J5RmlsdGVyID0gTW9kZWwuZ2V0RG9tYWluQ2F0ZWdvcnlGaWx0ZXJGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCB0cnVlKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXN1bHQxVCA9IExpc3RBbGwubGlzdEFsbFR1cGVsV2l0aENvbnRleHQoY2F0cywgaW5Tb21ldGhpbmcsXG4gICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgZG9tYWluQ2F0ZWdvcnlGaWx0ZXIpO1xuICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQ/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDFUKSkgOiAnLScpO1xuICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdDFULnR1cGVsYW5zd2VycykpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQxVC50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgIGlmIChqb2lucmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgaW5Tb21ldGhpbmcgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0MVQuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICBlcnJwcmVmaXggPSBFckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHQxVC5lcnJvcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikgKyBlcnJwcmVmaXgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5vIGVudGl0eSwgZS5nLiBsaXN0IGFsbCBjb3VudHJpZXNcbiAgICAgICAgICAvL1xuICAgICAgICAgIHZhciBjYXRlZ29yeVNldEZ1bGwgPSB7fSBhcyBJTWF0Y2guSURvbWFpbkNhdGVnb3J5RmlsdGVyOyAvL3sgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXREb21haW5DYXRlZ29yeUZpbHRlckZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXN1bHRUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxXaXRoQ29udGV4dChjYXRzLCBcIlxcXCJcIiArIGNhdHMuam9pbihcIlxcXCIgXFxcIlwiKSArIFwiXFxcIlwiLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0VC50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgIGlmIChyZXN1bHRULnR1cGVsYW5zd2Vycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQ/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFQpKTonLScpO1xuICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0cy5qb2luKFwiLCBcIikpO1xuICAgICAgICAgICAgaWYgKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRULnR1cGVsYW5zd2VycykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0VC50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCJcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgXSk7XG5cblxuICBkaWFsb2cubWF0Y2hlcygnYnVpbGR0YWJsZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBidWlsZHRhYmxlXCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGNhdGVnb3JpZXMgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcmllcycpLmVudGl0eTtcbiAgICAgIGRlYnVnbG9nKFwiZmFjdE9yQ2F0IGlzXCIgKyBjYXRlZ29yaWVzKTtcbiAgICAgIHZhciBjYXRzO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3JpZXMsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yaWVzICsgJ1wiKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWNhdHMgfHwgKGNhdHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoJ0kgZGlkIG5vdCBmaW5kIGEgY2F0ZWdvcnkgaW4gXCInICsgY2F0ZWdvcmllcyArICdcIicpKTtcbiAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgZXhlYyA9IE1ha2VUYWJsZS5tYWtlVGFibGUoY2F0cyx0aGVNb2RlbCk7XG4gIC8vICAgICAgY29uc3QgZXhlYyA9IEV4ZWNTZXJ2ZXIuZXhlY1Rvb2woc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCBhcyBJTWF0Y2guSVRvb2xNYXRjaCwgdGhlTW9kZWwucmVjb3Jkcyk7XG4gICAgICAgIHZhciByZXBseSA9IG5ldyBidWlsZGVyLk1lc3NhZ2Uoc2Vzc2lvbilcbiAgICAgICAgICAudGV4dChleGVjLnRleHQpXG4gICAgICAgICAgLmFkZEVudGl0eShleGVjLmFjdGlvbik7XG4gICAgICAgIC8vIC5hZGRBdHRhY2htZW50KHsgZmFsbGJhY2tUZXh0OiBcIkkgZG9uJ3Qga25vd1wiLCBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLCBjb250ZW50VXJsOiBcInd3dy53b21iYXQub3JnXCIgfSk7XG4gICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLCBzZXNzaW9uLCBzZW5kKHJlcGx5KSk7XG4gICAgfVxuXG5cbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ0Rlc2NyaWJlJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICBkZWJ1Z2xvZyhcIkludGVudCA6IERlc2NyaWJlXCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGZhY3RFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgIHZhciBmYWN0T3JDYXQgPSBmYWN0RW50aXR5ICYmIGZhY3RFbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIGRvbWFpbkVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdEJyk7XG4gICAgICB2YXIgZG9tYWluUyA9IGRvbWFpbkVudGl0eSAmJiBkb21haW5FbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIGZpbHRlckRvbWFpbiA9IHVuZGVmaW5lZDtcbiAgICAgIGlmIChkb21haW5TKSB7XG4gICAgICAgIGZpbHRlckRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGRvbWFpblMpO1xuICAgICAgICBkZWJ1Z2xvZyhcImdvdCBkb21haW5cIiArIGZpbHRlckRvbWFpbik7XG4gICAgICAgIGlmICghZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBpbmZlciBhIGRvbWFpbiByZXN0cmljdGlvbiBmcm9tIFxcXCJcIiArIGRvbWFpblMgKyBcIlxcXCIuIFNwZWNpZnkgYW4gZXhpc3RpbmcgZG9tYWluLiAoTGlzdCBhbGwgZG9tYWlucykgdG8gZ2V0IGV4YWN0IG5hbWVzLlxcblwiKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGRlYnVnbG9nKFwiZmFjdE9yQ2F0IGlzXCIgKyBmYWN0T3JDYXQpO1xuICAgICAgaWYgKG1ldGF3b3Jkc0Rlc2NyaXB0aW9uc1tmYWN0T3JDYXQudG9Mb3dlckNhc2UoKV0pIHtcbiAgICAgICAgLy8gZG8gd2UgaGF2ZSBhIGZpbHRlciA/XG4gICAgICAgIHZhciBwcmVmaXggPSBcIlwiO1xuICAgICAgICBpZiAoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgcHJlZml4ID0gJ1wiaW4gZG9tYWluIFwiJyArIGZpbHRlckRvbWFpbiArICdcIiBtYWtlIG5vIHNlbnNlIHdoZW4gbWF0Y2hpbmcgYSBtZXRhd29yZC5cXG4nO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnbG9nKFwic2hvd2luZyBtZXRhIHJlc3VsdFwiKTtcbiAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChwcmVmaXggKyAnXCInICsgZmFjdE9yQ2F0ICsgJ1wiIGlzICcgKyBtZXRhd29yZHNEZXNjcmlwdGlvbnNbZmFjdE9yQ2F0LnRvTG93ZXJDYXNlKCldICsgXCJcIikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgY2F0ZWdvcmllcyA9IFtdO1xuICAgICAgaWYgKFdoYXRJcy5zcGxpdEF0Q29tbWFBbmQoZmFjdE9yQ2F0KS5sZW5ndGggPiAxKSB7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQoXCJXaG9hLCBpIGNhbiBvbmx5IGV4cGxhaW4gb25lIHRoaW5nIGF0IGEgdGltZSwgbm90IFxcXCJcIiArIGZhY3RPckNhdCArIFwiXFxcIi4gUGxlYXNlIGFzayBvbmUgYXQgYSB0aW1lLlwiKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gZ2V0RG9tYWluc0ZvckNhdGVnb3J5XG4gICAgICB9XG5cblxuXG4gICAgICB2YXIgY2F0ZWdvcnkgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGZhY3RPckNhdCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgdmFyIGNhdFJlc3VsdHMgPSBbXTtcbiAgICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgICAvL1RPRE9cbiAgICAgICAgY2F0UmVzdWx0cyA9IERlc2NyaWJlLmRlc2NyaWJlQ2F0ZWdvcnkoY2F0ZWdvcnksZmlsdGVyRG9tYWluLCB0aGVNb2RlbCxtZXNzYWdlKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHJlc0ZhY3QgPSBEZXNjcmliZS5kZXNjcmliZUZhY3RJbkRvbWFpbihmYWN0T3JDYXQsIGZpbHRlckRvbWFpbix0aGVNb2RlbCk7XG4gICAgICBpZihjYXRSZXN1bHRzKSB7XG4gICAgICB2YXIgcHJlZml4ZWQgPSBjYXRSZXN1bHRzLm1hcChyZXMgPT5cbiAgICAgICAgYCR7RGVzY3JpYmUuc2xvcHB5T3JFeGFjdChjYXRlZ29yeSwgZmFjdE9yQ2F0LCB0aGVNb2RlbCl9ICAke3Jlc31gICk7XG4gICAgICB9XG4gICAgICBpZihjYXRSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICByZXNGYWN0ID0gcHJlZml4ZWQuam9pbihcIlxcblwiKTsgKyBcIlxcblwiICsgcmVzRmFjdDtcbiAgICAgIH1cbiAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQocmVzRmFjdCkpO1xuICAgICAgLypcbiAgICAgICAgICB2YXIgYVJlcyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG4gICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQoXCJteSBjYXRlZ29yaWVzIGluIGRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiZG9tYWluc1wiKSB7XG4gICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLmRvbWFpbnMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbiwgc2VuZChcIm15IGRvbWFpbnMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLnRvb2xzKS5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7XG4gICAgICAgICAgcmV0dXJuIG9Ub29sLm5hbWU7XG4gICAgICAgIH0pLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sc2VuZChcIm15IHRvb2xzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAqL1xuXG4gICAgICAvKlxuICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0MihjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgY2F0c1wiICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYoZSkge1xuICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIixzZXNzaW9uLHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWNhdHMgfHwgKGNhdHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIicpKTtcbiAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgY2F0ID0gXCJcIjtcbiAgICAgIGlmKCBjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBjYXQgPSBjYXRzWzBdO1xuICAgICAgfVxuICAgICAgaWYoIGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICBpZiAoYTEgJiYgYTEuZW50aXR5KSB7XG4gICAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGExLmVudGl0eSk7XG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIHRydWUpO1xuICAgICAgICAgIHZhciByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsV2l0aENvbnRleHQoY2F0LCBhMS5lbnRpdHksXG4gICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgaWYgKCFyZXN1bHQxLmxlbmd0aCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ2dvaW5nIGZvciBoYXZpbmcnKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgZmFsc2UpO1xuICAgICAgICAgICAgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLFxuICAgICAgICAgICAgICB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKTtcbiAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0MSkpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MSk7XG4gICAgICAgICAgaWYoam9pbnJlc3VsdHMubGVuZ3RoICl7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBubyBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgICAgLy9cbiAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQpO1xuICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0KTtcbiAgICAgICAgICAgIGlmKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0KSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIlxuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgaWYgKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBhMS5lbnRpdHkpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIHRydWUpO1xuICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxXaXRoQ29udGV4dChjYXRzLCBhMS5lbnRpdHksXG4gICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgaWYgKCFyZXN1bHQxVC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIGExLmVudGl0eSwgdGhlTW9kZWwucnVsZXMsXG4gICAgICAgICAgICAgIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlYnVnbG9nKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MVQpKTtcbiAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHQxVCkpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQxVCk7XG4gICAgICAgICAgaWYoam9pbnJlc3VsdHMubGVuZ3RoICl7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBubyBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgICAgLy9cbiAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0ge30gYXMgeyBba2V5IDogc3RyaW5nXSA6IGJvb2xlYW59O1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyh0aGVNb2RlbCwgY2F0cywgZmFsc2UpO1xuICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXN1bHRUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIFwiXFxcIlwiICsgY2F0cy5qb2luKFwiXFxcIiBcXFwiXCIpICsgXCJcXFwiXCIsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHRUKTtcbiAgICAgICAgICBpZiAocmVzdWx0VC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0VCkpO1xuICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0cy5qb2luKFwiLCBcIikpO1xuICAgICAgICAgICAgaWYoY2F0ICE9PSBcImV4YW1wbGUgcXVlc3Rpb25cIikge1xuICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcIkZvdW5kIG5vIGRhdGEgaGF2aW5nIFxcXCJcIiArIGNhdCArIFwiXFxcIlwiXG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAgICovXG4gICAgfVxuICBdKTtcblxuXG4gIGRpYWxvZy5tYXRjaGVzKCdMaXN0QWxsQmluT3AnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbEJpbk9wXCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICB2YXIgY2F0ZWdvcnlXb3JkID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIG9wRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ29wZXJhdG9yJyk7XG4gICAgICB2YXIgb3BlcmF0b3JXb3JkID0gb3BFbnRpdHkgJiYgIG9wRW50aXR5LmVudGl0eTtcbiAgICAgIC8vIGNhdGVnb3JpemUgYXMgb3BlcmF0b3IgP1xuICAgICAgdmFyIGZpbHRlckRvbWFpbkVudGl0eSA9ICBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnZG9tYWluJyk7XG4gICAgICB2YXIgZmlsdGVyRG9tYWluUyA9IGZpbHRlckRvbWFpbkVudGl0eSAmJiBmaWx0ZXJEb21haW5FbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIG9wZXJhdG9yID0gV2hhdElzLmFuYWx5emVPcGVyYXRvcihvcGVyYXRvcldvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgIHZhciBjYXRlZ29yeSA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnkoY2F0ZWdvcnlXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICB2YXIgb3BlcmF0b3JBcmdzID0gTW9kZWwuZ2V0T3BlcmF0b3IodGhlTW9kZWwsIG9wZXJhdG9yKTtcbiAgICAgIHZhciBhMiA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMicpO1xuICAgICAgaWYgKCFvcGVyYXRvcikge1xuICAgICAgICB2YXIgcyA9IFwiVW5rbm93biBvcGVyYXRvciBcIiArIG9wZXJhdG9yV29yZCArIFwiLCB0aGlzIGlzIGEgbW9kZWwgYnVnLCBjaGVjayBvcGVyYXRvcnMuanNvbiBhbmQgaW50ZW50cy5qc29uXCI7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwib3VjaCwgdGhpcyB3YXMgaW4gaW50ZXJuYWwgZXJyb3IuIFJlY292ZXJpbmcgZnJvbSBhIHdlaXJkIG9wZXJhdG9yIFxcXCJcIlxuICAgICAgICAgICsgb3BlcmF0b3JXb3JkICsgXCJcXFwiXFxuXCIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBUT0RPICAgICAgICB0aHJvdyBuZXcgRXJyb3Iocyk7XG4gICAgICB9XG4gICAgICB2YXIgZmlsdGVyRG9tYWluID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKGZpbHRlckRvbWFpblMpIHtcbiAgICAgICAgZGVidWdsb2coXCJmb3VuZCBhIGRvbWFpblN0cmluZ1wiICsgZmlsdGVyRG9tYWluUyk7XG4gICAgICAgIGZpbHRlckRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGZpbHRlckRvbWFpblMpO1xuICAgICAgICBkZWJ1Z2xvZyhcImdvdCBkb21haW5cIiArIGZpbHRlckRvbWFpbik7XG4gICAgICAgIGlmICghZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBpbmZlciBhIGRvbWFpbiByZXN0cmljdGlvbiBmcm9tIFxcXCJcIiArIGZpbHRlckRvbWFpblMgKyBcIlxcXCIuIFNwZWNpZnkgYW4gZXhpc3RpbmcgZG9tYWluLiAoTGlzdCBhbGwgZG9tYWlucykgdG8gZ2V0IGV4YWN0IG5hbWVzLlxcblwiKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZhciBmcmFnbWVudCA9IGEyICYmIGEyLmVudGl0eTtcbiAgICAgIGZyYWdtZW50ID0gQnJlYWtEb3duLnRyaW1RdW90ZWQoQnJlYWtEb3duLnRyaW1RdW90ZWRTcGFjZWQoZnJhZ21lbnQpKTtcbiAgICAgIGRlYnVnbG9nKFwiZnJhZ21lbnQgYWZ0ZXIgdHJpbW1pbmcgXFxcIlwiICsgZnJhZ21lbnQgKyBcIlxcXCJcIik7XG4gICAgICBpZiAoY2F0ZWdvcnlXb3JkID09PSBcImNhdGVnb3JpZXNcIikge1xuICAgICAgICAvLyBkbyB3ZSBoYXZlIGEgZmlsdGVyP1xuICAgICAgICB2YXIgYUZpbHRlcmVkQ2F0ZWdvcmllcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwuY2F0ZWdvcnkpO1xuICAgICAgICBpZihmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICB2YXIgY2F0c0ZvckRvbWFpbiA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsZmlsdGVyRG9tYWluKTtcbiAgICAgICAgICBhRmlsdGVyZWRDYXRlZ29yaWVzID0gXy5pbnRlcnNlY3Rpb24oYUZpbHRlcmVkQ2F0ZWdvcmllcyxjYXRzRm9yRG9tYWluKTtcbiAgICAgICAgfVxuICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFGaWx0ZXJlZENhdGVnb3JpZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGlmKGZpbHRlckRvbWFpbikge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoYG15IGNhdGVnb3JpZXMgJHtvcGVyYXRvcn0gXCIke2ZyYWdtZW50fVwiIGluIGRvbWFpbiBcIiR7ZmlsdGVyRG9tYWlufVwiIGFyZSAuLi5cXG5gICsgcmVzKSk7XG4gICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoYG15IGNhdGVnb3JpZXMgJHtvcGVyYXRvcn0gXCIke2ZyYWdtZW50fVwiIGFyZSAuLi5cXG5gICsgcmVzKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGhhdmUgbm8gY2F0ZWdvcmllcyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGNhdGVnb3J5V29yZCA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgdmFyIGFSZXMgPSBMaXN0QWxsLmZpbHRlclN0cmluZ0xpc3RCeU9wKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIHRoZU1vZGVsLmRvbWFpbnMpO1xuICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIiBhcmUgLi4uXFxuJyArIHJlcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGhhdmUgbm8gZG9tYWlucyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGNhdGVnb3J5V29yZCA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCB0aGVNb2RlbC50b29scy5tYXAoXG4gICAgICAgICAgZnVuY3Rpb24gKG9Ub29sKSB7IHJldHVybiBvVG9vbC5uYW1lOyB9KSk7XG4gICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgdG9vbHMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIkkgaGF2ZSBubyB0b29scyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlbHNlIHsgLy8gY2F0ZWdvcnkgaXMgY2F0ZWdvcnlcbiAgICAgICAgdmFyIGNhdCA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnkoY2F0ZWdvcnlXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgIGlmICghY2F0KSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5V29yZCArICdcIicpKTtcbiAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZ2V0Q2F0ZWdvcnlPcEZpbHRlckFzRGlzdGluY3RTdHJpbmdzKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIGNhdGVnb3J5LCB0aGVNb2RlbC5yZWNvcmRzLCBmaWx0ZXJEb21haW4pO1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgdmFyIGluZml4RXhwbGFpbiA9ICcnXG4gICAgICAgIGlmICghTGlzdEFsbC5saWtlbHlQbHVyYWxEaWZmKGNhdGVnb3J5LCBjYXRlZ29yeVdvcmQpKSB7XG4gICAgICAgICAgaW5maXhFeHBsYWluID0gJyhcIicgKyBjYXRlZ29yeSArICdcIiknO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKGZpbHRlckRvbWFpbikge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoYG15ICR7Y2F0ZWdvcnlXb3JkfSR7aW5maXhFeHBsYWlufSAke29wZXJhdG9yfSBcIiR7ZnJhZ21lbnR9XCIgaW4gZG9tYWluIFwiJHtmaWx0ZXJEb21haW59XCIgYXJlIC4uLlxcbmAgKyByZXMpKTtcblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgJHtjYXRlZ29yeVdvcmR9JHtpbmZpeEV4cGxhaW59ICR7b3BlcmF0b3J9IFwiJHtmcmFnbWVudH1cIiBhcmUgLi4uXFxuYCArIHJlcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vICcgKyBjYXRlZ29yeVdvcmQgKyBpbmZpeEV4cGxhaW4gKyAnICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1RyYWluTWUnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogVHJhaW5cIik7XG4gICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcmllcycpO1xuICAgICAgaWYgKG1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwia3Jvbm9zXCIpID49IDAgfHwgbWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrbGluZ29uXCIpID49IDApIHtcbiAgICAgICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKGdldFJhbmRvbVJlc3VsdChhVHJhaW5Ob0tsaW5nb24pKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluUmVwbGllcyk7XG4gICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQocmVzKSk7XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cubWF0Y2hlcygnVG9vTG9uZycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUb29Mb25nXCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3JpZXMnKTtcbiAgICAgIGRpYWxvZ2xvZyhcIlRvb0xvbmdcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYVJlc3BvbnNlc09uVG9vTG9uZykpKTtcbiAgICB9XG4gIF0pO1xuXG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1dyb25nJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAvKlxuICAgICAgZGlhbG9nTG9nZ2VyKHtcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgaW50ZW50OiBcIldyb25nXCIsXG4gICAgICAgIHJlc3BvbnNlOiAnPGJlZ2luIHVwZG93bj4nXG4gICAgICB9KTsgKi9cbiAgICAgIHNlc3Npb24uYmVnaW5EaWFsb2coJy91cGRvd24nLCBzZXNzaW9uLnVzZXJEYXRhLmNvdW50KTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICBuZXh0KCk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgc2Vzc2lvbi5zZW5kKGdldFJhbmRvbVJlc3VsdChhQmFja0Zyb21UcmFpbmluZykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAvL3Nlc3Npb24uc2VuZCgnZW5kIG9mIHdyb25nJyk7XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cubWF0Y2hlcygnRXhpdCcsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgZGVidWdsb2coJ2V4aXQgOicpO1xuICAgICAgZGVidWdsb2coJ2V4aXQnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcykpO1xuICAgICAgZGlhbG9nTG9nZ2VyKHtcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgaW50ZW50OiBcIkV4aXRcIixcbiAgICAgICAgcmVzcG9uc2U6ICd5b3UgYXJlIGluIGEgbG9naWMgbG9vcCdcbiAgICAgIH0pO1xuICAgICAgc2Vzc2lvbi5zZW5kKFwieW91IGFyZSBpbiBhIGxvZ2ljIGxvb3AgXCIpO1xuICAgIH1cbiAgXSk7XG4gIGRpYWxvZy5tYXRjaGVzKCdIZWxwJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBkZWJ1Z2xvZygnaGVscCA6Jyk7XG4gICAgICBkZWJ1Z2xvZygnaGVscCcpO1xuICAgICAgc2Vzc2lvbi5zZW5kKFwiSSBrbm93IGFib3V0IC4uLi4gPGNhdGVnb3JpZXM+PlwiKTtcbiAgICB9XG4gIF0pO1xuXG4vKlxuICAvLyBBZGQgaW50ZW50IGhhbmRsZXJzXG4gIGRpYWxvZy5tYXRjaGVzKCd0cmFpbicsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgZGVidWdsb2coJ3RyYWluJyk7XG4gICAgICAvLyBSZXNvbHZlIGFuZCBzdG9yZSBhbnkgZW50aXRpZXMgcGFzc2VkIGZyb20gTFVJUy5cbiAgICAgIHZhciB0aXRsZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdidWlsdGluLmFsYXJtLnRpdGxlJyk7XG4gICAgICB2YXIgdGltZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5yZXNvbHZlVGltZShhcmdzLmVudGl0aWVzKTtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybSA9IHtcbiAgICAgICAgdGl0bGU6IHRpdGxlID8gdGl0bGUuZW50aXR5IDogbnVsbCxcbiAgICAgICAgdGltZXN0YW1wOiB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsXG4gICAgICB9O1xuICAgICAgLy8gUHJvbXB0IGZvciB0aXRsZVxuICAgICAgaWYgKCFhbGFybS50aXRsZSkge1xuICAgICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgICAgaW50ZW50OiBcInRyYWluXCIsXG4gICAgICAgICAgcmVzcG9uc2U6ICdXaGF0IGZhY3Qgd291bGQgeW91IGxpa2UgdG8gdHJhaW4/J1xuICAgICAgICB9KTtcbiAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICBhbGFybS50aXRsZSA9IHJlc3VsdHMucmVzcG9uc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIFByb21wdCBmb3IgdGltZSAodGl0bGUgd2lsbCBiZSBibGFuayBpZiB0aGUgdXNlciBzYWlkIGNhbmNlbClcbiAgICAgIGlmIChhbGFybS50aXRsZSAmJiAhYWxhcm0udGltZXN0YW1wKSB7XG5cblxuICAgICAgICBidWlsZGVyLlByb21wdHMudGltZShzZXNzaW9uLCAnV2hhdCB0aW1lIHdvdWxkIHlvdSBsaWtlIHRvIHNldCB0aGUgYWxhcm0gZm9yPycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgIHZhciB0aW1lID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLnJlc29sdmVUaW1lKFtyZXN1bHRzLnJlc3BvbnNlXSk7XG4gICAgICAgIGFsYXJtLnRpbWVzdGFtcCA9IHRpbWUgPyB0aW1lLmdldFRpbWUoKSA6IG51bGw7XG4gICAgICB9XG4gICAgICAvLyBTZXQgdGhlIGFsYXJtIChpZiB0aXRsZSBvciB0aW1lc3RhbXAgaXMgYmxhbmsgdGhlIHVzZXIgc2FpZCBjYW5jZWwpXG4gICAgICBpZiAoYWxhcm0udGl0bGUgJiYgYWxhcm0udGltZXN0YW1wKSB7XG4gICAgICAgIC8vIFNhdmUgYWRkcmVzcyBvZiB3aG8gdG8gbm90aWZ5IGFuZCB3cml0ZSB0byBzY2hlZHVsZXIuXG4gICAgICAgIGFsYXJtLmFkZHJlc3MgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcztcbiAgICAgICAgLy9hbGFybXNbYWxhcm0udGl0bGVdID0gYWxhcm07XG5cbiAgICAgICAgLy8gU2VuZCBjb25maXJtYXRpb24gdG8gdXNlclxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGFsYXJtLnRpbWVzdGFtcCk7XG4gICAgICAgIHZhciBpc0FNID0gZGF0ZS5nZXRIb3VycygpIDwgMTI7XG4gICAgICAgIHNlc3Npb24uc2VuZCgnQ3JlYXRpbmcgYWxhcm0gbmFtZWQgXCIlc1wiIGZvciAlZC8lZC8lZCAlZDolMDJkJXMnLFxuICAgICAgICAgIGFsYXJtLnRpdGxlLFxuICAgICAgICAgIGRhdGUuZ2V0TW9udGgoKSArIDEsIGRhdGUuZ2V0RGF0ZSgpLCBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgICAgaXNBTSA/IGRhdGUuZ2V0SG91cnMoKSA6IGRhdGUuZ2V0SG91cnMoKSAtIDEyLCBkYXRlLmdldE1pbnV0ZXMoKSwgaXNBTSA/ICdhbScgOiAncG0nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlc3Npb24uc2VuZCgnT2suLi4gbm8gcHJvYmxlbS4nKTtcbiAgICAgIH1cbiAgICB9XG4gIF0pO1xuKi9cblxuICBkaWFsb2cub25EZWZhdWx0KGZ1bmN0aW9uIChzZXNzaW9uKSB7XG4gICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgdmFyIGVsaXphID0gZ2V0RWxpemFCb3QoZ2V0Q29udmVyc2F0aW9uSWQoc2Vzc2lvbikpO1xuICAgIHZhciByZXBseSA9IGVsaXphLnRyYW5zZm9ybShzZXNzaW9uLm1lc3NhZ2UudGV4dCk7XG4gICAgZGlhbG9nbG9nKFwiZWxpemFcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgIC8vbmV3IEVpbHphYm90XG4gICAgLy9zZXNzaW9uLnNlbmQoXCJJIGRvIG5vdCB1bmRlcnN0YW5kIHRoaXMgYXQgYWxsXCIpO1xuICAgIC8vYnVpbGRlci5EaWFsb2dBY3Rpb24uc2VuZCgnSVxcJ20gc29ycnkgSSBkaWRuXFwndCB1bmRlcnN0YW5kLiBJIGNhbiBvbmx5IHNob3cgc3RhcnQgYW5kIHJpbmcnKTtcbiAgfSk7XG5cbiAgLypcbiAgLy8gVmVyeSBzaW1wbGUgYWxhcm0gc2NoZWR1bGVyXG4gIHZhciBhbGFybXMgPSB7fTtcbiAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBmb3IgKHZhciBrZXkgaW4gYWxhcm1zKSB7XG4gICAgICB2YXIgYWxhcm0gPSBhbGFybXNba2V5XTtcbiAgICAgIGlmIChub3cgPj0gYWxhcm0udGltZXN0YW1wKSB7XG4gICAgICAgIHZhciBtc2cgPSBuZXcgYnVpbGRlci5NZXNzYWdlKClcbiAgICAgICAgICAuYWRkcmVzcyhhbGFybS5hZGRyZXNzKVxuICAgICAgICAgIC50ZXh0KCdIZXJlXFwncyB5b3VyIFxcJyVzXFwnIGFsYXJtLicsIGFsYXJtLnRpdGxlKTtcbiAgICAgICAgYm90LnNlbmQobXNnKTtcbiAgICAgICAgZGVsZXRlIGFsYXJtc1trZXldO1xuICAgICAgfVxuICAgIH1cbiAgfSwgMTUwMDApO1xuICAqL1xufVxuXG5pZiAobW9kdWxlKSB7XG4gIG1vZHVsZS5leHBvcnRzID0ge1xuICAgIGFUcmFpbk5vS2xpbmdvbiA6IGFUcmFpbk5vS2xpbmdvbixcbiAgICBhVHJhaW5SZXBsaWVzOiAgYVRyYWluUmVwbGllcyxcbiAgICByZXN0cmljdERhdGEgOiByZXN0cmljdERhdGEsXG4gICAgaXNBbm9ueW1vdXMgOiBpc0Fub255bW91cyxcbiAgICBTaW1wbGVVcERvd25SZWNvZ25pemVyOiBTaW1wbGVVcERvd25SZWNvZ25pemVyLFxuICAgIGFSZXNwb25zZXNPblRvb0xvbmc6IGFSZXNwb25zZXNPblRvb0xvbmcsXG4gICAgbWV0YXdvcmRzRGVzY3JpcHRpb25zIDogbWV0YXdvcmRzRGVzY3JpcHRpb25zLFxuICAgIG1ha2VCb3Q6IG1ha2VCb3RcbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
