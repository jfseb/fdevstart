{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstart/src/../src/match/toolmatcher.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;GAUG;;AAEH,+CAA+C;AAE/C,+BAA+B;AAI/B,oCAAoC;AACpC,6CAAkD;AAElD,6CAA+C;AAE/C,MAAM,IAAI,GAAG,kBAAO,CAAC,IAAI,CAAC;AAC1B,MAAM,QAAQ,GAAG,kBAAO,CAAC,QAAQ,CAAC;AAElC,MAAM,QAAQ,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;AAEtC,mBAA0B,SAA2B,EAAE,KAAmB;IACxE,IAAI,IAAI,GAAG,EAA+B,CAAC;IAC3C,IAAI,QAAQ,GAAG,EAAqC,CAAC;IACrD,IAAI,QAAQ,GAAG,EAAqC,CAAC;IACrD,IAAI,OAAO,GAAG,EAA+B,CAAC;IAC9C,IAAI,QAAQ,GAAG,EAA+B,CAAC;IAC/C,IAAI,aAAa,GAAG,EAAyB,CAAC;IAC9C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAU,SAAiB;QACnE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,sBAAQ,CAAC,kBAAkB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QACxE,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACT,OAAO,CAAC,IAAW,CAAC,GAAG,UAAU,CAAC;YAClC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAChB,QAAQ,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;QAC7B,CAAC;IACH,CAAC,CAAC,CAAC;IACH,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAU,SAAiB;QACnE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,sBAAQ,CAAC,kBAAkB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QACxE,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACT,OAAO,CAAC,IAAW,CAAC,GAAG,UAAU,CAAC;YAClC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAChB,QAAQ,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;QAC7B,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE,KAAK;QACtC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACrE,QAAQ,CAAC,oBAAoB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;YACvD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,IAAI,KAAK,CAAC,aAAa,KAAK,KAAK,CAAC,IAAK,CAAC,CAAC,CAAC;gBAChG,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5B,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,QAAQ,CAAC,KAAK,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;YACpC,CAAC;QACH,CAAC;IACH,CAAC,CAAC,CAAC;IACH,QAAQ,CAAC,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IACjE,QAAQ,CAAC,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IACjE,IAAI,OAAO,GAAG,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAChG,UAAU,GAAG,EAAE,IAAI;QACjB,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACd,MAAM,CAAC,GAAG,CAAC;IACb,CAAC,EAAE,EAAE,CAAC,CAAA;IAER,MAAM,CAAC;QACL,QAAQ,EAAE,QAAQ;QAClB,OAAO,EAAE,OAAO;QAChB,QAAQ,EAAE,QAAQ;QAClB,QAAQ,EAAE,QAAQ;QAClB,aAAa,EAAG,aAAa;KAC9B,CAAA;AACH,CAAC;AAjDD,8BAiDC;AAED,iCAAiC;AAEjC,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC;AAElC,oBAA2B,UAAmC,EAAE,KAA0B;IACxF,6CAA6C;IAC7C,QAAQ,CAAC,0BAA0B;QACjC,UAAU,CAAC,GAAG,CAAC,UAAU,SAAS,EAAE,KAAK;YACzC,MAAM,CAAC,CAAC,KAAK,GAAG,EAAE,CAAC,GAAG,IAAI,KAAK,GAAG,GAAG,sBAAQ,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,GAAG,GAAG,sBAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;QACpH,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IACjB,IAAI,MAAM,GAAG,EAAE,CAAC;IAChB,KAAK,CAAC,OAAO,CAAC,UAAU,KAAK;QAC3B,UAAU,CAAC,OAAO,CAAC,UAAU,SAAS;YACpC,IAAI,eAAe,GAAG,SAAS,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;YAClD,IAAI,SAAS,GAAG;gBACd,eAAe,EAAE,eAAe;gBAChC,QAAQ,EAAE,SAAS;gBACnB,IAAI,EAAG,KAAK;gBACZ,IAAI,EAAG,CAAC;aACY,CAAC;YACvB,SAAS,CAAC,IAAI,GAAG,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;YACjE,EAAE,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBACpC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACzB,CAAC;QACH,CAAC,CAAC,CAAA;IACJ,CAAC,CAAC,CAAC;IACH,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;IAEvC,EAAE,CAAA,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;QACpB,QAAQ,CAAC,kCAAkC;YACzC,MAAM,CAAC,GAAG,CAAC,UAAS,UAAU;gBAC5B,MAAM,CAAC,sBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;YAC7E,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CACd,CAAC;IACJ,CAAC;IACD,MAAM,CAAC,MAAM,CAAC;AAChB,CAAC;AAhCD,gCAgCC","file":"match/toolmatcher.js","sourcesContent":["/**\r\n * @file toolmatcher\r\n * @module jfseb.fdevstart.toolmatcher\r\n * @copyright (c) Gerd Forstmann\r\n *\r\n * Match a tool record on a sentence,\r\n *\r\n * This will unify matching required and optional category words\r\n * with the requirements of the tool.\r\n *\r\n */\r\n\r\n// / <reference path=\"../../lib/node-4.d.ts\" />\r\n\r\nimport * as debug from 'debug';\r\n\r\nimport * as IMatch from './ifmatch';\r\n\r\nimport * as Utils from 'abot_utils';\r\nimport { Sentence as Sentence} from 'abot_erbase';\r\n\r\nimport { Word as OpsWord }  from 'abot_erbase';\r\n\r\nconst Word = OpsWord.Word;\r\nconst Category = OpsWord.Category;\r\n\r\nconst debuglog = debug('toolmatcher');\r\n\r\nexport function matchTool(oSentence: IMatch.ISentence, oTool: IMatch.ITool): IMatch.IToolMatchResult {\r\n  var used = {} as { [key: number]: number };\r\n  var required = {} as { [key: string]: IMatch.IWord };\r\n  var optional = {} as { [key: string]: IMatch.IWord };\r\n  var matched = {} as { [key: string]: string };\r\n  var spurious = {} as { [key: string]: number };\r\n  var toolmentioned = [] as Array<IMatch.IWord>;\r\n  Object.keys(oTool.requires || {}).forEach(function (sCategory: string) {\r\n    let { word, index } = Sentence.findWordByCategory(oSentence, sCategory);\r\n    if (word) {\r\n      matched[word as any] = \"required\";\r\n      used[index] = 1;\r\n      required[sCategory] = word;\r\n    }\r\n  });\r\n  Object.keys(oTool.optional || {}).forEach(function (sCategory: string) {\r\n    var { word, index } = Sentence.findWordByCategory(oSentence, sCategory);\r\n    if (word) {\r\n      matched[word as any] = \"optional\";\r\n      used[index] = 1;\r\n      optional[sCategory] = word;\r\n    }\r\n  });\r\n\r\n  oSentence.forEach(function (oWord, index) {\r\n    if (!used[index] && !Word.isFiller(oWord) && !Word.isCategory(oWord)) {\r\n      debuglog(\"have spurious word\" + JSON.stringify(oWord));\r\n      if (!used[index] && oWord.category === Category.CAT_TOOL && oWord.matchedString === oTool.name ) {\r\n        toolmentioned.push(oWord);\r\n      } else {\r\n        spurious[oWord.matchedString] = 1;\r\n      }\r\n    }\r\n  });\r\n  debuglog('satisfied : ' + Object.keys(oTool.requires).join(\";\"));\r\n  debuglog('required  : ' + Object.keys(oTool.requires).join(\";\"));\r\n  var missing = Utils.ArrayUtils.setMinus(Object.keys(oTool.requires), Object.keys(required)).reduce(\r\n    function (map, sKey) {\r\n      map[sKey] = 1;\r\n      return map;\r\n    }, {})\r\n\r\n  return {\r\n    required: required,\r\n    missing: missing,\r\n    optional: optional,\r\n    spurious: spurious,\r\n    toolmentioned : toolmentioned\r\n  }\r\n}\r\n\r\nimport * as match from './match';\r\n\r\nconst ToolMatch = match.ToolMatch;\r\n\r\nexport function matchTools(aSentences: Array<IMatch.ISentence>, aTool: Array<IMatch.ITool>): IMatch.IToolMatch[] /* objectstream*/ {\r\n  //var stream = new streamutils.MatchStream();\r\n  debuglog(\"matchTools: sentences \\n\" +\r\n    aSentences.map(function (oSentence, index) {\r\n    return (index < 30) ? `[${index}]` + Sentence.rankingProduct(oSentence) + \":\" + Sentence.dumpNice(oSentence) : \"\\n\";\r\n    }).join(\"\\n\"));\r\n  var result = [];\r\n  aTool.forEach(function (oTool) {\r\n    aSentences.forEach(function (oSentence) {\r\n      var toolmatchresult = matchTool(oSentence, oTool);\r\n      var toolmatch = {\r\n        toolmatchresult: toolmatchresult,\r\n        sentence: oSentence,\r\n        tool : oTool,\r\n        rank : 0\r\n      } as IMatch.IToolMatch;\r\n      toolmatch.rank = ToolMatch.rankResult(toolmatch.toolmatchresult);\r\n      if (ToolMatch.isAnyMatch(toolmatch)) {\r\n        result.push(toolmatch);\r\n      }\r\n    })\r\n  });\r\n  result.sort(ToolMatch.compBetterMatch);\r\n\r\n  if(debuglog.enabled) {\r\n    debuglog(\"matchTools: ranked toolmatches\\n\" +\r\n      result.map(function(otoolmatch) {\r\n        return Sentence.dumpNice(otoolmatch.sentence) + JSON.stringify(otoolmatch);\r\n      }).join(\"\\n\")\r\n    );\r\n  }\r\n  return result;\r\n}"],"sourceRoot":"ABC"}