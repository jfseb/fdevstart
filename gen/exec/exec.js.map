{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstart/src/../src/exec/exec.ts"],"names":[],"mappings":"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","file":"exec/exec.js","sourcesContent":["/**\r\n * Functionality to execute a certain response\r\n *\r\n * via a) commandline (e.g. browser startup)\r\n * @file\r\n */\r\n\r\nimport * as intf from 'constants';\r\n\r\nimport * as debug from 'debug';\r\n\r\nimport *  as IFMatch from '../match/ifmatch';\r\n\r\nconst debuglog = debug('dispatcher')\r\n\r\nimport { exec } from 'child_process';\r\n\r\nimport * as IMatch from '../match/ifmatch';\r\nimport * as Match from '../match/match';\r\n\r\n\r\nexport const enum EnumResponseCode {\r\n  NOMATCH = 0,\r\n  EXEC,\r\n  QUERY\r\n}\r\n\r\n/**\r\n * Defines the interface for an analysis\r\n * reponse\r\n */\r\n/*\r\nexport interface IResponse {\r\n  rating : number,\r\n  type : EnumResponseCode,\r\n  query : string,\r\n  context : { [key:string] :string},\r\n  text : string,\r\n  action : IAction,\r\n  prompts : { [key :string ] : { text : string, description : any }; }\r\n\r\n\r\nexport const enum EnumActionType {\r\n  STARTURL,\r\n  STARTCMDLINE\r\n}\r\n\r\nexport interface IAction {\r\n  data : any,\r\n  type : EnumActionType,\r\n  pattern : string,\r\n  concrete : string\r\n}\r\n}*/\r\n\r\n//var exec = require('child_process').exec\r\n\r\nfunction startBrowser (oUrlAction : IFMatch.IAction) {\r\n  var cmd =\r\n  '\"%ProgramFiles(x86)%\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\" --incognito -url \"' + oUrlAction.concrete + '\"'\r\n  exec(cmd, function (error, stdout, stderr) {\r\n    if (error) {\r\n      console.error(`exec error: ${error}`)\r\n      return\r\n    }\r\n    console.log(`stdout: ${stdout}`)\r\n    console.log(`stderr: ${stderr}`)\r\n  })\r\n}\r\n\r\nfunction startCommandLine (scmd : IFMatch.IAction) {\r\n  var cmd = scmd.concrete;\r\n  exec(cmd, function (error, stdout, stderr) {\r\n    if (error) {\r\n      console.error(`exec error: ${error}`)\r\n      return\r\n    }\r\n    console.log(`stdout: ${stdout}`)\r\n    console.log(`stderr: ${stderr}`)\r\n  })\r\n}\r\n\r\n\r\nexport function expandContextIntoAction (oResult : IFMatch.IResponse) {\r\n  var pattern = oResult.action.pattern\r\n  Object.keys(oResult.context).forEach(function (sKey) {\r\n    var regex = new RegExp('{' + sKey + '}', 'g')\r\n    pattern = pattern.replace(regex, oResult.context[sKey])\r\n    pattern = pattern.replace(regex, oResult.context[sKey])\r\n  })\r\n  oResult.action.concrete = pattern;\r\n  return pattern\r\n}\r\n\r\n/**\r\n * execute some starupt\r\n *\r\n */\r\nfunction executeStartup (oResult: IFMatch.IResponse, cb: (err : any, a : IFMatch.IResponse) => string) {\r\n  if (oResult.type !== IFMatch.EnumResponseCode.EXEC) {\r\n    return\r\n  }\r\n  var action = oResult.action;\r\n  if(oResult.action.type === IFMatch.EnumActionType.STARTURL) {\r\n    //var ptn = expandParametersInURL(oResult)\r\n    startBrowser(action)\r\n    return action.concrete\r\n  } else if(oResult.action.type === IFMatch.EnumActionType.STARTCMDLINE) {\r\n    startCommandLine(action);\r\n  } else {\r\n    var s = (\"Don't know how to start \" + oResult.type + '\\n for \"' + oResult.query + '\"')\r\n    console.error(s)\r\n    return s\r\n  }\r\n}\r\n\r\n  function expandParametersInURL (oMergedContextResult) {\r\n    var ptn = oMergedContextResult.result.pattern\r\n    Object.keys(oMergedContextResult.context).forEach(function (sKey) {\r\n      var regex = new RegExp('{' + sKey + '}', 'g')\r\n      ptn = ptn.replace(regex, oMergedContextResult.context[sKey])\r\n      ptn = ptn.replace(regex, oMergedContextResult.context[sKey])\r\n    })\r\n    return ptn\r\n  }\r\n\r\nimport * as inputFilterRules from '../match/inputFilterRules';\r\n\r\nvar toolExecutors = {\r\n  \"xFLP\": {},\r\n  \"xFLPD\" : {},\r\n  \"unit test\" : function(match : IFMatch.IToolMatch) {\r\n    var unittest = match.toolmatchresult.required[\"unit test\"].matchedString;\r\n    var url = inputFilterRules.getUnitTestUrl(unittest);\r\n    return {\r\n      text : \"starting unit test \\\"\" + unittest + \"\\\"\"+  (url?  (' with url ' + url ) : 'no url :-(' ),\r\n      action : { url: url }\r\n    }\r\n  },\r\n  \"wiki\" : function(match : IFMatch.IToolMatch) {\r\n    var wiki = match.toolmatchresult.required[\"wiki\"].matchedString;\r\n    var url = inputFilterRules.getWikiUrl(wiki);\r\n    return {\r\n      text : \"starting wiki \" + wiki + (url?  (' with url ' + url ) : 'no url :-(' ),\r\n      action : { url: url }\r\n    }\r\n  }\r\n};\r\n\r\nexport function execTool(match: IMatch.IToolMatch, bExplain? : boolean) : { text : string,\r\n      action : any } {\r\n        //\r\n    var exec = undefined;\r\n    if (toolExecutors[match.tool.name]) {\r\n      exec = toolExecutors[match.tool.name](match);\r\n\r\n    }\r\n    if (!exec) {\r\n      exec = {\r\n        text : \"don't know how to execute \" + match.tool.name + '\\n'\r\n      }\r\n    }\r\n    if ( bExplain ) {\r\n      exec.text = exec.text + \"\\n\" + Match.ToolMatch.dumpNice(match);\r\n    }\r\n    return exec;\r\n\r\n    // TODO invoke tool specific starter\r\n    /* if (oMergedContextResult.result.type === 'URL') {\r\n      var ptn = expandParametersInURL(oMergedContextResult)\r\n      startBrowser(ptn)\r\n      return ptn\r\n    } else {\r\n      var s = (\"Don't know how to start \" + oMergedContextResult.result.type + '\\n for \"' + oMergedContextResult.query + '\"')\r\n      debuglog(s)\r\n      return s\r\n    }*/\r\n  }\r\n\r\n\r\n//  executeStartup: executeStartup\r\n//}\r\n"],"sourceRoot":"ABC"}